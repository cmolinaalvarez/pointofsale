2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | [generated in 0.00172s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | [generated in 0.00544s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | INSERT INTO payment_terms (id, code, description, net_days, discount_percent, discount_days, basis, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::NUMERIC(5, 2), $6::INTEGER, $7::VARCHAR, $8::BOOLEAN, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | [generated in 0.00202s] (UUID('13ea1665-1a68-48a8-8a21-91cbe29f8ff4'), 'CASH', 'Pago de contado', 0, 0.0, 0, 'invoice', True, UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'), datetime.datetime(2025, 8, 18, 5, 0, 23, 280876), None)
2025-08-18 00:00:23 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 00:00:23 | ERROR | app.crud.payment_term | Error al crear el término de pago
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: llave duplicada viola restricción de unicidad «ix_payment_terms_code»
DETAIL:  Ya existe la llave (code)=(CASH).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: llave duplicada viola restricción de unicidad «ix_payment_terms_code»
DETAIL:  Ya existe la llave (code)=(CASH).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\crud\payment_term.py", line 33, in create_payment_term
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: llave duplicada viola restricción de unicidad «ix_payment_terms_code»
DETAIL:  Ya existe la llave (code)=(CASH).
[SQL: INSERT INTO payment_terms (id, code, description, net_days, discount_percent, discount_days, basis, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::NUMERIC(5, 2), $6::INTEGER, $7::VARCHAR, $8::BOOLEAN, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('13ea1665-1a68-48a8-8a21-91cbe29f8ff4'), 'CASH', 'Pago de contado', 0, 0.0, 0, 'invoice', True, UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'), datetime.datetime(2025, 8, 18, 5, 0, 23, 280876), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 00:00:23 | ERROR | app.routers.payment_term | Error de integridad al crear el término de pago: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: llave duplicada viola restricción de unicidad «ix_payment_terms_code»
DETAIL:  Ya existe la llave (code)=(CASH).
[SQL: INSERT INTO payment_terms (id, code, description, net_days, discount_percent, discount_days, basis, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::NUMERIC(5, 2), $6::INTEGER, $7::VARCHAR, $8::BOOLEAN, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('13ea1665-1a68-48a8-8a21-91cbe29f8ff4'), 'CASH', 'Pago de contado', 0, 0.0, 0, 'invoice', True, UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'), datetime.datetime(2025, 8, 18, 5, 0, 23, 280876), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: llave duplicada viola restricción de unicidad «ix_payment_terms_code»
DETAIL:  Ya existe la llave (code)=(CASH).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: llave duplicada viola restricción de unicidad «ix_payment_terms_code»
DETAIL:  Ya existe la llave (code)=(CASH).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\payment_term.py", line 37, in create_payment_term_endpoint
    new_payment_term, log = await create_payment_term(db, payment_term_in, current_user.id)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\app\crud\payment_term.py", line 33, in create_payment_term
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: llave duplicada viola restricción de unicidad «ix_payment_terms_code»
DETAIL:  Ya existe la llave (code)=(CASH).
[SQL: INSERT INTO payment_terms (id, code, description, net_days, discount_percent, discount_days, basis, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::NUMERIC(5, 2), $6::INTEGER, $7::VARCHAR, $8::BOOLEAN, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('13ea1665-1a68-48a8-8a21-91cbe29f8ff4'), 'CASH', 'Pago de contado', 0, 0.0, 0, 'invoice', True, UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'), datetime.datetime(2025, 8, 18, 5, 0, 23, 280876), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 00:01:32 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 00:01:32 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 00:01:32 | INFO | sqlalchemy.engine.Engine | [cached since 69.75s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:01:32 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 00:01:32 | INFO | sqlalchemy.engine.Engine | [cached since 69.75s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:01:33 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | [cached since 111.4s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | [cached since 111.4s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | INSERT INTO payment_terms (id, code, description, net_days, discount_percent, discount_days, basis, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::NUMERIC(5, 2), $6::INTEGER, $7::VARCHAR, $8::BOOLEAN, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | [cached since 111.3s ago] (UUID('640b652f-e17e-4610-8547-b7b2f56fa095'), 'CASH', 'Pago de contado', 0, 0.0, 0, 'invoice', True, UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'), datetime.datetime(2025, 8, 18, 5, 2, 14, 617008), None)
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | [generated in 0.00153s] ('audit_level',)
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | [generated in 0.00323s] (UUID('917ec844-1e51-4f32-b5df-fe26d4ff236b'), 'CREATE', 'PaymentTerm', UUID('640b652f-e17e-4610-8547-b7b2f56fa095'), 'PaymentTerm creado: CASH (id=640b652f-e17e-4610-8547-b7b2f56fa095, description=Pago de contado, active=True)', UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 00:02:14 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 00:02:14 | INFO | app.routers.payment_term | Término de pago creado exitosamente: 640b652f-e17e-4610-8547-b7b2f56fa095 - CASH por usuario 633b2fe2-6d87-475b-864a-07a15adf2d0c
2025-08-18 00:02:37 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 00:02:38 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 00:02:38 | INFO | sqlalchemy.engine.Engine | [cached since 134.8s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:02:38 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 00:02:38 | INFO | sqlalchemy.engine.Engine | [cached since 134.8s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:02:38 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 00:05:12 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 00:05:12 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 00:05:12 | INFO | sqlalchemy.engine.Engine | [cached since 289.6s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:05:12 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 00:05:12 | INFO | sqlalchemy.engine.Engine | [cached since 289.6s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:05:12 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | [cached since 400s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | [cached since 400s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | INSERT INTO payment_terms (id, code, description, net_days, discount_percent, discount_days, basis, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::NUMERIC(5, 2), $6::INTEGER, $7::VARCHAR, $8::BOOLEAN, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | [cached since 400s ago] (UUID('016a952a-a209-435f-88b4-09fd9605f37a'), 'NET15', 'Crédito a 15 días', 15, 0.0, 0, 'invoice', True, UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'), datetime.datetime(2025, 8, 18, 5, 7, 3, 296218), None)
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | [cached since 288.7s ago] ('audit_level',)
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | [cached since 288.7s ago] (UUID('9629dcf4-2c29-4398-b6e0-24d32428e84c'), 'CREATE', 'PaymentTerm', UUID('016a952a-a209-435f-88b4-09fd9605f37a'), 'PaymentTerm creado: NET15 (id=016a952a-a209-435f-88b4-09fd9605f37a, description=Crédito a 15 días, active=True)', UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 00:07:03 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 00:07:03 | INFO | app.routers.payment_term | Término de pago creado exitosamente: 016a952a-a209-435f-88b4-09fd9605f37a - NET15 por usuario 633b2fe2-6d87-475b-864a-07a15adf2d0c
2025-08-18 02:25:14 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 02:25:14 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-18 02:25:14 | INFO | sqlalchemy.engine.Engine | [generated in 0.00182s] ('admin@gmail.com',)
2025-08-18 02:25:14 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 02:25:14 | INFO | sqlalchemy.engine.Engine | [cached since 8692s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:25:14 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 02:25:21 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 02:25:21 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 02:25:21 | INFO | sqlalchemy.engine.Engine | [cached since 8699s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:25:21 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 02:25:22 | INFO | sqlalchemy.engine.Engine | [cached since 8699s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:25:22 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 02:26:30 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 02:26:30 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 02:26:30 | INFO | sqlalchemy.engine.Engine | [cached since 8767s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:26:30 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 02:26:30 | INFO | sqlalchemy.engine.Engine | [cached since 8767s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:26:30 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT payment_terms.id AS id, payment_terms.code AS code, payment_terms.description AS description, payment_terms.net_days AS net_days, payment_terms.discount_percent AS discount_percent, payment_terms.discount_days AS discount_days, payment_terms.basis AS basis, payment_terms.active AS active, payment_terms.user_id AS user_id, payment_terms.created_at AS created_at, payment_terms.updated_at AS updated_at 
FROM payment_terms) AS anon_1
2025-08-18 02:26:30 | INFO | sqlalchemy.engine.Engine | [generated in 0.00257s] ()
2025-08-18 02:26:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 02:26:30 | ERROR | root | Error inesperado en get_payment_termos
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\crud\payment_term.py", line 88, in get_payment_terms
    query.offset(skip).limit(limit).order_by(PaymentTerm.name)
                                             ^^^^^^^^^^^^^^^^
AttributeError: type object 'PaymentTerm' has no attribute 'name'
2025-08-18 02:26:30 | ERROR | app.routers.payment_term | Error inesperado al listar los términos de pago
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\payment_term.py", line 79, in list_payment_terms
    result = await get_payment_terms(db, skip, limit, search, active, current_user.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\app\crud\payment_term.py", line 88, in get_payment_terms
    query.offset(skip).limit(limit).order_by(PaymentTerm.name)
                                             ^^^^^^^^^^^^^^^^
AttributeError: type object 'PaymentTerm' has no attribute 'name'
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | [generated in 0.00216s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | [generated in 0.00495s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT payment_terms.id AS id, payment_terms.code AS code, payment_terms.description AS description, payment_terms.net_days AS net_days, payment_terms.discount_percent AS discount_percent, payment_terms.discount_days AS discount_days, payment_terms.basis AS basis, payment_terms.active AS active, payment_terms.user_id AS user_id, payment_terms.created_at AS created_at, payment_terms.updated_at AS updated_at 
FROM payment_terms) AS anon_1
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | [generated in 0.00334s] ()
2025-08-18 02:27:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 02:27:30 | ERROR | root | Error inesperado en get_payment_termos
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\crud\payment_term.py", line 88, in get_payment_terms
    query.offset(skip).limit(limit).order_by(PaymentTerm.name)
                                             ^^^^^^^^^^^^^^^^
AttributeError: type object 'PaymentTerm' has no attribute 'name'
2025-08-18 02:27:30 | ERROR | app.routers.payment_term | Error inesperado al listar los términos de pago
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\payment_term.py", line 79, in list_payment_terms
    result = await get_payment_terms(db, skip, limit, search, active, current_user.id)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\app\crud\payment_term.py", line 88, in get_payment_terms
    query.offset(skip).limit(limit).order_by(PaymentTerm.name)
                                             ^^^^^^^^^^^^^^^^
AttributeError: type object 'PaymentTerm' has no attribute 'name'
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00209s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00277s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT payment_terms.id AS id, payment_terms.code AS code, payment_terms.description AS description, payment_terms.net_days AS net_days, payment_terms.discount_percent AS discount_percent, payment_terms.discount_days AS discount_days, payment_terms.basis AS basis, payment_terms.active AS active, payment_terms.user_id AS user_id, payment_terms.created_at AS created_at, payment_terms.updated_at AS updated_at 
FROM payment_terms) AS anon_1
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00948s] ()
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | SELECT payment_terms.id, payment_terms.code, payment_terms.description, payment_terms.net_days, payment_terms.discount_percent, payment_terms.discount_days, payment_terms.basis, payment_terms.active, payment_terms.user_id, payment_terms.created_at, payment_terms.updated_at 
FROM payment_terms ORDER BY payment_terms.code 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00175s] (5, 0)
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00419s] ('audit_level',)
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00374s] (UUID('7052694e-e9ad-4835-a404-953883a4537d'), 'GETALL', 'PaymentTerm', None, "Consulta de payment_termos - filtros: search='None', active=None, skip=0, limit=5", UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 02:28:11 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 02:29:15 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 02:29:15 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 02:29:15 | INFO | sqlalchemy.engine.Engine | [cached since 63.32s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:29:15 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 02:29:15 | INFO | sqlalchemy.engine.Engine | [cached since 63.32s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:29:15 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | [generated in 0.00169s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | [generated in 0.01018s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 02:30:19 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:18:51 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:18:51 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 03:18:51 | INFO | sqlalchemy.engine.Engine | [cached since 2923s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:18:51 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 03:18:51 | INFO | sqlalchemy.engine.Engine | [cached since 2923s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:18:51 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | [generated in 0.00097s] ('admin@gmail.com',)
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | [generated in 0.00127s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:25:59 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:26:09 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:26:09 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 03:26:09 | INFO | sqlalchemy.engine.Engine | [generated in 0.00113s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:26:09 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 03:26:09 | INFO | sqlalchemy.engine.Engine | [cached since 9.497s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:26:09 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | [generated in 0.00102s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | [generated in 0.00386s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:28:56 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | [generated in 0.00175s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | [generated in 0.00185s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:42:56 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | [generated in 0.00176s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | [generated in 0.00603s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:44:46 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | [cached since 264s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | [cached since 264s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00482s] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00343s] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | SELECT coalesce(max(purchases.sequence_number), $1::INTEGER) AS coalesce_1 
FROM purchases 
WHERE purchases.document_id = $2::UUID AND date_part($3::VARCHAR, purchases.created_at) = $4::INTEGER
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00088s] (0, UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), 'year', 2025)
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00370s] (UUID('100b1d6d-fbdf-4f6c-a27b-b939b5ca32eb'), UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), UUID('c6c405b2-df0b-4e06-9ddb-54b0a9e6159a'), UUID('e86d59fc-16ce-44bb-8de4-1a94308a8556'), UUID('11111111-2222-3333-4444-555555555555'), UUID('22cf0b09-9a4b-4d81-b7ce-7b70c13f16f3'), 1, 'FAC-2025-00001', Decimal('114000.0'), Decimal('3650.0'), Decimal('21325.0'), Decimal('131675.0'), True, datetime.datetime(2025, 8, 18, 8, 49, 10, 729502), None)
2025-08-18 03:49:10 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:49:10 | ERROR | app.routers.purchase | Error interno al crear compra
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.ForeignKeyViolationError: inserción o actualización en la tabla «purchases» viola la llave foránea «purchases_payment_term_id_fkey»
DETAIL:  La llave (payment_term_id)=(11111111-2222-3333-4444-555555555555) no está presente en la tabla «payment_terms».

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: inserción o actualización en la tabla «purchases» viola la llave foránea «purchases_payment_term_id_fkey»
DETAIL:  La llave (payment_term_id)=(11111111-2222-3333-4444-555555555555) no está presente en la tabla «payment_terms».

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\crud\purchase.py", line 203, in create_purchase
    await db.flush()  # => purchase.id disponible para FK en items y logs
    ^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: inserción o actualización en la tabla «purchases» viola la llave foránea «purchases_payment_term_id_fkey»
DETAIL:  La llave (payment_term_id)=(11111111-2222-3333-4444-555555555555) no está presente en la tabla «payment_terms».
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('100b1d6d-fbdf-4f6c-a27b-b939b5ca32eb'), UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), UUID('c6c405b2-df0b-4e06-9ddb-54b0a9e6159a'), UUID('e86d59fc-16ce-44bb-8de4-1a94308a8556'), UUID('11111111-2222-3333-4444-555555555555'), UUID('22cf0b09-9a4b-4d81-b7ce-7b70c13f16f3'), 1, 'FAC-2025-00001', Decimal('114000.0'), Decimal('3650.0'), Decimal('21325.0'), Decimal('131675.0'), True, datetime.datetime(2025, 8, 18, 8, 49, 10, 729502), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 107, in create_purchase_endpoint
    new_purchase = await create_purchase(db, purchase_in, current_user.id)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\app\crud\purchase.py", line 274, in create_purchase
    raise HTTPException(status_code=400, detail=f"Error de integridad creando Purchase: {ie.orig}") from ie
fastapi.exceptions.HTTPException: 400: Error de integridad creando Purchase: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: inserción o actualización en la tabla «purchases» viola la llave foránea «purchases_payment_term_id_fkey»
DETAIL:  La llave (payment_term_id)=(11111111-2222-3333-4444-555555555555) no está presente en la tabla «payment_terms».
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [cached since 317.2s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [cached since 317.2s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [cached since 53.25s ago] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [cached since 53.21s ago] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | SELECT coalesce(max(purchases.sequence_number), $1::INTEGER) AS coalesce_1 
FROM purchases 
WHERE purchases.document_id = $2::UUID AND date_part($3::VARCHAR, purchases.created_at) = $4::INTEGER
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [cached since 53.21s ago] (0, UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), 'year', 2025)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [cached since 53.2s ago] (UUID('8772232d-0189-4239-8a47-fde4ad448a5e'), UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), UUID('c6c405b2-df0b-4e06-9ddb-54b0a9e6159a'), UUID('e86d59fc-16ce-44bb-8de4-1a94308a8556'), UUID('640b652f-e17e-4610-8547-b7b2f56fa095'), UUID('22cf0b09-9a4b-4d81-b7ce-7b70c13f16f3'), 1, 'FAC-2025-00001', Decimal('114000.0'), Decimal('3650.0'), Decimal('21325.0'), Decimal('131675.0'), True, datetime.datetime(2025, 8, 18, 8, 50, 3, 930796), None)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchase_items (id, purchase_id, product_id, quantity, subtotal, discount, tax, total) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::NUMERIC(12, 2), $5::NUMERIC(12, 2), $6::NUMERIC(12, 2), $7::NUMERIC(12, 2), $8::NUMERIC(12, 2)), ($9::UUID, $ ... 165 characters truncated ... :NUMERIC(12, 2), $21::NUMERIC(12, 2), $22::NUMERIC(12, 2), $23::NUMERIC(12, 2), $24::NUMERIC(12, 2))
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [generated in 0.00026s (insertmanyvalues) 1/1 (unordered)] (UUID('74b3d223-2f8f-44eb-9bf0-fdd687d5d6c9'), UUID('8772232d-0189-4239-8a47-fde4ad448a5e'), UUID('2e8dfc22-c47d-4e84-9a5d-900de19995db'), 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), UUID('19d5a3b8-a541-4943-a221-04e759f6a4a9'), UUID('8772232d-0189-4239-8a47-fde4ad448a5e'), UUID('c2bffa70-cb06-47f5-a67d-8d6bfe51a908'), 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), UUID('24d6c7fb-f93e-4bf4-a584-e2b2353838a1'), UUID('8772232d-0189-4239-8a47-fde4ad448a5e'), UUID('c4be288f-9de0-4413-be7e-c57f6be627f4'), 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'))
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [generated in 0.00097s] ('audit_level',)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [generated in 0.00072s] (UUID('18e18405-4034-48a8-b924-93bf9651ff77'), 'CREATE', 'Purchase', UUID('8772232d-0189-4239-8a47-fde4ad448a5e'), 'Entrada creada con número FAC-2025-00001', UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | SELECT purchases.id, purchases.document_id, purchases.third_party_id, purchases.concept_id, purchases.payment_term_id, purchases.user_id, purchases.sequence_number, purchases.purchase_number, purchases.subtotal, purchases.discount, purchases.tax, purchases.total, purchases.active, purchases.created_at, purchases.updated_at 
FROM purchases 
WHERE purchases.id = $1::UUID
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [generated in 0.00105s] (UUID('8772232d-0189-4239-8a47-fde4ad448a5e'),)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | SELECT purchase_items.purchase_id AS purchase_items_purchase_id, purchase_items.id AS purchase_items_id, purchase_items.product_id AS purchase_items_product_id, purchase_items.quantity AS purchase_items_quantity, purchase_items.subtotal AS purchase_items_subtotal, purchase_items.discount AS purchase_items_discount, purchase_items.tax AS purchase_items_tax, purchase_items.total AS purchase_items_total 
FROM purchase_items 
WHERE purchase_items.purchase_id IN ($1::UUID)
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | [generated in 0.00749s] (UUID('8772232d-0189-4239-8a47-fde4ad448a5e'),)
2025-08-18 03:50:03 | INFO | app.routers.purchase | Entrada creada: 8772232d-0189-4239-8a47-fde4ad448a5e por usuario 633b2fe2-6d87-475b-864a-07a15adf2d0c
2025-08-18 03:50:03 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:50:04 | ERROR | app.routers.purchase | Error interno al crear compra
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 111, in create_purchase_endpoint
    return PurchaseRead.model_validate(new_purchase)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        obj, strict=strict, from_attributes=from_attributes, context=context, by_alias=by_alias, by_name=by_name
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
pydantic_core._pydantic_core.ValidationError: 6 validation errors for PurchaseRead
items.0.price
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x0000028060D7D940>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.0.expiration
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x0000028060D7D940>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.1.price
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x0000028060D7E190>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.1.expiration
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x0000028060D7E190>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.2.price
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x0000028060C4E850>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.2.expiration
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x0000028060C4E850>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-08-18 03:54:01 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 03:54:01 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:54:01 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 03:54:01 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:54:01 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 03:54:01 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 03:54:01 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00199s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00375s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00301s] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00093s] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | SELECT coalesce(max(purchases.sequence_number), $1::INTEGER) AS coalesce_1 
FROM purchases 
WHERE purchases.document_id = $2::UUID AND date_part($3::VARCHAR, purchases.created_at) = $4::INTEGER
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00597s] (0, UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), 'year', 2025)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00292s] (UUID('48eb8f16-2e6d-4a2e-b1bf-90b31cb94d49'), UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), UUID('c6c405b2-df0b-4e06-9ddb-54b0a9e6159a'), UUID('e86d59fc-16ce-44bb-8de4-1a94308a8556'), UUID('640b652f-e17e-4610-8547-b7b2f56fa095'), UUID('22cf0b09-9a4b-4d81-b7ce-7b70c13f16f3'), 2, 'FAC-2025-00002', Decimal('114000.0'), Decimal('3650.0'), Decimal('21325.0'), Decimal('131675.0'), True, datetime.datetime(2025, 8, 18, 8, 54, 2, 145751), None)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchase_items (id, purchase_id, product_id, quantity, subtotal, discount, tax, total) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::NUMERIC(12, 2), $5::NUMERIC(12, 2), $6::NUMERIC(12, 2), $7::NUMERIC(12, 2), $8::NUMERIC(12, 2)), ($9::UUID, $ ... 165 characters truncated ... :NUMERIC(12, 2), $21::NUMERIC(12, 2), $22::NUMERIC(12, 2), $23::NUMERIC(12, 2), $24::NUMERIC(12, 2))
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00028s (insertmanyvalues) 1/1 (unordered)] (UUID('cf6a858b-038b-4a6c-be7c-8f06a2aee4f3'), UUID('48eb8f16-2e6d-4a2e-b1bf-90b31cb94d49'), UUID('2e8dfc22-c47d-4e84-9a5d-900de19995db'), 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), UUID('b71e02a4-cb5d-4fca-8984-0a7c5ea4038e'), UUID('48eb8f16-2e6d-4a2e-b1bf-90b31cb94d49'), UUID('c2bffa70-cb06-47f5-a67d-8d6bfe51a908'), 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), UUID('8491bdb1-ff82-47b5-838c-a4a38a52df5b'), UUID('48eb8f16-2e6d-4a2e-b1bf-90b31cb94d49'), UUID('c4be288f-9de0-4413-be7e-c57f6be627f4'), 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'))
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00254s] ('audit_level',)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00079s] (UUID('2c3f8e5a-f8f3-457a-9c0f-7b5b3f6e2f67'), 'CREATE', 'Purchase', UUID('48eb8f16-2e6d-4a2e-b1bf-90b31cb94d49'), 'Entrada creada con número FAC-2025-00002', UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | SELECT purchases.id, purchases.document_id, purchases.third_party_id, purchases.concept_id, purchases.payment_term_id, purchases.user_id, purchases.sequence_number, purchases.purchase_number, purchases.subtotal, purchases.discount, purchases.tax, purchases.total, purchases.active, purchases.created_at, purchases.updated_at 
FROM purchases 
WHERE purchases.id = $1::UUID
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00100s] (UUID('48eb8f16-2e6d-4a2e-b1bf-90b31cb94d49'),)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | SELECT purchase_items.purchase_id AS purchase_items_purchase_id, purchase_items.id AS purchase_items_id, purchase_items.product_id AS purchase_items_product_id, purchase_items.quantity AS purchase_items_quantity, purchase_items.subtotal AS purchase_items_subtotal, purchase_items.discount AS purchase_items_discount, purchase_items.tax AS purchase_items_tax, purchase_items.total AS purchase_items_total 
FROM purchase_items 
WHERE purchase_items.purchase_id IN ($1::UUID)
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | [generated in 0.00430s] (UUID('48eb8f16-2e6d-4a2e-b1bf-90b31cb94d49'),)
2025-08-18 03:54:02 | INFO | app.routers.purchase | Entrada creada: 48eb8f16-2e6d-4a2e-b1bf-90b31cb94d49 por usuario 633b2fe2-6d87-475b-864a-07a15adf2d0c
2025-08-18 03:54:02 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 03:54:02 | ERROR | app.routers.purchase | Error interno al crear compra
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 111, in create_purchase_endpoint
    return PurchaseRead.model_validate(new_purchase)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        obj, strict=strict, from_attributes=from_attributes, context=context, by_alias=by_alias, by_name=by_name
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
pydantic_core._pydantic_core.ValidationError: 6 validation errors for PurchaseRead
items.0.price
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x000001CF40B2D220>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.0.expiration
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x000001CF40B2D220>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.1.price
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x000001CF40B2D480>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.1.expiration
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x000001CF40B2D480>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.2.price
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x000001CF40B28CD0>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
items.2.expiration
  Field required [type=missing, input_value=<app.models.purchase.Purc...t at 0x000001CF40B28CD0>, input_type=PurchaseItem]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-08-18 04:15:46 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 04:15:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 04:15:46 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 04:15:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 04:15:46 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00115s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00173s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00158s] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00153s] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | SELECT coalesce(max(purchases.sequence_number), $1::INTEGER) AS coalesce_1 
FROM purchases 
WHERE purchases.document_id = $2::UUID AND date_part($3::VARCHAR, purchases.created_at) = $4::INTEGER
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00093s] (0, UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), 'year', 2025)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00188s] (UUID('840aafc4-4f6d-4d91-bb97-daa97bf1ca07'), UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), UUID('c6c405b2-df0b-4e06-9ddb-54b0a9e6159a'), UUID('e86d59fc-16ce-44bb-8de4-1a94308a8556'), UUID('640b652f-e17e-4610-8547-b7b2f56fa095'), UUID('22cf0b09-9a4b-4d81-b7ce-7b70c13f16f3'), 1, 'FAC-2025-00001', Decimal('114000.0'), Decimal('3650.0'), Decimal('21325.0'), Decimal('131675.0'), True, datetime.datetime(2025, 8, 18, 9, 15, 47, 117469), None)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchase_items (id, purchase_id, product_id, price, quantity, subtotal, discount, tax, total, expiration) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::NUMERIC(12, 2), $5::NUMERIC(12, 2), $6::NUMERIC(12, 2), $7::NUMERIC(12, 2), $8::NUMERIC(12 ... 280 characters truncated ... , 2), $26::NUMERIC(12, 2), $27::NUMERIC(12, 2), $28::NUMERIC(12, 2), $29::NUMERIC(12, 2), $30::DATE)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00031s (insertmanyvalues) 1/1 (unordered)] (UUID('836798b8-036c-41c7-a17b-babaa9360af2'), UUID('840aafc4-4f6d-4d91-bb97-daa97bf1ca07'), UUID('2e8dfc22-c47d-4e84-9a5d-900de19995db'), 0, 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), None, UUID('3cedade2-2376-45f9-96ba-076cc96e7cd6'), UUID('840aafc4-4f6d-4d91-bb97-daa97bf1ca07'), UUID('c2bffa70-cb06-47f5-a67d-8d6bfe51a908'), 0, 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), None, UUID('1a1acd7d-a884-4faa-8526-48ef8259ecbd'), UUID('840aafc4-4f6d-4d91-bb97-daa97bf1ca07'), UUID('c4be288f-9de0-4413-be7e-c57f6be627f4'), 0, 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), None)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00091s] ('audit_level',)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00186s] (UUID('062dcd2c-58c4-4bc1-b3fd-f0920e075b7a'), 'CREATE', 'Purchase', UUID('840aafc4-4f6d-4d91-bb97-daa97bf1ca07'), 'Entrada creada con número FAC-2025-00001', UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | SELECT purchases.id, purchases.document_id, purchases.third_party_id, purchases.concept_id, purchases.payment_term_id, purchases.user_id, purchases.sequence_number, purchases.purchase_number, purchases.subtotal, purchases.discount, purchases.tax, purchases.total, purchases.active, purchases.created_at, purchases.updated_at 
FROM purchases 
WHERE purchases.id = $1::UUID
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00134s] (UUID('840aafc4-4f6d-4d91-bb97-daa97bf1ca07'),)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | SELECT purchase_items.purchase_id AS purchase_items_purchase_id, purchase_items.id AS purchase_items_id, purchase_items.product_id AS purchase_items_product_id, purchase_items.price AS purchase_items_price, purchase_items.quantity AS purchase_items_quantity, purchase_items.subtotal AS purchase_items_subtotal, purchase_items.discount AS purchase_items_discount, purchase_items.tax AS purchase_items_tax, purchase_items.total AS purchase_items_total, purchase_items.expiration AS purchase_items_expiration 
FROM purchase_items 
WHERE purchase_items.purchase_id IN ($1::UUID)
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | [generated in 0.00205s] (UUID('840aafc4-4f6d-4d91-bb97-daa97bf1ca07'),)
2025-08-18 04:15:47 | INFO | app.routers.purchase | Entrada creada: 840aafc4-4f6d-4d91-bb97-daa97bf1ca07 por usuario 633b2fe2-6d87-475b-864a-07a15adf2d0c
2025-08-18 04:15:47 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 04:15:47 | ERROR | app.routers.purchase | Error interno al crear compra
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 111, in create_purchase_endpoint
    return PurchaseRead.model_validate(new_purchase)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\pydantic\main.py", line 705, in model_validate
    return cls.__pydantic_validator__.validate_python(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        obj, strict=strict, from_attributes=from_attributes, context=context, by_alias=by_alias, by_name=by_name
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
pydantic_core._pydantic_core.ValidationError: 3 validation errors for PurchaseRead
items.0.expiration
  Input should be a valid date [type=date_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/date_type
items.1.expiration
  Input should be a valid date [type=date_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/date_type
items.2.expiration
  Input should be a valid date [type=date_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/date_type
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | [generated in 0.05569s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | [generated in 0.03722s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 04:23:09 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 04:23:09 | ERROR | app.crud.purchase | Error inesperado en create_purchase
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\crud\purchase.py", line 161, in create_purchase
    doc_type = await get_document_by_id(db, purchase_in.document_id, user_id, audit_document)
                                            ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'PurchaseCreate' object has no attribute 'document_id'
2025-08-18 04:23:09 | ERROR | app.routers.purchase | Error interno al crear compra
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\crud\purchase.py", line 161, in create_purchase
    doc_type = await get_document_by_id(db, purchase_in.document_id, user_id, audit_document)
                                            ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'PurchaseCreate' object has no attribute 'document_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 107, in create_purchase_endpoint
    new_purchase = await create_purchase(db, purchase_in, current_user.id)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\app\crud\purchase.py", line 286, in create_purchase
    raise HTTPException(status_code=500, detail=f"Error interno al crear la compra: {e}")
fastapi.exceptions.HTTPException: 500: Error interno al crear la compra: 'PurchaseCreate' object has no attribute 'document_id'
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | [generated in 0.00101s] ('admin@gmail.com',)
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | [generated in 0.00428s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 04:28:03 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00080s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [cached since 6.833s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00369s] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00660s] (UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'),)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | SELECT coalesce(max(purchases.sequence_number), $1::INTEGER) AS coalesce_1 
FROM purchases 
WHERE purchases.document_id = $2::UUID AND date_part($3::VARCHAR, purchases.created_at) = $4::INTEGER
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00132s] (0, UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), 'year', 2025)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00547s] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'), UUID('7e313aea-3e7f-4c8e-8992-fff7756d1f90'), UUID('c6c405b2-df0b-4e06-9ddb-54b0a9e6159a'), UUID('e86d59fc-16ce-44bb-8de4-1a94308a8556'), UUID('640b652f-e17e-4610-8547-b7b2f56fa095'), UUID('22cf0b09-9a4b-4d81-b7ce-7b70c13f16f3'), 2, 'FAC-2025-00002', Decimal('114000.0'), Decimal('3650.0'), Decimal('21325.0'), Decimal('131675.0'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchase_items (id, purchase_id, product_id, price, quantity, subtotal, discount, tax, total, expiration) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::NUMERIC(12, 2), $5::NUMERIC(12, 2), $6::NUMERIC(12, 2), $7::NUMERIC(12, 2), $8::NUMERIC(12 ... 280 characters truncated ... , 2), $26::NUMERIC(12, 2), $27::NUMERIC(12, 2), $28::NUMERIC(12, 2), $29::NUMERIC(12, 2), $30::DATE)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00042s (insertmanyvalues) 1/1 (unordered)] (UUID('13b1878a-2e30-4e36-af29-a5483ec763b8'), UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'), UUID('2e8dfc22-c47d-4e84-9a5d-900de19995db'), 0, 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), None, UUID('fa316794-435c-4936-800f-25c45a627a23'), UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'), UUID('c2bffa70-cb06-47f5-a67d-8d6bfe51a908'), 0, 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), None, UUID('a7617221-4361-4bf0-9097-55a09d9c6cff'), UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'), UUID('c4be288f-9de0-4413-be7e-c57f6be627f4'), 0, 100, Decimal('10000.0'), Decimal('0.0'), Decimal('1900.0'), Decimal('11900.0'), None)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00364s] ('audit_level',)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00395s] (UUID('004d3e62-40af-4507-b459-0e997bd856d8'), 'CREATE', 'Purchase', UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'), 'Entrada creada con número FAC-2025-00002', UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | SELECT purchases.id, purchases.document_id, purchases.third_party_id, purchases.concept_id, purchases.payment_term_id, purchases.user_id, purchases.sequence_number, purchases.purchase_number, purchases.subtotal, purchases.discount, purchases.tax, purchases.total, purchases.active, purchases.created_at, purchases.updated_at 
FROM purchases 
WHERE purchases.id = $1::UUID
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00212s] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'),)
2025-08-18 04:28:10 | INFO | sqlalchemy.engine.Engine | SELECT purchase_items.purchase_id AS purchase_items_purchase_id, purchase_items.id AS purchase_items_id, purchase_items.product_id AS purchase_items_product_id, purchase_items.price AS purchase_items_price, purchase_items.quantity AS purchase_items_quantity, purchase_items.subtotal AS purchase_items_subtotal, purchase_items.discount AS purchase_items_discount, purchase_items.tax AS purchase_items_tax, purchase_items.total AS purchase_items_total, purchase_items.expiration AS purchase_items_expiration 
FROM purchase_items 
WHERE purchase_items.purchase_id IN ($1::UUID)
2025-08-18 04:28:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00510s] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'),)
2025-08-18 04:28:11 | INFO | app.routers.purchase | Entrada creada: 15f615be-a373-49a7-be4b-c1fe70b8a65c por usuario 633b2fe2-6d87-475b-864a-07a15adf2d0c
2025-08-18 04:28:11 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 12:44:23 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 12:44:23 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-18 12:44:23 | INFO | sqlalchemy.engine.Engine | [cached since 2.979e+04s ago] ('admin@gmail.com',)
2025-08-18 12:44:23 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 12:44:23 | INFO | sqlalchemy.engine.Engine | [cached since 2.979e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 12:44:23 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | [cached since 2.979e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | [cached since 2.98e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | SELECT purchases.id, purchases.document_id, purchases.third_party_id, purchases.concept_id, purchases.payment_term_id, purchases.user_id, purchases.sequence_number, purchases.purchase_number, purchases.subtotal, purchases.discount, purchases.tax, purchases.total, purchases.active, purchases.created_at, purchases.updated_at 
FROM purchases ORDER BY purchases.created_at DESC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | [generated in 0.00136s] (5, 0)
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | SELECT purchase_items.purchase_id AS purchase_items_purchase_id, purchase_items.id AS purchase_items_id, purchase_items.product_id AS purchase_items_product_id, purchase_items.price AS purchase_items_price, purchase_items.quantity AS purchase_items_quantity, purchase_items.subtotal AS purchase_items_subtotal, purchase_items.discount AS purchase_items_discount, purchase_items.tax AS purchase_items_tax, purchase_items.total AS purchase_items_total, purchase_items.expiration AS purchase_items_expiration 
FROM purchase_items 
WHERE purchase_items.purchase_id IN ($1::UUID, $2::UUID)
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | [cached since 2.979e+04s ago] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'), UUID('840aafc4-4f6d-4d91-bb97-daa97bf1ca07'))
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | [cached since 2.979e+04s ago] ('audit_level',)
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | [cached since 2.979e+04s ago] (UUID('1fdac6d0-9200-4c54-8ab2-4b088a3bb40d'), 'GETALL', 'Purchase', None, 'Consulta de Compras - skip=0, limit=5', UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 12:44:31 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | [cached since 2.981e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | [cached since 2.982e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | SELECT purchases.id, purchases.document_id, purchases.third_party_id, purchases.concept_id, purchases.payment_term_id, purchases.user_id, purchases.sequence_number, purchases.purchase_number, purchases.subtotal, purchases.discount, purchases.tax, purchases.total, purchases.active, purchases.created_at, purchases.updated_at 
FROM purchases 
WHERE purchases.id = $1::UUID
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | [cached since 2.981e+04s ago] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'),)
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | SELECT purchase_items.purchase_id AS purchase_items_purchase_id, purchase_items.id AS purchase_items_id, purchase_items.product_id AS purchase_items_product_id, purchase_items.price AS purchase_items_price, purchase_items.quantity AS purchase_items_quantity, purchase_items.subtotal AS purchase_items_subtotal, purchase_items.discount AS purchase_items_discount, purchase_items.tax AS purchase_items_tax, purchase_items.total AS purchase_items_total, purchase_items.expiration AS purchase_items_expiration 
FROM purchase_items 
WHERE purchase_items.purchase_id IN ($1::UUID)
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | [cached since 2.981e+04s ago] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'),)
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | [cached since 2.981e+04s ago] ('audit_level',)
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | [cached since 2.981e+04s ago] (UUID('d97805db-4d85-4e5e-8e29-f619973f787d'), 'GETID', 'Purchase', UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'), 'Consultó compra: FAC-2025-00002', UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 12:44:52 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | [cached since 2.995e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | [cached since 2.996e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | SELECT purchases.id, purchases.document_id, purchases.third_party_id, purchases.concept_id, purchases.payment_term_id, purchases.user_id, purchases.sequence_number, purchases.purchase_number, purchases.subtotal, purchases.discount, purchases.tax, purchases.total, purchases.active, purchases.created_at, purchases.updated_at 
FROM purchases 
WHERE purchases.id = $1::UUID
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | [cached since 2.995e+04s ago] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'),)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | SELECT purchase_items.purchase_id AS purchase_items_purchase_id, purchase_items.id AS purchase_items_id, purchase_items.product_id AS purchase_items_product_id, purchase_items.price AS purchase_items_price, purchase_items.quantity AS purchase_items_quantity, purchase_items.subtotal AS purchase_items_subtotal, purchase_items.discount AS purchase_items_discount, purchase_items.tax AS purchase_items_tax, purchase_items.total AS purchase_items_total, purchase_items.expiration AS purchase_items_expiration 
FROM purchase_items 
WHERE purchase_items.purchase_id IN ($1::UUID)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | [cached since 2.995e+04s ago] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'),)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | UPDATE purchases SET active=$1::BOOLEAN, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE purchases.id = $3::UUID
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00581s] (False, datetime.datetime(2025, 8, 18, 17, 47, 11, 900188), UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'))
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | [cached since 2.995e+04s ago] ('audit_level',)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | [cached since 2.995e+04s ago] (UUID('528c1c32-d09c-4b18-b24c-db5f38df538b'), 'UPDATE', 'Purchase', UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'), 'Compra cancelada.Productos afectados: 3', UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'))
2025-08-18 12:47:11 | INFO | app.crud.purchase | [deactivate_purchase] Compra 15f615be-a373-49a7-be4b-c1fe70b8a65c cancelada por el usuario 633b2fe2-6d87-475b-864a-07a15adf2d0c.
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | SELECT purchases.id, purchases.document_id, purchases.third_party_id, purchases.concept_id, purchases.payment_term_id, purchases.user_id, purchases.sequence_number, purchases.purchase_number, purchases.subtotal, purchases.discount, purchases.tax, purchases.total, purchases.active, purchases.created_at, purchases.updated_at 
FROM purchases 
WHERE purchases.id = $1::UUID
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00170s] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'),)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | SELECT purchase_items.id AS purchase_items_id, purchase_items.purchase_id AS purchase_items_purchase_id, purchase_items.product_id AS purchase_items_product_id, purchase_items.price AS purchase_items_price, purchase_items.quantity AS purchase_items_quantity, purchase_items.subtotal AS purchase_items_subtotal, purchase_items.discount AS purchase_items_discount, purchase_items.tax AS purchase_items_tax, purchase_items.total AS purchase_items_total, purchase_items.expiration AS purchase_items_expiration 
FROM purchase_items 
WHERE $1::UUID = purchase_items.purchase_id
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00355s] (UUID('15f615be-a373-49a7-be4b-c1fe70b8a65c'),)
2025-08-18 12:47:11 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 13:06:22 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 13:06:22 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 13:06:22 | INFO | sqlalchemy.engine.Engine | [cached since 3.111e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:06:22 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 13:06:22 | INFO | sqlalchemy.engine.Engine | [cached since 3.111e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:06:22 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 13:06:57 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 13:06:57 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 13:06:57 | INFO | sqlalchemy.engine.Engine | [cached since 3.114e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:06:57 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 13:06:57 | INFO | sqlalchemy.engine.Engine | [cached since 3.115e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:06:57 | INFO | app.routers.purchase | Headers después de limpieza: ['document_type_id', 'third_party_id', 'concept_id', 'FACchase_number', 'payment_terms', 'user_id', 'subtotal', 'discount', 'tax', 'total', 'active', 'items']
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 1): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 2): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 3): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 4): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 5): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 6): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 7): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 8): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 9): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 10): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 11): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 12): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 13): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 14): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 15): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 16): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 17): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 18): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 19): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 20): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 21): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 22): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 23): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 24): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 25): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 26): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 27): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 28): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 29): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | Fila con error en importación (fila 30): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:06:57 | WARNING | app.routers.purchase | No se encontraron filas válidas para importar en el archivo CSV.
2025-08-18 13:06:57 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 13:26:32 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 13:26:32 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 13:26:32 | INFO | sqlalchemy.engine.Engine | [cached since 3.231e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:26:32 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 13:26:32 | INFO | sqlalchemy.engine.Engine | [cached since 3.232e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:26:32 | INFO | app.routers.purchase | Headers después de limpieza: ['document_type_id', 'third_party_id', 'concept_id', 'FACchase_number', 'payment_terms', 'user_id', 'subtotal', 'discount', 'tax', 'total', 'active', 'items']
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 1): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 2): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 3): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 4): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 5): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 6): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 7): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 8): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 9): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 10): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 11): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 12): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 13): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 14): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 15): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 16): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 17): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 18): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 19): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 20): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 21): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 22): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 23): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 24): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 25): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 26): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 27): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 28): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 29): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | Fila con error en importación (fila 30): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:32 | WARNING | app.routers.purchase | No se encontraron filas válidas para importar en el archivo CSV.
2025-08-18 13:26:32 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 13:26:48 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 13:26:48 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 13:26:48 | INFO | sqlalchemy.engine.Engine | [cached since 3.233e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:26:48 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 13:26:48 | INFO | sqlalchemy.engine.Engine | [cached since 3.234e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:26:48 | INFO | app.routers.purchase | Headers después de limpieza: ['document_type_id', 'third_party_id', 'concept_id', 'FACchase_number', 'payment_terms', 'user_id', 'subtotal', 'discount', 'tax', 'total', 'active', 'items']
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 1): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 2): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 3): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 4): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 5): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 6): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 7): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 8): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 9): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 10): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 11): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 12): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 13): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 14): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 15): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 16): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 17): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 18): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 19): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 20): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 21): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 22): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 23): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 24): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 25): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 26): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 27): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 28): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 29): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | Fila con error en importación (fila 30): Falta 'document_id' (UUID).
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 394, in import_purchases
    raise ValueError("Falta 'document_id' (UUID).")
ValueError: Falta 'document_id' (UUID).
2025-08-18 13:26:48 | WARNING | app.routers.purchase | No se encontraron filas válidas para importar en el archivo CSV.
2025-08-18 13:26:48 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 13:45:42 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 13:45:42 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-18 13:45:42 | INFO | sqlalchemy.engine.Engine | [cached since 3.347e+04s ago] ('admin@gmail.com',)
2025-08-18 13:45:42 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 13:45:42 | INFO | sqlalchemy.engine.Engine | [cached since 3.347e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:45:42 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:45:53 | INFO | app.routers.purchase | Headers después de limpieza: ['id', 'document_id', 'third_party_id', 'concept_id', 'payment_term_id', 'user_id', 'subtotal', 'discount', 'tax', 'total', 'active', 'created_at', 'items']
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_1
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [no key 0.00091s] ()
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | SELECT coalesce(max(purchases.sequence_number), $1::INTEGER) AS coalesce_1 
FROM purchases 
WHERE purchases.document_id = $2::UUID AND date_part($3::VARCHAR, purchases.created_at) = $4::INTEGER
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] (0, '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'year', 2025)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [generated in 0.00460s] (UUID('45045dc4-c8ca-489e-ad13-cd11dc8f8215'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 3, 'FAC-2025-00003', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_1
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [no key 0.00222s] ()
2025-08-18 13:45:53 | WARNING | app.routers.purchase | Fila con error en importación (fila 1): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (45045dc4-c8ca-489e-ad13-cd11dc8f8215, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 3, FAC-2025-00003, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('45045dc4-c8ca-489e-ad13-cd11dc8f8215'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 3, 'FAC-2025-00003', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (45045dc4-c8ca-489e-ad13-cd11dc8f8215, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 3, FAC-2025-00003, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (45045dc4-c8ca-489e-ad13-cd11dc8f8215, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 3, FAC-2025-00003, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (45045dc4-c8ca-489e-ad13-cd11dc8f8215, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 3, FAC-2025-00003, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('45045dc4-c8ca-489e-ad13-cd11dc8f8215'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 3, 'FAC-2025-00003', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_2
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [no key 0.00502s] ()
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [cached since 0.1351s ago] (UUID('17fe9cfd-494c-4696-9adf-92a65905d804'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 4, 'FAC-2025-00004', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_2
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | [no key 0.00138s] ()
2025-08-18 13:45:53 | WARNING | app.routers.purchase | Fila con error en importación (fila 2): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (17fe9cfd-494c-4696-9adf-92a65905d804, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 4, FAC-2025-00004, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('17fe9cfd-494c-4696-9adf-92a65905d804'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 4, 'FAC-2025-00004', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (17fe9cfd-494c-4696-9adf-92a65905d804, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 4, FAC-2025-00004, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (17fe9cfd-494c-4696-9adf-92a65905d804, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 4, FAC-2025-00004, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (17fe9cfd-494c-4696-9adf-92a65905d804, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 4, FAC-2025-00004, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('17fe9cfd-494c-4696-9adf-92a65905d804'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 4, 'FAC-2025-00004', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:53 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_3
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.10012s] ()
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 0.4267s ago] (UUID('a8c04cfb-29d8-4a67-a549-5e7014cf274f'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 5, 'FAC-2025-00005', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_3
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.01314s] ()
2025-08-18 13:45:54 | WARNING | app.routers.purchase | Fila con error en importación (fila 3): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a8c04cfb-29d8-4a67-a549-5e7014cf274f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 5, FAC-2025-00005, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('a8c04cfb-29d8-4a67-a549-5e7014cf274f'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 5, 'FAC-2025-00005', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a8c04cfb-29d8-4a67-a549-5e7014cf274f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 5, FAC-2025-00005, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a8c04cfb-29d8-4a67-a549-5e7014cf274f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 5, FAC-2025-00005, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a8c04cfb-29d8-4a67-a549-5e7014cf274f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 5, FAC-2025-00005, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('a8c04cfb-29d8-4a67-a549-5e7014cf274f'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 5, 'FAC-2025-00005', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_4
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00069s] ()
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 0.5428s ago] (UUID('ad721421-3f4e-457d-993b-f438812a67f3'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 6, 'FAC-2025-00006', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_4
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00187s] ()
2025-08-18 13:45:54 | WARNING | app.routers.purchase | Fila con error en importación (fila 4): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (ad721421-3f4e-457d-993b-f438812a67f3, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 6, FAC-2025-00006, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('ad721421-3f4e-457d-993b-f438812a67f3'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 6, 'FAC-2025-00006', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (ad721421-3f4e-457d-993b-f438812a67f3, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 6, FAC-2025-00006, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (ad721421-3f4e-457d-993b-f438812a67f3, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 6, FAC-2025-00006, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (ad721421-3f4e-457d-993b-f438812a67f3, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 6, FAC-2025-00006, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('ad721421-3f4e-457d-993b-f438812a67f3'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 6, 'FAC-2025-00006', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_5
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00076s] ()
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 0.6367s ago] (UUID('2f1bdca8-44f5-4ba9-88ef-c83ee8b43a0c'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 7, 'FAC-2025-00007', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_5
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00060s] ()
2025-08-18 13:45:54 | WARNING | app.routers.purchase | Fila con error en importación (fila 5): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2f1bdca8-44f5-4ba9-88ef-c83ee8b43a0c, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 7, FAC-2025-00007, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('2f1bdca8-44f5-4ba9-88ef-c83ee8b43a0c'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 7, 'FAC-2025-00007', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2f1bdca8-44f5-4ba9-88ef-c83ee8b43a0c, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 7, FAC-2025-00007, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2f1bdca8-44f5-4ba9-88ef-c83ee8b43a0c, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 7, FAC-2025-00007, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2f1bdca8-44f5-4ba9-88ef-c83ee8b43a0c, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 7, FAC-2025-00007, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('2f1bdca8-44f5-4ba9-88ef-c83ee8b43a0c'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 7, 'FAC-2025-00007', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_6
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00157s] ()
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 0.726s ago] (UUID('f6598ac0-c3f5-4001-9ce2-08a983c74d27'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 8, 'FAC-2025-00008', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_6
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00413s] ()
2025-08-18 13:45:54 | WARNING | app.routers.purchase | Fila con error en importación (fila 6): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f6598ac0-c3f5-4001-9ce2-08a983c74d27, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 8, FAC-2025-00008, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('f6598ac0-c3f5-4001-9ce2-08a983c74d27'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 8, 'FAC-2025-00008', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f6598ac0-c3f5-4001-9ce2-08a983c74d27, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 8, FAC-2025-00008, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f6598ac0-c3f5-4001-9ce2-08a983c74d27, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 8, FAC-2025-00008, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f6598ac0-c3f5-4001-9ce2-08a983c74d27, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 8, FAC-2025-00008, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('f6598ac0-c3f5-4001-9ce2-08a983c74d27'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 8, 'FAC-2025-00008', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_7
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00067s] ()
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 0.8258s ago] (UUID('c8366fcc-435a-4a43-9943-fbb34ea38fad'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 9, 'FAC-2025-00009', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_7
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00536s] ()
2025-08-18 13:45:54 | WARNING | app.routers.purchase | Fila con error en importación (fila 7): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c8366fcc-435a-4a43-9943-fbb34ea38fad, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 9, FAC-2025-00009, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('c8366fcc-435a-4a43-9943-fbb34ea38fad'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 9, 'FAC-2025-00009', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c8366fcc-435a-4a43-9943-fbb34ea38fad, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 9, FAC-2025-00009, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c8366fcc-435a-4a43-9943-fbb34ea38fad, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 9, FAC-2025-00009, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c8366fcc-435a-4a43-9943-fbb34ea38fad, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 9, FAC-2025-00009, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('c8366fcc-435a-4a43-9943-fbb34ea38fad'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 9, 'FAC-2025-00009', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_8
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00830s] ()
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 0.9273s ago] (UUID('91fce987-ec50-4fcd-9131-c161746247c7'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 10, 'FAC-2025-00010', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_8
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00112s] ()
2025-08-18 13:45:54 | WARNING | app.routers.purchase | Fila con error en importación (fila 8): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (91fce987-ec50-4fcd-9131-c161746247c7, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 10, FAC-2025-00010, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('91fce987-ec50-4fcd-9131-c161746247c7'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 10, 'FAC-2025-00010', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (91fce987-ec50-4fcd-9131-c161746247c7, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 10, FAC-2025-00010, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (91fce987-ec50-4fcd-9131-c161746247c7, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 10, FAC-2025-00010, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (91fce987-ec50-4fcd-9131-c161746247c7, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 10, FAC-2025-00010, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('91fce987-ec50-4fcd-9131-c161746247c7'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 10, 'FAC-2025-00010', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_9
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00064s] ()
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 1.042s ago] (UUID('84b8793d-9710-46a6-b228-ff2b0d933a33'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 11, 'FAC-2025-00011', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_9
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00529s] ()
2025-08-18 13:45:54 | WARNING | app.routers.purchase | Fila con error en importación (fila 9): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (84b8793d-9710-46a6-b228-ff2b0d933a33, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 11, FAC-2025-00011, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('84b8793d-9710-46a6-b228-ff2b0d933a33'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 11, 'FAC-2025-00011', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (84b8793d-9710-46a6-b228-ff2b0d933a33, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 11, FAC-2025-00011, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (84b8793d-9710-46a6-b228-ff2b0d933a33, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 11, FAC-2025-00011, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (84b8793d-9710-46a6-b228-ff2b0d933a33, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 11, FAC-2025-00011, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('84b8793d-9710-46a6-b228-ff2b0d933a33'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 11, 'FAC-2025-00011', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_10
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00907s] ()
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 1.144s ago] (UUID('cf30ee9b-cec2-45b8-b4ec-fec4f26d21e5'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 12, 'FAC-2025-00012', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_10
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00090s] ()
2025-08-18 13:45:54 | WARNING | app.routers.purchase | Fila con error en importación (fila 10): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (cf30ee9b-cec2-45b8-b4ec-fec4f26d21e5, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 12, FAC-2025-00012, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('cf30ee9b-cec2-45b8-b4ec-fec4f26d21e5'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 12, 'FAC-2025-00012', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (cf30ee9b-cec2-45b8-b4ec-fec4f26d21e5, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 12, FAC-2025-00012, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (cf30ee9b-cec2-45b8-b4ec-fec4f26d21e5, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 12, FAC-2025-00012, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (cf30ee9b-cec2-45b8-b4ec-fec4f26d21e5, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 12, FAC-2025-00012, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('cf30ee9b-cec2-45b8-b4ec-fec4f26d21e5'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 12, 'FAC-2025-00012', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_11
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00061s] ()
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [cached since 1.256s ago] (UUID('706c19f6-d7ac-4508-9193-50052419f65a'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 13, 'FAC-2025-00013', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_11
2025-08-18 13:45:54 | INFO | sqlalchemy.engine.Engine | [no key 0.00064s] ()
2025-08-18 13:45:54 | WARNING | app.routers.purchase | Fila con error en importación (fila 11): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (706c19f6-d7ac-4508-9193-50052419f65a, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 13, FAC-2025-00013, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('706c19f6-d7ac-4508-9193-50052419f65a'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 13, 'FAC-2025-00013', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (706c19f6-d7ac-4508-9193-50052419f65a, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 13, FAC-2025-00013, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (706c19f6-d7ac-4508-9193-50052419f65a, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 13, FAC-2025-00013, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (706c19f6-d7ac-4508-9193-50052419f65a, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 13, FAC-2025-00013, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('706c19f6-d7ac-4508-9193-50052419f65a'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 13, 'FAC-2025-00013', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_12
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.00065s] ()
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 1.359s ago] (UUID('39e25cfd-8fa4-4f1c-a6f7-cfb772418508'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 14, 'FAC-2025-00014', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_12
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.00486s] ()
2025-08-18 13:45:55 | WARNING | app.routers.purchase | Fila con error en importación (fila 12): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (39e25cfd-8fa4-4f1c-a6f7-cfb772418508, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 14, FAC-2025-00014, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('39e25cfd-8fa4-4f1c-a6f7-cfb772418508'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 14, 'FAC-2025-00014', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (39e25cfd-8fa4-4f1c-a6f7-cfb772418508, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 14, FAC-2025-00014, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (39e25cfd-8fa4-4f1c-a6f7-cfb772418508, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 14, FAC-2025-00014, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (39e25cfd-8fa4-4f1c-a6f7-cfb772418508, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 14, FAC-2025-00014, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('39e25cfd-8fa4-4f1c-a6f7-cfb772418508'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 14, 'FAC-2025-00014', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_13
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.00113s] ()
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 1.472s ago] (UUID('5b03da52-c8db-4cb9-9312-6fc1bc5856d7'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 15, 'FAC-2025-00015', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_13
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.00065s] ()
2025-08-18 13:45:55 | WARNING | app.routers.purchase | Fila con error en importación (fila 13): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5b03da52-c8db-4cb9-9312-6fc1bc5856d7, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 15, FAC-2025-00015, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('5b03da52-c8db-4cb9-9312-6fc1bc5856d7'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 15, 'FAC-2025-00015', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5b03da52-c8db-4cb9-9312-6fc1bc5856d7, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 15, FAC-2025-00015, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5b03da52-c8db-4cb9-9312-6fc1bc5856d7, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 15, FAC-2025-00015, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5b03da52-c8db-4cb9-9312-6fc1bc5856d7, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 15, FAC-2025-00015, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('5b03da52-c8db-4cb9-9312-6fc1bc5856d7'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 15, 'FAC-2025-00015', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_14
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.00080s] ()
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 1.578s ago] (UUID('2cfb0a05-58b4-4166-8285-46840758057e'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 16, 'FAC-2025-00016', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_14
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.00090s] ()
2025-08-18 13:45:55 | WARNING | app.routers.purchase | Fila con error en importación (fila 14): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2cfb0a05-58b4-4166-8285-46840758057e, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 16, FAC-2025-00016, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('2cfb0a05-58b4-4166-8285-46840758057e'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 16, 'FAC-2025-00016', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2cfb0a05-58b4-4166-8285-46840758057e, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 16, FAC-2025-00016, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2cfb0a05-58b4-4166-8285-46840758057e, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 16, FAC-2025-00016, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2cfb0a05-58b4-4166-8285-46840758057e, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 16, FAC-2025-00016, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('2cfb0a05-58b4-4166-8285-46840758057e'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 16, 'FAC-2025-00016', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_15
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.00096s] ()
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 1.757s ago] (UUID('423eb3a9-5b5b-4aea-bd25-1f9182551f4e'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 17, 'FAC-2025-00017', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_15
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.00114s] ()
2025-08-18 13:45:55 | WARNING | app.routers.purchase | Fila con error en importación (fila 15): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (423eb3a9-5b5b-4aea-bd25-1f9182551f4e, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 17, FAC-2025-00017, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('423eb3a9-5b5b-4aea-bd25-1f9182551f4e'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 17, 'FAC-2025-00017', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (423eb3a9-5b5b-4aea-bd25-1f9182551f4e, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 17, FAC-2025-00017, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (423eb3a9-5b5b-4aea-bd25-1f9182551f4e, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 17, FAC-2025-00017, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (423eb3a9-5b5b-4aea-bd25-1f9182551f4e, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 17, FAC-2025-00017, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('423eb3a9-5b5b-4aea-bd25-1f9182551f4e'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 17, 'FAC-2025-00017', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_16
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.10056s] ()
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [cached since 2.178s ago] (UUID('1f1f6993-0de6-422d-9dcc-545f54876e09'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 18, 'FAC-2025-00018', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_16
2025-08-18 13:45:55 | INFO | sqlalchemy.engine.Engine | [no key 0.00137s] ()
2025-08-18 13:45:55 | WARNING | app.routers.purchase | Fila con error en importación (fila 16): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (1f1f6993-0de6-422d-9dcc-545f54876e09, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 18, FAC-2025-00018, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('1f1f6993-0de6-422d-9dcc-545f54876e09'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 18, 'FAC-2025-00018', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (1f1f6993-0de6-422d-9dcc-545f54876e09, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 18, FAC-2025-00018, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (1f1f6993-0de6-422d-9dcc-545f54876e09, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 18, FAC-2025-00018, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (1f1f6993-0de6-422d-9dcc-545f54876e09, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 18, FAC-2025-00018, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('1f1f6993-0de6-422d-9dcc-545f54876e09'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 18, 'FAC-2025-00018', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_17
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [no key 0.00113s] ()
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [cached since 2.35s ago] (UUID('d37db232-f352-48a1-921c-7445d298191d'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 19, 'FAC-2025-00019', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_17
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [no key 0.00356s] ()
2025-08-18 13:45:56 | WARNING | app.routers.purchase | Fila con error en importación (fila 17): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (d37db232-f352-48a1-921c-7445d298191d, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 19, FAC-2025-00019, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('d37db232-f352-48a1-921c-7445d298191d'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 19, 'FAC-2025-00019', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (d37db232-f352-48a1-921c-7445d298191d, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 19, FAC-2025-00019, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (d37db232-f352-48a1-921c-7445d298191d, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 19, FAC-2025-00019, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (d37db232-f352-48a1-921c-7445d298191d, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 19, FAC-2025-00019, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('d37db232-f352-48a1-921c-7445d298191d'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 19, 'FAC-2025-00019', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_18
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [no key 0.00093s] ()
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [cached since 2.486s ago] (UUID('a41dd0d7-81a0-40bd-97b0-7198aa208110'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 20, 'FAC-2025-00020', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_18
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [no key 0.00096s] ()
2025-08-18 13:45:56 | WARNING | app.routers.purchase | Fila con error en importación (fila 18): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a41dd0d7-81a0-40bd-97b0-7198aa208110, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 20, FAC-2025-00020, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('a41dd0d7-81a0-40bd-97b0-7198aa208110'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 20, 'FAC-2025-00020', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a41dd0d7-81a0-40bd-97b0-7198aa208110, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 20, FAC-2025-00020, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a41dd0d7-81a0-40bd-97b0-7198aa208110, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 20, FAC-2025-00020, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a41dd0d7-81a0-40bd-97b0-7198aa208110, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 20, FAC-2025-00020, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('a41dd0d7-81a0-40bd-97b0-7198aa208110'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 20, 'FAC-2025-00020', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_19
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [no key 0.00944s] ()
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [cached since 3.348e+04s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [cached since 2.624s ago] (UUID('cf7fff5a-b25e-4acc-93c1-42818ce2836f'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 21, 'FAC-2025-00021', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_19
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | [no key 0.00111s] ()
2025-08-18 13:45:56 | WARNING | app.routers.purchase | Fila con error en importación (fila 19): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (cf7fff5a-b25e-4acc-93c1-42818ce2836f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 21, FAC-2025-00021, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('cf7fff5a-b25e-4acc-93c1-42818ce2836f'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 21, 'FAC-2025-00021', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (cf7fff5a-b25e-4acc-93c1-42818ce2836f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 21, FAC-2025-00021, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (cf7fff5a-b25e-4acc-93c1-42818ce2836f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 21, FAC-2025-00021, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (cf7fff5a-b25e-4acc-93c1-42818ce2836f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 21, FAC-2025-00021, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('cf7fff5a-b25e-4acc-93c1-42818ce2836f'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 21, 'FAC-2025-00021', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:45:56 | WARNING | app.routers.purchase | No se encontraron filas válidas para importar en el archivo CSV.
2025-08-18 13:45:56 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.created_at, users.updated_at, users.user_id 
FROM users 
WHERE users.id = $1::UUID
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [generated in 0.00224s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SELECT audit_logs.user_id AS audit_logs_user_id, audit_logs.id AS audit_logs_id, audit_logs.action AS audit_logs_action, audit_logs.entity AS audit_logs_entity, audit_logs.entity_id AS audit_logs_entity_id, audit_logs.description AS audit_logs_description, audit_logs.created_at AS audit_logs_created_at 
FROM audit_logs 
WHERE audit_logs.user_id IN ($1::UUID)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [generated in 0.00333s] (UUID('633b2fe2-6d87-475b-864a-07a15adf2d0c'),)
2025-08-18 13:47:29 | INFO | app.routers.purchase | Headers después de limpieza: ['id', 'document_id', 'third_party_id', 'concept_id', 'payment_term_id', 'user_id', 'subtotal', 'discount', 'tax', 'total', 'active', 'created_at', 'items']
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_1
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [no key 0.00084s] ()
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [generated in 0.00177s] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SELECT coalesce(max(purchases.sequence_number), $1::INTEGER) AS coalesce_1 
FROM purchases 
WHERE purchases.document_id = $2::UUID AND date_part($3::VARCHAR, purchases.created_at) = $4::INTEGER
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [generated in 0.00160s] (0, '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'year', 2025)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [generated in 0.00532s] (UUID('889840c4-3b27-43ed-8bbd-0ad91cb17242'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 3, 'FAC-2025-00003', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_1
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [no key 0.00082s] ()
2025-08-18 13:47:29 | WARNING | app.routers.purchase | Fila con error en importación (fila 1): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (889840c4-3b27-43ed-8bbd-0ad91cb17242, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 3, FAC-2025-00003, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('889840c4-3b27-43ed-8bbd-0ad91cb17242'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 3, 'FAC-2025-00003', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (889840c4-3b27-43ed-8bbd-0ad91cb17242, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 3, FAC-2025-00003, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (889840c4-3b27-43ed-8bbd-0ad91cb17242, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 3, FAC-2025-00003, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (889840c4-3b27-43ed-8bbd-0ad91cb17242, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 3, FAC-2025-00003, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('889840c4-3b27-43ed-8bbd-0ad91cb17242'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 3, 'FAC-2025-00003', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_2
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [no key 0.00094s] ()
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [cached since 0.1639s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [cached since 0.09831s ago] (UUID('75a8fc4f-9bfc-412b-9264-364207ab7d66'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 4, 'FAC-2025-00004', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_2
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [no key 0.00126s] ()
2025-08-18 13:47:29 | WARNING | app.routers.purchase | Fila con error en importación (fila 2): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (75a8fc4f-9bfc-412b-9264-364207ab7d66, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 4, FAC-2025-00004, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('75a8fc4f-9bfc-412b-9264-364207ab7d66'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 4, 'FAC-2025-00004', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (75a8fc4f-9bfc-412b-9264-364207ab7d66, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 4, FAC-2025-00004, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (75a8fc4f-9bfc-412b-9264-364207ab7d66, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 4, FAC-2025-00004, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (75a8fc4f-9bfc-412b-9264-364207ab7d66, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 4, FAC-2025-00004, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('75a8fc4f-9bfc-412b-9264-364207ab7d66'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 4, 'FAC-2025-00004', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_3
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [no key 0.00099s] ()
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [cached since 0.2448s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [cached since 0.1784s ago] (UUID('0b4717ea-22b4-4934-a704-9ee6d7848acf'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 5, 'FAC-2025-00005', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_3
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [no key 0.00072s] ()
2025-08-18 13:47:29 | WARNING | app.routers.purchase | Fila con error en importación (fila 3): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (0b4717ea-22b4-4934-a704-9ee6d7848acf, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 5, FAC-2025-00005, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('0b4717ea-22b4-4934-a704-9ee6d7848acf'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 5, 'FAC-2025-00005', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (0b4717ea-22b4-4934-a704-9ee6d7848acf, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 5, FAC-2025-00005, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (0b4717ea-22b4-4934-a704-9ee6d7848acf, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 5, FAC-2025-00005, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (0b4717ea-22b4-4934-a704-9ee6d7848acf, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 5, FAC-2025-00005, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('0b4717ea-22b4-4934-a704-9ee6d7848acf'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 5, 'FAC-2025-00005', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_4
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [no key 0.00096s] ()
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [cached since 0.3185s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [cached since 0.2549s ago] (UUID('21ab1a0c-7106-436f-a6fe-4092e4141eb2'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 6, 'FAC-2025-00006', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_4
2025-08-18 13:47:29 | INFO | sqlalchemy.engine.Engine | [no key 0.00090s] ()
2025-08-18 13:47:29 | WARNING | app.routers.purchase | Fila con error en importación (fila 4): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (21ab1a0c-7106-436f-a6fe-4092e4141eb2, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 6, FAC-2025-00006, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('21ab1a0c-7106-436f-a6fe-4092e4141eb2'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 6, 'FAC-2025-00006', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (21ab1a0c-7106-436f-a6fe-4092e4141eb2, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 6, FAC-2025-00006, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (21ab1a0c-7106-436f-a6fe-4092e4141eb2, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 6, FAC-2025-00006, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (21ab1a0c-7106-436f-a6fe-4092e4141eb2, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 6, FAC-2025-00006, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('21ab1a0c-7106-436f-a6fe-4092e4141eb2'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 6, 'FAC-2025-00006', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_5
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00089s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.4s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.336s ago] (UUID('857aca77-77e7-4001-8ab6-648e83821fb0'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 7, 'FAC-2025-00007', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_5
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00096s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 5): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (857aca77-77e7-4001-8ab6-648e83821fb0, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 7, FAC-2025-00007, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('857aca77-77e7-4001-8ab6-648e83821fb0'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 7, 'FAC-2025-00007', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (857aca77-77e7-4001-8ab6-648e83821fb0, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 7, FAC-2025-00007, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (857aca77-77e7-4001-8ab6-648e83821fb0, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 7, FAC-2025-00007, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (857aca77-77e7-4001-8ab6-648e83821fb0, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 7, FAC-2025-00007, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('857aca77-77e7-4001-8ab6-648e83821fb0'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 7, 'FAC-2025-00007', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_6
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00098s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.4759s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.41s ago] (UUID('422d7edd-41c7-43a1-8f6b-eb2d9c81c2fb'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 8, 'FAC-2025-00008', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_6
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00087s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 6): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (422d7edd-41c7-43a1-8f6b-eb2d9c81c2fb, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 8, FAC-2025-00008, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('422d7edd-41c7-43a1-8f6b-eb2d9c81c2fb'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 8, 'FAC-2025-00008', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (422d7edd-41c7-43a1-8f6b-eb2d9c81c2fb, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 8, FAC-2025-00008, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (422d7edd-41c7-43a1-8f6b-eb2d9c81c2fb, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 8, FAC-2025-00008, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (422d7edd-41c7-43a1-8f6b-eb2d9c81c2fb, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 8, FAC-2025-00008, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('422d7edd-41c7-43a1-8f6b-eb2d9c81c2fb'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 8, 'FAC-2025-00008', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_7
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00102s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.5479s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.4816s ago] (UUID('46086a69-9f51-4ead-9934-ed82f63e64e4'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 9, 'FAC-2025-00009', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_7
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00106s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 7): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (46086a69-9f51-4ead-9934-ed82f63e64e4, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 9, FAC-2025-00009, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('46086a69-9f51-4ead-9934-ed82f63e64e4'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 9, 'FAC-2025-00009', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (46086a69-9f51-4ead-9934-ed82f63e64e4, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 9, FAC-2025-00009, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (46086a69-9f51-4ead-9934-ed82f63e64e4, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 9, FAC-2025-00009, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (46086a69-9f51-4ead-9934-ed82f63e64e4, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 9, FAC-2025-00009, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('46086a69-9f51-4ead-9934-ed82f63e64e4'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 9, 'FAC-2025-00009', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_8
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00095s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.6227s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.5572s ago] (UUID('d63ddd61-c77a-4c33-88cf-169323f8c2fa'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 10, 'FAC-2025-00010', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_8
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00090s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 8): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (d63ddd61-c77a-4c33-88cf-169323f8c2fa, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 10, FAC-2025-00010, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('d63ddd61-c77a-4c33-88cf-169323f8c2fa'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 10, 'FAC-2025-00010', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (d63ddd61-c77a-4c33-88cf-169323f8c2fa, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 10, FAC-2025-00010, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (d63ddd61-c77a-4c33-88cf-169323f8c2fa, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 10, FAC-2025-00010, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (d63ddd61-c77a-4c33-88cf-169323f8c2fa, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 10, FAC-2025-00010, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('d63ddd61-c77a-4c33-88cf-169323f8c2fa'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 10, 'FAC-2025-00010', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_9
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00179s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.6953s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.629s ago] (UUID('da9f161a-0f0b-439d-812b-3e3287751b23'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 11, 'FAC-2025-00011', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_9
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00139s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 9): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (da9f161a-0f0b-439d-812b-3e3287751b23, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 11, FAC-2025-00011, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('da9f161a-0f0b-439d-812b-3e3287751b23'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 11, 'FAC-2025-00011', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (da9f161a-0f0b-439d-812b-3e3287751b23, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 11, FAC-2025-00011, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (da9f161a-0f0b-439d-812b-3e3287751b23, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 11, FAC-2025-00011, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (da9f161a-0f0b-439d-812b-3e3287751b23, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 11, FAC-2025-00011, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('da9f161a-0f0b-439d-812b-3e3287751b23'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 11, 'FAC-2025-00011', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_10
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00089s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.767s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.7025s ago] (UUID('02cf78cf-26a8-47c7-ab56-cf24f1f6842b'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 12, 'FAC-2025-00012', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_10
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00089s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 10): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (02cf78cf-26a8-47c7-ab56-cf24f1f6842b, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 12, FAC-2025-00012, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('02cf78cf-26a8-47c7-ab56-cf24f1f6842b'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 12, 'FAC-2025-00012', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (02cf78cf-26a8-47c7-ab56-cf24f1f6842b, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 12, FAC-2025-00012, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (02cf78cf-26a8-47c7-ab56-cf24f1f6842b, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 12, FAC-2025-00012, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (02cf78cf-26a8-47c7-ab56-cf24f1f6842b, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 12, FAC-2025-00012, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('02cf78cf-26a8-47c7-ab56-cf24f1f6842b'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 12, 'FAC-2025-00012', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_11
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00163s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.8432s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.7767s ago] (UUID('6fc9f9a9-3a68-47e7-9483-8bd5b7ce9cec'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 13, 'FAC-2025-00013', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_11
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00085s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 11): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6fc9f9a9-3a68-47e7-9483-8bd5b7ce9cec, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 13, FAC-2025-00013, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('6fc9f9a9-3a68-47e7-9483-8bd5b7ce9cec'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 13, 'FAC-2025-00013', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6fc9f9a9-3a68-47e7-9483-8bd5b7ce9cec, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 13, FAC-2025-00013, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6fc9f9a9-3a68-47e7-9483-8bd5b7ce9cec, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 13, FAC-2025-00013, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6fc9f9a9-3a68-47e7-9483-8bd5b7ce9cec, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 13, FAC-2025-00013, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('6fc9f9a9-3a68-47e7-9483-8bd5b7ce9cec'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 13, 'FAC-2025-00013', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_12
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00096s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.9083s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.8421s ago] (UUID('0b12a2d7-4cff-43e5-8522-ecdf7ef41658'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 14, 'FAC-2025-00014', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_12
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00087s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 12): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (0b12a2d7-4cff-43e5-8522-ecdf7ef41658, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 14, FAC-2025-00014, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('0b12a2d7-4cff-43e5-8522-ecdf7ef41658'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 14, 'FAC-2025-00014', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (0b12a2d7-4cff-43e5-8522-ecdf7ef41658, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 14, FAC-2025-00014, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (0b12a2d7-4cff-43e5-8522-ecdf7ef41658, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 14, FAC-2025-00014, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (0b12a2d7-4cff-43e5-8522-ecdf7ef41658, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 14, FAC-2025-00014, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('0b12a2d7-4cff-43e5-8522-ecdf7ef41658'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 14, 'FAC-2025-00014', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_13
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00092s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.9774s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.9114s ago] (UUID('759ce776-3dc1-4163-8b20-78790c37e4cb'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 15, 'FAC-2025-00015', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_13
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00365s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 13): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (759ce776-3dc1-4163-8b20-78790c37e4cb, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 15, FAC-2025-00015, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('759ce776-3dc1-4163-8b20-78790c37e4cb'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 15, 'FAC-2025-00015', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (759ce776-3dc1-4163-8b20-78790c37e4cb, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 15, FAC-2025-00015, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (759ce776-3dc1-4163-8b20-78790c37e4cb, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 15, FAC-2025-00015, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (759ce776-3dc1-4163-8b20-78790c37e4cb, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 15, FAC-2025-00015, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('759ce776-3dc1-4163-8b20-78790c37e4cb'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 15, 'FAC-2025-00015', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_14
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00156s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 1.047s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 0.9811s ago] (UUID('2ee146a9-418e-4ef2-90c5-012164aaec7f'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 16, 'FAC-2025-00016', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_14
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00111s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 14): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2ee146a9-418e-4ef2-90c5-012164aaec7f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 16, FAC-2025-00016, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('2ee146a9-418e-4ef2-90c5-012164aaec7f'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 16, 'FAC-2025-00016', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2ee146a9-418e-4ef2-90c5-012164aaec7f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 16, FAC-2025-00016, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2ee146a9-418e-4ef2-90c5-012164aaec7f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 16, FAC-2025-00016, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (2ee146a9-418e-4ef2-90c5-012164aaec7f, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 16, FAC-2025-00016, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('2ee146a9-418e-4ef2-90c5-012164aaec7f'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 16, 'FAC-2025-00016', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_15
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00085s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 1.117s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 1.06s ago] (UUID('c797e5ac-2255-4fc8-93fe-c59f85d772b8'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 17, 'FAC-2025-00017', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_15
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00089s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 15): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c797e5ac-2255-4fc8-93fe-c59f85d772b8, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 17, FAC-2025-00017, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('c797e5ac-2255-4fc8-93fe-c59f85d772b8'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 17, 'FAC-2025-00017', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c797e5ac-2255-4fc8-93fe-c59f85d772b8, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 17, FAC-2025-00017, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c797e5ac-2255-4fc8-93fe-c59f85d772b8, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 17, FAC-2025-00017, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c797e5ac-2255-4fc8-93fe-c59f85d772b8, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 17, FAC-2025-00017, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('c797e5ac-2255-4fc8-93fe-c59f85d772b8'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 17, 'FAC-2025-00017', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_16
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00105s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 1.193s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 1.127s ago] (UUID('68eaf72a-926f-4635-901d-dbe2adcb6596'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 18, 'FAC-2025-00018', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_16
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00089s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 16): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (68eaf72a-926f-4635-901d-dbe2adcb6596, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 18, FAC-2025-00018, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('68eaf72a-926f-4635-901d-dbe2adcb6596'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 18, 'FAC-2025-00018', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (68eaf72a-926f-4635-901d-dbe2adcb6596, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 18, FAC-2025-00018, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (68eaf72a-926f-4635-901d-dbe2adcb6596, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 18, FAC-2025-00018, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (68eaf72a-926f-4635-901d-dbe2adcb6596, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 18, FAC-2025-00018, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('68eaf72a-926f-4635-901d-dbe2adcb6596'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 18, 'FAC-2025-00018', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_17
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00099s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 1.258s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 1.191s ago] (UUID('f385b0e1-62cd-432a-b498-56e8f718da49'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 19, 'FAC-2025-00019', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_17
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00091s] ()
2025-08-18 13:47:30 | WARNING | app.routers.purchase | Fila con error en importación (fila 17): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f385b0e1-62cd-432a-b498-56e8f718da49, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 19, FAC-2025-00019, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('f385b0e1-62cd-432a-b498-56e8f718da49'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 19, 'FAC-2025-00019', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f385b0e1-62cd-432a-b498-56e8f718da49, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 19, FAC-2025-00019, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f385b0e1-62cd-432a-b498-56e8f718da49, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 19, FAC-2025-00019, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f385b0e1-62cd-432a-b498-56e8f718da49, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 19, FAC-2025-00019, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('f385b0e1-62cd-432a-b498-56e8f718da49'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 19, 'FAC-2025-00019', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_18
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00086s] ()
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 1.323s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [cached since 1.257s ago] (UUID('3a098fde-ce7d-4a0b-9459-5d68e47bf95d'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 20, 'FAC-2025-00020', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_18
2025-08-18 13:47:30 | INFO | sqlalchemy.engine.Engine | [no key 0.00085s] ()
2025-08-18 13:47:31 | WARNING | app.routers.purchase | Fila con error en importación (fila 18): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (3a098fde-ce7d-4a0b-9459-5d68e47bf95d, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 20, FAC-2025-00020, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('3a098fde-ce7d-4a0b-9459-5d68e47bf95d'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 20, 'FAC-2025-00020', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (3a098fde-ce7d-4a0b-9459-5d68e47bf95d, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 20, FAC-2025-00020, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (3a098fde-ce7d-4a0b-9459-5d68e47bf95d, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 20, FAC-2025-00020, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (3a098fde-ce7d-4a0b-9459-5d68e47bf95d, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 20, FAC-2025-00020, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('3a098fde-ce7d-4a0b-9459-5d68e47bf95d'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 20, 'FAC-2025-00020', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:31 | INFO | sqlalchemy.engine.Engine | SAVEPOINT sa_savepoint_19
2025-08-18 13:47:31 | INFO | sqlalchemy.engine.Engine | [no key 0.00106s] ()
2025-08-18 13:47:31 | INFO | sqlalchemy.engine.Engine | SELECT documents.id, documents.code, documents.name, documents.description, documents.document_type, documents.prefix, documents.active, documents.user_id, documents.created_at, documents.updated_at 
FROM documents 
WHERE documents.id = $1::UUID FOR UPDATE
2025-08-18 13:47:31 | INFO | sqlalchemy.engine.Engine | [cached since 1.392s ago] ('7e313aea-3e7f-4c8e-8992-fff7756d1f90',)
2025-08-18 13:47:31 | INFO | sqlalchemy.engine.Engine | INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)
2025-08-18 13:47:31 | INFO | sqlalchemy.engine.Engine | [cached since 1.326s ago] (UUID('b7469089-f729-4655-9cb7-63b96bc53768'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 21, 'FAC-2025-00021', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)
2025-08-18 13:47:31 | INFO | sqlalchemy.engine.Engine | ROLLBACK TO SAVEPOINT sa_savepoint_19
2025-08-18 13:47:31 | INFO | sqlalchemy.engine.Engine | [no key 0.00089s] ()
2025-08-18 13:47:31 | WARNING | app.routers.purchase | Fila con error en importación (fila 19): (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (b7469089-f729-4655-9cb7-63b96bc53768, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 21, FAC-2025-00021, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('b7469089-f729-4655-9cb7-63b96bc53768'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 21, 'FAC-2025-00021', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (b7469089-f729-4655-9cb7-63b96bc53768, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 21, FAC-2025-00021, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (b7469089-f729-4655-9cb7-63b96bc53768, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 21, FAC-2025-00021, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\app\routers\purchase.py", line 470, in import_purchases
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «payment_term_id» de la relación «purchases» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (b7469089-f729-4655-9cb7-63b96bc53768, 7e313aea-3e7f-4c8e-8992-fff7756d1f90, c6c405b2-df0b-4e06-9ddb-54b0a9e6159a, e86d59fc-16ce-44bb-8de4-1a94308a8556, 21, FAC-2025-00021, 22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3, 114000.00, 3650.00, 21325.00, 131675.00, t, 2025-08-18 09:28:10.889813, null, null).
[SQL: INSERT INTO purchases (id, document_id, third_party_id, concept_id, payment_term_id, user_id, sequence_number, purchase_number, subtotal, discount, tax, total, active, created_at, updated_at) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::INTEGER, $8::VARCHAR, $9::NUMERIC(12, 2), $10::NUMERIC(12, 2), $11::NUMERIC(12, 2), $12::NUMERIC(12, 2), $13::BOOLEAN, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('b7469089-f729-4655-9cb7-63b96bc53768'), '7e313aea-3e7f-4c8e-8992-fff7756d1f90', 'c6c405b2-df0b-4e06-9ddb-54b0a9e6159a', 'e86d59fc-16ce-44bb-8de4-1a94308a8556', None, '22cf0b09-9a4b-4d81-b7c2-7b70c13f16f3', 21, 'FAC-2025-00021', Decimal('114000.00'), Decimal('3650.00'), Decimal('21325.00'), Decimal('131675.00'), True, datetime.datetime(2025, 8, 18, 9, 28, 10, 889813), None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-18 13:47:31 | WARNING | app.routers.purchase | No se encontraron filas válidas para importar en el archivo CSV.
2025-08-18 13:47:31 | INFO | sqlalchemy.engine.Engine | ROLLBACK
