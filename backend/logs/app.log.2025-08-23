2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | [generated in 0.00105s] ('admin@gmail.com',)
2025-08-23 03:15:17 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 03:15:55 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 03:15:55 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 03:15:55 | INFO | sqlalchemy.engine.Engine | [cached since 38.39s ago] ('admin@gmail.com',)
2025-08-23 03:15:55 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 03:26:11 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 03:26:11 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 03:26:11 | INFO | sqlalchemy.engine.Engine | [cached since 653.7s ago] ('admin@gmail.com',)
2025-08-23 03:26:11 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 03:26:29 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 03:26:29 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 03:26:29 | INFO | sqlalchemy.engine.Engine | [generated in 0.00191s] ('admin@gmail.com',)
2025-08-23 03:26:29 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 03:26:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE)
2025-08-23 03:26:30 | INFO | sqlalchemy.engine.Engine | [generated in 0.01110s] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), 'admin', 'admin@gmail.com', None, '$2b$12$dCvt5n6zpBXXaQ8MYl1aqO34W7ALUXViFXHtdMcfyJ8RVAjkpLNBq', True, False, None, datetime.datetime(2025, 8, 23, 8, 26, 30, 247021, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 8, 26, 30, 247030, tzinfo=datetime.timezone.utc))
2025-08-23 03:26:30 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 03:27:01 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 03:27:01 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 03:27:01 | INFO | sqlalchemy.engine.Engine | [cached since 704.5s ago] ('admin@gmail.com',)
2025-08-23 03:27:02 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 03:27:27 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 03:27:27 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 03:27:27 | INFO | sqlalchemy.engine.Engine | [generated in 0.00277s] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 03:27:27 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 04:02:05 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 04:02:05 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 04:02:05 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 04:02:05 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 04:02:05 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 04:02:05 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 04:02:06 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 04:02:06 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 04:02:06 | INFO | sqlalchemy.engine.Engine | [generated in 0.01066s] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 04:02:06 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 04:02:06 | ERROR | app.routers.user | Error interno al crear marca
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 38, in create_user
    new_user, log = await create_user(db, user_in, current_user.id)
                                                   ^^^^^^^^^^^^^^^
AttributeError: 'asyncpg.pgproto.pgproto.UUID' object has no attribute 'id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 38, in create_user
    new_user, log = await create_user(db, user_in, current_user.id)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 60, in create_user
    await db.rollback()
          ^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'UserCreate' object has no attribute 'rollback'
2025-08-23 11:47:04 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 11:47:04 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 11:47:04 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 11:47:04 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 11:47:04 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 11:47:04 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 11:47:04 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 11:47:04 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 11:47:04 | INFO | sqlalchemy.engine.Engine | [generated in 0.00304s] ('admin@gmail.com',)
2025-08-23 11:47:04 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 11:47:05 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00204s] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT products.id AS id, products.code AS code, products.name AS name, products.description AS description, products.product_type AS product_type, products.category_id AS category_id, products.brand_id AS brand_id, products.unit_id AS unit_id, products.user_id AS user_id, products.cost AS cost, products.price AS price, products.percent_tax AS percent_tax, products.barcode AS barcode, products.image_url AS image_url, products.negative_stock AS negative_stock, products.active AS active, products.created_at AS created_at, products.updated_at AS updated_at 
FROM products 
WHERE products.active = true) AS anon_1
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.04356s] ()
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | SELECT products.id, products.code, products.name, products.description, products.product_type, products.category_id, products.brand_id, products.unit_id, products.user_id, products.cost, products.price, products.percent_tax, products.barcode, products.image_url, products.negative_stock, products.active, products.created_at, products.updated_at 
FROM products 
WHERE products.active = true ORDER BY products.name 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00305s] (100, 0)
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00458s] ('audit_level',)
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 11:47:11 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 11:47:12 | INFO | sqlalchemy.engine.Engine | [cached since 0.2144s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 11:47:12 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT products.id AS id, products.code AS code, products.name AS name, products.description AS description, products.product_type AS product_type, products.category_id AS category_id, products.brand_id AS brand_id, products.unit_id AS unit_id, products.user_id AS user_id, products.cost AS cost, products.price AS price, products.percent_tax AS percent_tax, products.barcode AS barcode, products.image_url AS image_url, products.negative_stock AS negative_stock, products.active AS active, products.created_at AS created_at, products.updated_at AS updated_at 
FROM products 
WHERE products.active = true) AS anon_1
2025-08-23 11:47:12 | INFO | sqlalchemy.engine.Engine | [cached since 0.2195s ago] ()
2025-08-23 11:47:12 | INFO | sqlalchemy.engine.Engine | SELECT products.id, products.code, products.name, products.description, products.product_type, products.category_id, products.brand_id, products.unit_id, products.user_id, products.cost, products.price, products.percent_tax, products.barcode, products.image_url, products.negative_stock, products.active, products.created_at, products.updated_at 
FROM products 
WHERE products.active = true ORDER BY products.name 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 11:47:12 | INFO | sqlalchemy.engine.Engine | [generated in 0.00776s] (100, 0)
2025-08-23 11:47:12 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 11:47:12 | INFO | sqlalchemy.engine.Engine | [cached since 0.1256s ago] ('audit_level',)
2025-08-23 11:47:12 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | [cached since 10.88s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT products.id AS id, products.code AS code, products.name AS name, products.description AS description, products.product_type AS product_type, products.category_id AS category_id, products.brand_id AS brand_id, products.unit_id AS unit_id, products.user_id AS user_id, products.cost AS cost, products.price AS price, products.percent_tax AS percent_tax, products.barcode AS barcode, products.image_url AS image_url, products.negative_stock AS negative_stock, products.active AS active, products.created_at AS created_at, products.updated_at AS updated_at 
FROM products) AS anon_1
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | [generated in 0.00860s] ()
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | SELECT products.id, products.code, products.name, products.description, products.product_type, products.category_id, products.brand_id, products.unit_id, products.user_id, products.cost, products.price, products.percent_tax, products.barcode, products.image_url, products.negative_stock, products.active, products.created_at, products.updated_at 
FROM products ORDER BY products.name 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | [generated in 0.00454s] (100, 0)
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | [cached since 10.8s ago] ('audit_level',)
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | [cached since 10.98s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT products.id AS id, products.code AS code, products.name AS name, products.description AS description, products.product_type AS product_type, products.category_id AS category_id, products.brand_id AS brand_id, products.unit_id AS unit_id, products.user_id AS user_id, products.cost AS cost, products.price AS price, products.percent_tax AS percent_tax, products.barcode AS barcode, products.image_url AS image_url, products.negative_stock AS negative_stock, products.active AS active, products.created_at AS created_at, products.updated_at AS updated_at 
FROM products) AS anon_1
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | [cached since 0.101s ago] ()
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | SELECT products.id, products.code, products.name, products.description, products.product_type, products.category_id, products.brand_id, products.unit_id, products.user_id, products.cost, products.price, products.percent_tax, products.barcode, products.image_url, products.negative_stock, products.active, products.created_at, products.updated_at 
FROM products ORDER BY products.name 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | [generated in 0.00192s] (100, 0)
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | [cached since 10.88s ago] ('audit_level',)
2025-08-23 11:47:22 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | [cached since 878.7s ago] ('admin@gmail.com',)
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | [cached since 872.1s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT products.id AS id, products.code AS code, products.name AS name, products.description AS description, products.product_type AS product_type, products.category_id AS category_id, products.brand_id AS brand_id, products.unit_id AS unit_id, products.user_id AS user_id, products.cost AS cost, products.price AS price, products.percent_tax AS percent_tax, products.barcode AS barcode, products.image_url AS image_url, products.negative_stock AS negative_stock, products.active AS active, products.created_at AS created_at, products.updated_at AS updated_at 
FROM products 
WHERE products.active = true) AS anon_1
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | [cached since 872.1s ago] ()
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | SELECT products.id, products.code, products.name, products.description, products.product_type, products.category_id, products.brand_id, products.unit_id, products.user_id, products.cost, products.price, products.percent_tax, products.barcode, products.image_url, products.negative_stock, products.active, products.created_at, products.updated_at 
FROM products 
WHERE products.active = true ORDER BY products.name 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | [cached since 871.9s ago] (100, 0)
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | [cached since 872s ago] ('audit_level',)
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:01:43 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:01:44 | INFO | sqlalchemy.engine.Engine | [cached since 872.2s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:01:44 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT products.id AS id, products.code AS code, products.name AS name, products.description AS description, products.product_type AS product_type, products.category_id AS category_id, products.brand_id AS brand_id, products.unit_id AS unit_id, products.user_id AS user_id, products.cost AS cost, products.price AS price, products.percent_tax AS percent_tax, products.barcode AS barcode, products.image_url AS image_url, products.negative_stock AS negative_stock, products.active AS active, products.created_at AS created_at, products.updated_at AS updated_at 
FROM products 
WHERE products.active = true) AS anon_1
2025-08-23 12:01:44 | INFO | sqlalchemy.engine.Engine | [cached since 872.2s ago] ()
2025-08-23 12:01:44 | INFO | sqlalchemy.engine.Engine | SELECT products.id, products.code, products.name, products.description, products.product_type, products.category_id, products.brand_id, products.unit_id, products.user_id, products.cost, products.price, products.percent_tax, products.barcode, products.image_url, products.negative_stock, products.active, products.created_at, products.updated_at 
FROM products 
WHERE products.active = true ORDER BY products.name 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 12:01:44 | INFO | sqlalchemy.engine.Engine | [cached since 872s ago] (100, 0)
2025-08-23 12:01:44 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 12:01:44 | INFO | sqlalchemy.engine.Engine | [cached since 872.1s ago] ('audit_level',)
2025-08-23 12:01:44 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | [cached since 884.5s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT products.id AS id, products.code AS code, products.name AS name, products.description AS description, products.product_type AS product_type, products.category_id AS category_id, products.brand_id AS brand_id, products.unit_id AS unit_id, products.user_id AS user_id, products.cost AS cost, products.price AS price, products.percent_tax AS percent_tax, products.barcode AS barcode, products.image_url AS image_url, products.negative_stock AS negative_stock, products.active AS active, products.created_at AS created_at, products.updated_at AS updated_at 
FROM products) AS anon_1
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | [cached since 873.6s ago] ()
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | SELECT products.id, products.code, products.name, products.description, products.product_type, products.category_id, products.brand_id, products.unit_id, products.user_id, products.cost, products.price, products.percent_tax, products.barcode, products.image_url, products.negative_stock, products.active, products.created_at, products.updated_at 
FROM products ORDER BY products.name 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | [cached since 873.6s ago] (100, 0)
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | [cached since 884.5s ago] ('audit_level',)
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | [cached since 884.6s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT products.id AS id, products.code AS code, products.name AS name, products.description AS description, products.product_type AS product_type, products.category_id AS category_id, products.brand_id AS brand_id, products.unit_id AS unit_id, products.user_id AS user_id, products.cost AS cost, products.price AS price, products.percent_tax AS percent_tax, products.barcode AS barcode, products.image_url AS image_url, products.negative_stock AS negative_stock, products.active AS active, products.created_at AS created_at, products.updated_at AS updated_at 
FROM products) AS anon_1
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | [cached since 873.7s ago] ()
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | SELECT products.id, products.code, products.name, products.description, products.product_type, products.category_id, products.brand_id, products.unit_id, products.user_id, products.cost, products.price, products.percent_tax, products.barcode, products.image_url, products.negative_stock, products.active, products.created_at, products.updated_at 
FROM products ORDER BY products.name 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | [cached since 873.7s ago] (100, 0)
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | [cached since 884.5s ago] ('audit_level',)
2025-08-23 12:01:56 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 12:04:28 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:04:28 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 12:04:28 | INFO | sqlalchemy.engine.Engine | [cached since 1044s ago] ('admin@gmail.com',)
2025-08-23 12:04:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | [cached since 1047s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT products.id AS id, products.code AS code, products.name AS name, products.description AS description, products.product_type AS product_type, products.category_id AS category_id, products.brand_id AS brand_id, products.unit_id AS unit_id, products.user_id AS user_id, products.cost AS cost, products.price AS price, products.percent_tax AS percent_tax, products.barcode AS barcode, products.image_url AS image_url, products.negative_stock AS negative_stock, products.active AS active, products.created_at AS created_at, products.updated_at AS updated_at 
FROM products) AS anon_1
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | [cached since 1036s ago] ()
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | SELECT products.id, products.code, products.name, products.description, products.product_type, products.category_id, products.brand_id, products.unit_id, products.user_id, products.cost, products.price, products.percent_tax, products.barcode, products.image_url, products.negative_stock, products.active, products.created_at, products.updated_at 
FROM products ORDER BY products.name 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | [cached since 1036s ago] (5, 0)
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | [cached since 1047s ago] ('audit_level',)
2025-08-23 12:04:39 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 12:05:10 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:05:10 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:05:10 | INFO | sqlalchemy.engine.Engine | [cached since 1079s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:05:10 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:06:45 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:06:45 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:06:45 | INFO | sqlalchemy.engine.Engine | [cached since 1173s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:06:45 | INFO | app.routers.product | Headers CSV: ['code', 'name', 'description', 'product_type', 'category_id', 'brand_id', 'unit_id', 'cost', 'price', 'percent_tax', 'barcode', 'image_url', 'negative_stock']
2025-08-23 12:06:45 | INFO | sqlalchemy.engine.Engine | INSERT INTO products (id, code, name, description, product_type, category_id, brand_id, unit_id, user_id, cost, price, percent_tax, barcode, image_url, negative_stock, active) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::product_type, ... 7107 characters truncated ... RCHAR, $479::BOOLEAN, $480::BOOLEAN) RETURNING products.created_at, products.updated_at, products.id
2025-08-23 12:06:45 | INFO | sqlalchemy.engine.Engine | [generated in 0.00052s (insertmanyvalues) 1/1 (ordered)] (UUID('fd0e76a1-f3b4-48a0-ab81-01ddf9894ab6'), '11110', 'Hamburguesa Suprema', 'Description 1', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7956.18'), Decimal('13020.35'), 19.0, '1', 'https://cdn.tuapp.com/products/hamburguesa-suprema.jpg', False, True, UUID('86a30a14-80b6-48ef-8d2e-30ede888ddad'), '11111', 'Pizza Margarita', 'Description 2', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('14149.86'), Decimal('6296.77'), 19.0, '2', 'https://cdn.tuapp.com/products/pizza-margarita.jpg', False, True, UUID('36b4c9da-6db4-47f3-a647-b6527524cc3a'), '11112', 'Ensalada CÃ©sar', 'Description 3', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('18257.87'), Decimal('8743.8'), 19.0, '3', 'https://cdn.tuapp.com/products/ensalada-cÃ©sar.jpg', False, True, UUID('490c1728-c9ed-4182-85d6-7ea7ad0da861'), '11113' ... 380 parameters truncated ... False, True, UUID('b089663d-e5f5-41e9-a4ff-339e3e8ec35b'), '11137', 'Nachos con Queso', 'Description 28', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7310.45'), Decimal('11774.68'), 19.0, '28', 'https://cdn.tuapp.com/products/nachos-con-queso.jpg', False, True, UUID('15eaa82e-5767-4588-8de1-abd48d2895d2'), '11138', 'Smoothie Fresa', 'Description 29', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('17909.61'), Decimal('29629.54'), 19.0, '29', 'https://cdn.tuapp.com/products/smoothie-fresa.jpg', False, True, UUID('968d4bb0-b09f-434e-be5b-bdc858cbe331'), '11139', 'Smoothie Mango', 'Description 30', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('3061.31'), Decimal('21154.77'), 19.0, '30', 'https://cdn.tuapp.com/products/smoothie-mango.jpg', False, True)
2025-08-23 12:06:45 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:06:45 | ERROR | app.routers.product | Integridad en importación de productos: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: inserción o actualización en la tabla «products» viola la llave foránea «products_brand_id_fkey»
DETAIL:  La llave (brand_id)=(0ff9f2f2-62e2-434a-becd-ba73973ba69d) no está presente en la tabla «brands».
[SQL: INSERT INTO products (id, code, name, description, product_type, category_id, brand_id, unit_id, user_id, cost, price, percent_tax, barcode, image_url, negative_stock, active) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::product_type, ... 7107 characters truncated ... RCHAR, $479::BOOLEAN, $480::BOOLEAN) RETURNING products.created_at, products.updated_at, products.id]
[parameters: (UUID('fd0e76a1-f3b4-48a0-ab81-01ddf9894ab6'), '11110', 'Hamburguesa Suprema', 'Description 1', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7956.18'), Decimal('13020.35'), 19.0, '1', 'https://cdn.tuapp.com/products/hamburguesa-suprema.jpg', False, True, UUID('86a30a14-80b6-48ef-8d2e-30ede888ddad'), '11111', 'Pizza Margarita', 'Description 2', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('14149.86'), Decimal('6296.77'), 19.0, '2', 'https://cdn.tuapp.com/products/pizza-margarita.jpg', False, True, UUID('36b4c9da-6db4-47f3-a647-b6527524cc3a'), '11112', 'Ensalada CÃ©sar', 'Description 3', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('18257.87'), Decimal('8743.8'), 19.0, '3', 'https://cdn.tuapp.com/products/ensalada-cÃ©sar.jpg', False, True, UUID('490c1728-c9ed-4182-85d6-7ea7ad0da861'), '11113' ... 380 parameters truncated ... False, True, UUID('b089663d-e5f5-41e9-a4ff-339e3e8ec35b'), '11137', 'Nachos con Queso', 'Description 28', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7310.45'), Decimal('11774.68'), 19.0, '28', 'https://cdn.tuapp.com/products/nachos-con-queso.jpg', False, True, UUID('15eaa82e-5767-4588-8de1-abd48d2895d2'), '11138', 'Smoothie Fresa', 'Description 29', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('17909.61'), Decimal('29629.54'), 19.0, '29', 'https://cdn.tuapp.com/products/smoothie-fresa.jpg', False, True, UUID('968d4bb0-b09f-434e-be5b-bdc858cbe331'), '11139', 'Smoothie Mango', 'Description 30', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('3061.31'), Decimal('21154.77'), 19.0, '30', 'https://cdn.tuapp.com/products/smoothie-mango.jpg', False, True)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.ForeignKeyViolationError: inserción o actualización en la tabla «products» viola la llave foránea «products_brand_id_fkey»
DETAIL:  La llave (brand_id)=(0ff9f2f2-62e2-434a-becd-ba73973ba69d) no está presente en la tabla «brands».

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: inserción o actualización en la tabla «products» viola la llave foránea «products_brand_id_fkey»
DETAIL:  La llave (brand_id)=(0ff9f2f2-62e2-434a-becd-ba73973ba69d) no está presente en la tabla «brands».

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\product.py", line 263, in import_products
    await log_action(
              ^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: inserción o actualización en la tabla «products» viola la llave foránea «products_brand_id_fkey»
DETAIL:  La llave (brand_id)=(0ff9f2f2-62e2-434a-becd-ba73973ba69d) no está presente en la tabla «brands».
[SQL: INSERT INTO products (id, code, name, description, product_type, category_id, brand_id, unit_id, user_id, cost, price, percent_tax, barcode, image_url, negative_stock, active) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::product_type, ... 7107 characters truncated ... RCHAR, $479::BOOLEAN, $480::BOOLEAN) RETURNING products.created_at, products.updated_at, products.id]
[parameters: (UUID('fd0e76a1-f3b4-48a0-ab81-01ddf9894ab6'), '11110', 'Hamburguesa Suprema', 'Description 1', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7956.18'), Decimal('13020.35'), 19.0, '1', 'https://cdn.tuapp.com/products/hamburguesa-suprema.jpg', False, True, UUID('86a30a14-80b6-48ef-8d2e-30ede888ddad'), '11111', 'Pizza Margarita', 'Description 2', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('14149.86'), Decimal('6296.77'), 19.0, '2', 'https://cdn.tuapp.com/products/pizza-margarita.jpg', False, True, UUID('36b4c9da-6db4-47f3-a647-b6527524cc3a'), '11112', 'Ensalada CÃ©sar', 'Description 3', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('18257.87'), Decimal('8743.8'), 19.0, '3', 'https://cdn.tuapp.com/products/ensalada-cÃ©sar.jpg', False, True, UUID('490c1728-c9ed-4182-85d6-7ea7ad0da861'), '11113' ... 380 parameters truncated ... False, True, UUID('b089663d-e5f5-41e9-a4ff-339e3e8ec35b'), '11137', 'Nachos con Queso', 'Description 28', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7310.45'), Decimal('11774.68'), 19.0, '28', 'https://cdn.tuapp.com/products/nachos-con-queso.jpg', False, True, UUID('15eaa82e-5767-4588-8de1-abd48d2895d2'), '11138', 'Smoothie Fresa', 'Description 29', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('17909.61'), Decimal('29629.54'), 19.0, '29', 'https://cdn.tuapp.com/products/smoothie-fresa.jpg', False, True, UUID('968d4bb0-b09f-434e-be5b-bdc858cbe331'), '11139', 'Smoothie Mango', 'Description 30', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('3061.31'), Decimal('21154.77'), 19.0, '30', 'https://cdn.tuapp.com/products/smoothie-mango.jpg', False, True)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | [generated in 0.00098s] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:10:28 | INFO | app.routers.product | Headers CSV: ['code', 'name', 'description', 'product_type', 'category_id', 'brand_id', 'unit_id', 'cost', 'price', 'percent_tax', 'barcode', 'image_url', 'negative_stock']
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | INSERT INTO products (id, code, name, description, product_type, category_id, brand_id, unit_id, user_id, cost, price, percent_tax, barcode, image_url, negative_stock, active) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::product_type, ... 7107 characters truncated ... RCHAR, $479::BOOLEAN, $480::BOOLEAN) RETURNING products.created_at, products.updated_at, products.id
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | [generated in 0.00052s (insertmanyvalues) 1/1 (ordered)] (UUID('b8f2c906-26a7-47ca-8ca9-a654c99641b2'), '11110', 'Hamburguesa Suprema', 'Description 1', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7956.18'), Decimal('13020.35'), 19.0, '1', 'https://cdn.tuapp.com/products/hamburguesa-suprema.jpg', False, True, UUID('eaae14f5-fbba-4186-be8d-869db84bf35d'), '11111', 'Pizza Margarita', 'Description 2', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('14149.86'), Decimal('6296.77'), 19.0, '2', 'https://cdn.tuapp.com/products/pizza-margarita.jpg', False, True, UUID('cc9e28e6-5eb8-4866-bdc1-01aab83744d8'), '11112', 'Ensalada CÃ©sar', 'Description 3', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('18257.87'), Decimal('8743.8'), 19.0, '3', 'https://cdn.tuapp.com/products/ensalada-cÃ©sar.jpg', False, True, UUID('cc43b082-2125-49bd-a3a4-d857aa7d7b82'), '11113' ... 380 parameters truncated ... False, True, UUID('2221925b-38d5-4542-ac5d-c9f875b1e8cd'), '11137', 'Nachos con Queso', 'Description 28', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7310.45'), Decimal('11774.68'), 19.0, '28', 'https://cdn.tuapp.com/products/nachos-con-queso.jpg', False, True, UUID('882ccf93-d865-4876-81c6-ec8ca68cedda'), '11138', 'Smoothie Fresa', 'Description 29', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('17909.61'), Decimal('29629.54'), 19.0, '29', 'https://cdn.tuapp.com/products/smoothie-fresa.jpg', False, True, UUID('0f85d4cc-2baa-4720-a40e-8c177d922950'), '11139', 'Smoothie Mango', 'Description 30', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('3061.31'), Decimal('21154.77'), 19.0, '30', 'https://cdn.tuapp.com/products/smoothie-mango.jpg', False, True)
2025-08-23 12:10:28 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:10:28 | ERROR | app.routers.product | Integridad en importación de productos: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: inserción o actualización en la tabla «products» viola la llave foránea «products_brand_id_fkey»
DETAIL:  La llave (brand_id)=(0ff9f2f2-62e2-434a-becd-ba73973ba69d) no está presente en la tabla «brands».
[SQL: INSERT INTO products (id, code, name, description, product_type, category_id, brand_id, unit_id, user_id, cost, price, percent_tax, barcode, image_url, negative_stock, active) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::product_type, ... 7107 characters truncated ... RCHAR, $479::BOOLEAN, $480::BOOLEAN) RETURNING products.created_at, products.updated_at, products.id]
[parameters: (UUID('b8f2c906-26a7-47ca-8ca9-a654c99641b2'), '11110', 'Hamburguesa Suprema', 'Description 1', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7956.18'), Decimal('13020.35'), 19.0, '1', 'https://cdn.tuapp.com/products/hamburguesa-suprema.jpg', False, True, UUID('eaae14f5-fbba-4186-be8d-869db84bf35d'), '11111', 'Pizza Margarita', 'Description 2', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('14149.86'), Decimal('6296.77'), 19.0, '2', 'https://cdn.tuapp.com/products/pizza-margarita.jpg', False, True, UUID('cc9e28e6-5eb8-4866-bdc1-01aab83744d8'), '11112', 'Ensalada CÃ©sar', 'Description 3', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('18257.87'), Decimal('8743.8'), 19.0, '3', 'https://cdn.tuapp.com/products/ensalada-cÃ©sar.jpg', False, True, UUID('cc43b082-2125-49bd-a3a4-d857aa7d7b82'), '11113' ... 380 parameters truncated ... False, True, UUID('2221925b-38d5-4542-ac5d-c9f875b1e8cd'), '11137', 'Nachos con Queso', 'Description 28', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7310.45'), Decimal('11774.68'), 19.0, '28', 'https://cdn.tuapp.com/products/nachos-con-queso.jpg', False, True, UUID('882ccf93-d865-4876-81c6-ec8ca68cedda'), '11138', 'Smoothie Fresa', 'Description 29', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('17909.61'), Decimal('29629.54'), 19.0, '29', 'https://cdn.tuapp.com/products/smoothie-fresa.jpg', False, True, UUID('0f85d4cc-2baa-4720-a40e-8c177d922950'), '11139', 'Smoothie Mango', 'Description 30', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('3061.31'), Decimal('21154.77'), 19.0, '30', 'https://cdn.tuapp.com/products/smoothie-mango.jpg', False, True)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.ForeignKeyViolationError: inserción o actualización en la tabla «products» viola la llave foránea «products_brand_id_fkey»
DETAIL:  La llave (brand_id)=(0ff9f2f2-62e2-434a-becd-ba73973ba69d) no está presente en la tabla «brands».

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: inserción o actualización en la tabla «products» viola la llave foránea «products_brand_id_fkey»
DETAIL:  La llave (brand_id)=(0ff9f2f2-62e2-434a-becd-ba73973ba69d) no está presente en la tabla «brands».

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\product.py", line 263, in import_products
    audit_level = await get_audit_level(db)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: inserción o actualización en la tabla «products» viola la llave foránea «products_brand_id_fkey»
DETAIL:  La llave (brand_id)=(0ff9f2f2-62e2-434a-becd-ba73973ba69d) no está presente en la tabla «brands».
[SQL: INSERT INTO products (id, code, name, description, product_type, category_id, brand_id, unit_id, user_id, cost, price, percent_tax, barcode, image_url, negative_stock, active) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::product_type, ... 7107 characters truncated ... RCHAR, $479::BOOLEAN, $480::BOOLEAN) RETURNING products.created_at, products.updated_at, products.id]
[parameters: (UUID('b8f2c906-26a7-47ca-8ca9-a654c99641b2'), '11110', 'Hamburguesa Suprema', 'Description 1', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7956.18'), Decimal('13020.35'), 19.0, '1', 'https://cdn.tuapp.com/products/hamburguesa-suprema.jpg', False, True, UUID('eaae14f5-fbba-4186-be8d-869db84bf35d'), '11111', 'Pizza Margarita', 'Description 2', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('14149.86'), Decimal('6296.77'), 19.0, '2', 'https://cdn.tuapp.com/products/pizza-margarita.jpg', False, True, UUID('cc9e28e6-5eb8-4866-bdc1-01aab83744d8'), '11112', 'Ensalada CÃ©sar', 'Description 3', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('18257.87'), Decimal('8743.8'), 19.0, '3', 'https://cdn.tuapp.com/products/ensalada-cÃ©sar.jpg', False, True, UUID('cc43b082-2125-49bd-a3a4-d857aa7d7b82'), '11113' ... 380 parameters truncated ... False, True, UUID('2221925b-38d5-4542-ac5d-c9f875b1e8cd'), '11137', 'Nachos con Queso', 'Description 28', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('7310.45'), Decimal('11774.68'), 19.0, '28', 'https://cdn.tuapp.com/products/nachos-con-queso.jpg', False, True, UUID('882ccf93-d865-4876-81c6-ec8ca68cedda'), '11138', 'Smoothie Fresa', 'Description 29', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('17909.61'), Decimal('29629.54'), 19.0, '29', 'https://cdn.tuapp.com/products/smoothie-fresa.jpg', False, True, UUID('0f85d4cc-2baa-4720-a40e-8c177d922950'), '11139', 'Smoothie Mango', 'Description 30', 'UNI', UUID('7059d1d0-bcc5-4443-8193-2a3a65aa0990'), UUID('0ff9f2f2-62e2-434a-becd-ba73973ba69d'), UUID('490bf074-caaa-4b1f-8fdd-b1d32e7084a1'), UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'), Decimal('3061.31'), Decimal('21154.77'), 19.0, '30', 'https://cdn.tuapp.com/products/smoothie-mango.jpg', False, True)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 12:12:52 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:12:52 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:12:52 | INFO | sqlalchemy.engine.Engine | [cached since 144.3s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:12:52 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 12:12:52 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $1 ... 3259 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)
2025-08-23 12:12:52 | INFO | sqlalchemy.engine.Engine | [generated in 0.00059s (insertmanyvalues) 1/1 (unordered)] (UUID('711f7192-a597-4596-82f3-aaaf2daf21f4'), 'Administrador', 'Rol de administrador del sistema', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569303, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569307, tzinfo=datetime.timezone.utc), UUID('4d8b4a88-9a67-4e74-af62-66a3ce2d3147'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569317, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569319, tzinfo=datetime.timezone.utc), UUID('62bf5e4e-4888-41fb-a928-6240d84677d1'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569328, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569329, tzinfo=datetime.timezone.utc), UUID('f3f3f20a-8064-47e2-a1cd-e87fb6b674e0'), 'Cajero', 'Opera el punto de venta', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569335, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569336, tzinfo=datetime.timezone.utc), UUID('c8124f85-7896-4d3f-958c-f9b4d80bb714'), 'Inventario', 'Controla existencias y conteos', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569342, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569343, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('ae4c0c01-b398-425d-b77d-b40d9363ca2e'), 'Ecommerce', 'Catálogo y pedidos en línea', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569416, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569417, tzinfo=datetime.timezone.utc), UUID('7c901ed0-cddc-4e6a-8bfb-2aff1746294c'), 'Analista', 'Reportes y análisis', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569423, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569424, tzinfo=datetime.timezone.utc), UUID('43dc01a1-fc71-4c98-8a26-05fe9cad8676'), 'Calidad', 'Control de calidad', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569430, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569431, tzinfo=datetime.timezone.utc), UUID('a86d5b9b-c332-4cca-bc36-79d7253d2f8b'), 'Desarrollador', 'Soporte técnico y desarrollo', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569437, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569438, tzinfo=datetime.timezone.utc), UUID('27d5b62d-40a1-472c-864e-aae7aa09351c'), 'Auditor_Junior', 'Apoyo a auditorías', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569443, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569444, tzinfo=datetime.timezone.utc))
2025-08-23 12:12:52 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:12:52 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (711f7192-a597-4596-82f3-aaaf2daf21f4, Administrador, Rol de administrador del sistema, null, null, f, t, 2025-08-23 12:12:52.569303-05, 2025-08-23 12:12:52.569307-05, null).
[SQL: INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $1 ... 3259 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('711f7192-a597-4596-82f3-aaaf2daf21f4'), 'Administrador', 'Rol de administrador del sistema', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569303, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569307, tzinfo=datetime.timezone.utc), UUID('4d8b4a88-9a67-4e74-af62-66a3ce2d3147'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569317, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569319, tzinfo=datetime.timezone.utc), UUID('62bf5e4e-4888-41fb-a928-6240d84677d1'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569328, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569329, tzinfo=datetime.timezone.utc), UUID('f3f3f20a-8064-47e2-a1cd-e87fb6b674e0'), 'Cajero', 'Opera el punto de venta', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569335, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569336, tzinfo=datetime.timezone.utc), UUID('c8124f85-7896-4d3f-958c-f9b4d80bb714'), 'Inventario', 'Controla existencias y conteos', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569342, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569343, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('ae4c0c01-b398-425d-b77d-b40d9363ca2e'), 'Ecommerce', 'Catálogo y pedidos en línea', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569416, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569417, tzinfo=datetime.timezone.utc), UUID('7c901ed0-cddc-4e6a-8bfb-2aff1746294c'), 'Analista', 'Reportes y análisis', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569423, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569424, tzinfo=datetime.timezone.utc), UUID('43dc01a1-fc71-4c98-8a26-05fe9cad8676'), 'Calidad', 'Control de calidad', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569430, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569431, tzinfo=datetime.timezone.utc), UUID('a86d5b9b-c332-4cca-bc36-79d7253d2f8b'), 'Desarrollador', 'Soporte técnico y desarrollo', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569437, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569438, tzinfo=datetime.timezone.utc), UUID('27d5b62d-40a1-472c-864e-aae7aa09351c'), 'Auditor_Junior', 'Apoyo a auditorías', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569443, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569444, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (711f7192-a597-4596-82f3-aaaf2daf21f4, Administrador, Rol de administrador del sistema, null, null, f, t, 2025-08-23 12:12:52.569303-05, 2025-08-23 12:12:52.569307-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (711f7192-a597-4596-82f3-aaaf2daf21f4, Administrador, Rol de administrador del sistema, null, null, f, t, 2025-08-23 12:12:52.569303-05, 2025-08-23 12:12:52.569307-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (711f7192-a597-4596-82f3-aaaf2daf21f4, Administrador, Rol de administrador del sistema, null, null, f, t, 2025-08-23 12:12:52.569303-05, 2025-08-23 12:12:52.569307-05, null).
[SQL: INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $1 ... 3259 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('711f7192-a597-4596-82f3-aaaf2daf21f4'), 'Administrador', 'Rol de administrador del sistema', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569303, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569307, tzinfo=datetime.timezone.utc), UUID('4d8b4a88-9a67-4e74-af62-66a3ce2d3147'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569317, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569319, tzinfo=datetime.timezone.utc), UUID('62bf5e4e-4888-41fb-a928-6240d84677d1'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569328, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569329, tzinfo=datetime.timezone.utc), UUID('f3f3f20a-8064-47e2-a1cd-e87fb6b674e0'), 'Cajero', 'Opera el punto de venta', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569335, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569336, tzinfo=datetime.timezone.utc), UUID('c8124f85-7896-4d3f-958c-f9b4d80bb714'), 'Inventario', 'Controla existencias y conteos', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569342, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569343, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('ae4c0c01-b398-425d-b77d-b40d9363ca2e'), 'Ecommerce', 'Catálogo y pedidos en línea', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569416, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569417, tzinfo=datetime.timezone.utc), UUID('7c901ed0-cddc-4e6a-8bfb-2aff1746294c'), 'Analista', 'Reportes y análisis', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569423, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569424, tzinfo=datetime.timezone.utc), UUID('43dc01a1-fc71-4c98-8a26-05fe9cad8676'), 'Calidad', 'Control de calidad', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569430, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569431, tzinfo=datetime.timezone.utc), UUID('a86d5b9b-c332-4cca-bc36-79d7253d2f8b'), 'Desarrollador', 'Soporte técnico y desarrollo', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569437, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569438, tzinfo=datetime.timezone.utc), UUID('27d5b62d-40a1-472c-864e-aae7aa09351c'), 'Auditor_Junior', 'Apoyo a auditorías', None, None, False, True, None, datetime.datetime(2025, 8, 23, 17, 12, 52, 569443, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 12, 52, 569444, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 12:13:37 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:13:37 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:13:37 | INFO | sqlalchemy.engine.Engine | [cached since 189.6s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:13:37 | ERROR | app.crud.user | Error al crear la marca
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 25, in create_user
    user = User(**user_in.model_dump(), user_id=user_id)
  File "<string>", line 4, in __init__
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\state.py", line 571, in _initialize_instance
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\decl_base.py", line 2179, in _declarative_constructor
    raise TypeError(
        "%r is an invalid keyword argument for %s" % (k, cls_.__name__)
    )
TypeError: 'user_id' is an invalid keyword argument for User
2025-08-23 12:13:37 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:13:37 | ERROR | app.routers.user | Error interno al crear marca
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 35, in create_user_endpoint
    new_user, log = await create_user(db, user_in, current_user.id)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 25, in create_user
    user = User(**user_in.model_dump(), user_id=user_id)
  File "<string>", line 4, in __init__
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\state.py", line 571, in _initialize_instance
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\state.py", line 569, in _initialize_instance
    manager.original_init(*mixed[1:], **kwargs)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\decl_base.py", line 2179, in _declarative_constructor
    raise TypeError(
        "%r is an invalid keyword argument for %s" % (k, cls_.__name__)
    )
TypeError: 'user_id' is an invalid keyword argument for User
2025-08-23 12:30:30 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:30:30 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:30:30 | INFO | sqlalchemy.engine.Engine | [cached since 1202s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:30:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:30:51 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:30:51 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:30:51 | INFO | sqlalchemy.engine.Engine | [cached since 1224s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:30:51 | INFO | app.routers.user | Headers después de limpieza: ['email', 'full_name', 'password', 'active', 'superuser']
2025-08-23 12:30:59 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)
2025-08-23 12:30:59 | INFO | sqlalchemy.engine.Engine | [generated in 0.00038s (insertmanyvalues) 1/1 (unordered)] (UUID('3488d8b0-b81c-48db-beb5-1581d2169aff'), None, 'user1@example.com', 'User 1', '$2b$12$9NrCnSUdGJD4ppbXtTFnu.tpAAdHrZe86XFvLN9ZknM2MjHnOjomi', True, True, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469693, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469696, tzinfo=datetime.timezone.utc), UUID('d119be2e-aeac-4d6c-a3a5-f95ff38875cc'), None, 'user2@example.com', 'User 2', '$2b$12$fn5/l0tJ5dLYVFVLfPDjYOHTbitiZsd8YCFBpTyTuIlq.Wt41kcTO', True, True, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469717, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469718, tzinfo=datetime.timezone.utc), UUID('879ac192-16c0-4de0-9475-4084882cdd4e'), None, 'user3@example.com', 'User 3', '$2b$12$8/vr/pk.XKD8KejbMH/ov.MQ21pUexhVhp3U2YDtLtQw.9kRaKfHq', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469722, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469722, tzinfo=datetime.timezone.utc), UUID('bfdaad71-0f2b-4a3a-8e18-65fa075750d8'), None, 'user4@example.com', 'User 4', '$2b$12$xHvnX5smFAcDYtOrd1DvgON5UJ9DofuqgmrDBn0gunFgOqGCXXFvC', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469726, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469726, tzinfo=datetime.timezone.utc), UUID('8455bf8f-70b0-4bb4-a91d-c5bff39dea2a'), None, 'user5@example.com', 'User 5', '$2b$12$whowsJfs5jTYoms9yHUVk.ro.1PbvlAwNfsPItUpsM3ibC2IUTDPe', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469729, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469730, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('389a27c6-0ea1-46b0-8239-4ff8239a41a2'), None, 'user16@example.com', 'User 16', '$2b$12$PtQHUHHC5AMo7DhKku/Vu.ax9uPllRPoyq5VB4ucf5Ulj4a2uvjI2', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469769, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469770, tzinfo=datetime.timezone.utc), UUID('b90d4264-c165-4480-9b42-8e44f4a35ed0'), None, 'user17@example.com', 'User 17', '$2b$12$Ixor0P0Um6/VkAwzA0N1XubGu5keViNDq8wnAil1qowHOs/iVZXjy', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469773, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469774, tzinfo=datetime.timezone.utc), UUID('65588c10-f4e1-4cb8-a48d-4f15a840ea8a'), None, 'user18@example.com', 'User 18', '$2b$12$y6Tmh/0lA247GnUYkoDJKeIiLnt1nQ1gsAw8fmVHDqj/QurvyRMkS', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469777, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469777, tzinfo=datetime.timezone.utc), UUID('19d9becb-e9ec-419a-b0d6-280290dc0323'), None, 'user19@example.com', 'User 19', '$2b$12$bFNeorkpAh.kn4cbgQKf0eIo.HL/suK9oqGDFFbmYvFqlGa00yDW2', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469780, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469781, tzinfo=datetime.timezone.utc), UUID('55b08f40-ba84-4cfc-8f66-53247a594ddf'), None, 'user20@example.com', 'User 20', '$2b$12$XtSkfl00cURwgljFqfe3YuJhoOkJgMt/Z9ZfXU2Zr4Li2xhFvr6sK', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469784, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469784, tzinfo=datetime.timezone.utc))
2025-08-23 12:30:59 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:30:59 | ERROR | app.routers.user | Error de integridad en importación masiva: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (3488d8b0-b81c-48db-beb5-1581d2169aff, null, user1@example.com, User 1, $2b$12$9NrCnSUdGJD4ppbXtTFnu.tpAAdHrZe86XFvLN9ZknM2MjHnOjomi, t, t, null, 2025-08-23 12:30:59.469693-05, 2025-08-23 12:30:59.469696-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('3488d8b0-b81c-48db-beb5-1581d2169aff'), None, 'user1@example.com', 'User 1', '$2b$12$9NrCnSUdGJD4ppbXtTFnu.tpAAdHrZe86XFvLN9ZknM2MjHnOjomi', True, True, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469693, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469696, tzinfo=datetime.timezone.utc), UUID('d119be2e-aeac-4d6c-a3a5-f95ff38875cc'), None, 'user2@example.com', 'User 2', '$2b$12$fn5/l0tJ5dLYVFVLfPDjYOHTbitiZsd8YCFBpTyTuIlq.Wt41kcTO', True, True, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469717, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469718, tzinfo=datetime.timezone.utc), UUID('879ac192-16c0-4de0-9475-4084882cdd4e'), None, 'user3@example.com', 'User 3', '$2b$12$8/vr/pk.XKD8KejbMH/ov.MQ21pUexhVhp3U2YDtLtQw.9kRaKfHq', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469722, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469722, tzinfo=datetime.timezone.utc), UUID('bfdaad71-0f2b-4a3a-8e18-65fa075750d8'), None, 'user4@example.com', 'User 4', '$2b$12$xHvnX5smFAcDYtOrd1DvgON5UJ9DofuqgmrDBn0gunFgOqGCXXFvC', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469726, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469726, tzinfo=datetime.timezone.utc), UUID('8455bf8f-70b0-4bb4-a91d-c5bff39dea2a'), None, 'user5@example.com', 'User 5', '$2b$12$whowsJfs5jTYoms9yHUVk.ro.1PbvlAwNfsPItUpsM3ibC2IUTDPe', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469729, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469730, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('389a27c6-0ea1-46b0-8239-4ff8239a41a2'), None, 'user16@example.com', 'User 16', '$2b$12$PtQHUHHC5AMo7DhKku/Vu.ax9uPllRPoyq5VB4ucf5Ulj4a2uvjI2', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469769, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469770, tzinfo=datetime.timezone.utc), UUID('b90d4264-c165-4480-9b42-8e44f4a35ed0'), None, 'user17@example.com', 'User 17', '$2b$12$Ixor0P0Um6/VkAwzA0N1XubGu5keViNDq8wnAil1qowHOs/iVZXjy', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469773, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469774, tzinfo=datetime.timezone.utc), UUID('65588c10-f4e1-4cb8-a48d-4f15a840ea8a'), None, 'user18@example.com', 'User 18', '$2b$12$y6Tmh/0lA247GnUYkoDJKeIiLnt1nQ1gsAw8fmVHDqj/QurvyRMkS', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469777, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469777, tzinfo=datetime.timezone.utc), UUID('19d9becb-e9ec-419a-b0d6-280290dc0323'), None, 'user19@example.com', 'User 19', '$2b$12$bFNeorkpAh.kn4cbgQKf0eIo.HL/suK9oqGDFFbmYvFqlGa00yDW2', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469780, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469781, tzinfo=datetime.timezone.utc), UUID('55b08f40-ba84-4cfc-8f66-53247a594ddf'), None, 'user20@example.com', 'User 20', '$2b$12$XtSkfl00cURwgljFqfe3YuJhoOkJgMt/Z9ZfXU2Zr4Li2xhFvr6sK', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469784, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469784, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (3488d8b0-b81c-48db-beb5-1581d2169aff, null, user1@example.com, User 1, $2b$12$9NrCnSUdGJD4ppbXtTFnu.tpAAdHrZe86XFvLN9ZknM2MjHnOjomi, t, t, null, 2025-08-23 12:30:59.469693-05, 2025-08-23 12:30:59.469696-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (3488d8b0-b81c-48db-beb5-1581d2169aff, null, user1@example.com, User 1, $2b$12$9NrCnSUdGJD4ppbXtTFnu.tpAAdHrZe86XFvLN9ZknM2MjHnOjomi, t, t, null, 2025-08-23 12:30:59.469693-05, 2025-08-23 12:30:59.469696-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 245, in import_users
    await log_action(
    ...<5 lines>...
    )
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit.py", line 28, in log_action
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (3488d8b0-b81c-48db-beb5-1581d2169aff, null, user1@example.com, User 1, $2b$12$9NrCnSUdGJD4ppbXtTFnu.tpAAdHrZe86XFvLN9ZknM2MjHnOjomi, t, t, null, 2025-08-23 12:30:59.469693-05, 2025-08-23 12:30:59.469696-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('3488d8b0-b81c-48db-beb5-1581d2169aff'), None, 'user1@example.com', 'User 1', '$2b$12$9NrCnSUdGJD4ppbXtTFnu.tpAAdHrZe86XFvLN9ZknM2MjHnOjomi', True, True, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469693, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469696, tzinfo=datetime.timezone.utc), UUID('d119be2e-aeac-4d6c-a3a5-f95ff38875cc'), None, 'user2@example.com', 'User 2', '$2b$12$fn5/l0tJ5dLYVFVLfPDjYOHTbitiZsd8YCFBpTyTuIlq.Wt41kcTO', True, True, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469717, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469718, tzinfo=datetime.timezone.utc), UUID('879ac192-16c0-4de0-9475-4084882cdd4e'), None, 'user3@example.com', 'User 3', '$2b$12$8/vr/pk.XKD8KejbMH/ov.MQ21pUexhVhp3U2YDtLtQw.9kRaKfHq', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469722, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469722, tzinfo=datetime.timezone.utc), UUID('bfdaad71-0f2b-4a3a-8e18-65fa075750d8'), None, 'user4@example.com', 'User 4', '$2b$12$xHvnX5smFAcDYtOrd1DvgON5UJ9DofuqgmrDBn0gunFgOqGCXXFvC', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469726, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469726, tzinfo=datetime.timezone.utc), UUID('8455bf8f-70b0-4bb4-a91d-c5bff39dea2a'), None, 'user5@example.com', 'User 5', '$2b$12$whowsJfs5jTYoms9yHUVk.ro.1PbvlAwNfsPItUpsM3ibC2IUTDPe', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469729, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469730, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('389a27c6-0ea1-46b0-8239-4ff8239a41a2'), None, 'user16@example.com', 'User 16', '$2b$12$PtQHUHHC5AMo7DhKku/Vu.ax9uPllRPoyq5VB4ucf5Ulj4a2uvjI2', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469769, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469770, tzinfo=datetime.timezone.utc), UUID('b90d4264-c165-4480-9b42-8e44f4a35ed0'), None, 'user17@example.com', 'User 17', '$2b$12$Ixor0P0Um6/VkAwzA0N1XubGu5keViNDq8wnAil1qowHOs/iVZXjy', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469773, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469774, tzinfo=datetime.timezone.utc), UUID('65588c10-f4e1-4cb8-a48d-4f15a840ea8a'), None, 'user18@example.com', 'User 18', '$2b$12$y6Tmh/0lA247GnUYkoDJKeIiLnt1nQ1gsAw8fmVHDqj/QurvyRMkS', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469777, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469777, tzinfo=datetime.timezone.utc), UUID('19d9becb-e9ec-419a-b0d6-280290dc0323'), None, 'user19@example.com', 'User 19', '$2b$12$bFNeorkpAh.kn4cbgQKf0eIo.HL/suK9oqGDFFbmYvFqlGa00yDW2', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469780, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469781, tzinfo=datetime.timezone.utc), UUID('55b08f40-ba84-4cfc-8f66-53247a594ddf'), None, 'user20@example.com', 'User 20', '$2b$12$XtSkfl00cURwgljFqfe3YuJhoOkJgMt/Z9ZfXU2Zr4Li2xhFvr6sK', True, False, None, datetime.datetime(2025, 8, 23, 17, 30, 59, 469784, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 30, 59, 469784, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 12:36:51 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:36:51 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:36:51 | INFO | sqlalchemy.engine.Engine | [cached since 1584s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:36:51 | INFO | app.routers.user | Headers después de limpieza: ['username', 'email', 'full_name', 'password', 'active', 'superuser']
2025-08-23 12:37:00 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)
2025-08-23 12:37:00 | INFO | sqlalchemy.engine.Engine | [cached since 360.6s ago (insertmanyvalues) 1/1 (unordered)] (UUID('6d1c808f-7623-4de1-8566-88e7fa601384'), None, 'user1@example.com', 'User 1', '$2b$12$aAbLuq6m/Ac8ZEu4uQfoDOJmd/BKPw.ASuhlkG72uYjXW53XKJxTK', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37072, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37077, tzinfo=datetime.timezone.utc), UUID('0b71e9b4-bb2b-439a-ad2a-8434adc5aa2e'), None, 'user2@example.com', 'User 2', '$2b$12$Gu/eG8t3DJosdrlbJWhLs.uC7xON9nMuTvME6grw3joofyYdQritm', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37088, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37089, tzinfo=datetime.timezone.utc), UUID('77f35502-2bec-4840-bf3e-9488dd9bf1f1'), None, 'user3@example.com', 'User 3', '$2b$12$BaMjVWB9ZdAAZD2qLdvGLuqqN0PXuNZgo7gSkVp7K3EaYyKFFv7Fe', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37096, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37097, tzinfo=datetime.timezone.utc), UUID('c91499f4-3de7-4bfa-8b37-645c627e2fad'), None, 'user4@example.com', 'User 4', '$2b$12$8PZCfvfco.cuFhZg5zoYMe33ZoOEZyi2RWNyFofCh2cF8VBCO7Lti', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37104, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37107, tzinfo=datetime.timezone.utc), UUID('a0aae03e-67e2-4c4c-b246-9482fa507169'), None, 'user5@example.com', 'User 5', '$2b$12$H7fLiu9RpE.Exp8wM9LKAOoor/KfY9ycid2gOdfdfAILzNmTQXJBW', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37119, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37121, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('ea8cc138-a616-4d88-87af-3cd6d21ed5d9'), None, 'user16@example.com', 'User 16', '$2b$12$rpGaiARAgS6FZdGXkYmpLOquOcnGg9kpDOjk27zpNVhX93465/3eq', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37210, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37211, tzinfo=datetime.timezone.utc), UUID('bb419f30-c781-44c8-b1cd-4126f702c26f'), None, 'user17@example.com', 'User 17', '$2b$12$iuOyUvxhmDYBx4QA45DzC.2GJC7CVE1jcPzWHsrIm45i/cQETDK02', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37218, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37219, tzinfo=datetime.timezone.utc), UUID('942d83f1-a761-4802-b618-ba5a544d1fba'), None, 'user18@example.com', 'User 18', '$2b$12$5w1cMKcSqiYELn54OF7fM.OVTkkNbuZwnBoRhuk8Er3KtIQWYtGrG', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37226, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37227, tzinfo=datetime.timezone.utc), UUID('2737d56f-f6b2-423f-abd1-f6a46334f151'), None, 'user19@example.com', 'User 19', '$2b$12$KU9EOLDjq6yRNKg/2ExrDO7uV5FJY8EOnzEpluYAQnMDEas/3/cZS', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37233, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37234, tzinfo=datetime.timezone.utc), UUID('416143e2-c95f-47da-9920-94d62a1df9af'), None, 'user20@example.com', 'User 20', '$2b$12$KzygxYJpJu9CJEhs26egputfEMF6a1sCJBjCBrkzh88T5kPk5f7FC', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37240, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37242, tzinfo=datetime.timezone.utc))
2025-08-23 12:37:00 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:37:00 | ERROR | app.routers.user | Error de integridad en importación masiva: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6d1c808f-7623-4de1-8566-88e7fa601384, null, user1@example.com, User 1, $2b$12$aAbLuq6m/Ac8ZEu4uQfoDOJmd/BKPw.ASuhlkG72uYjXW53XKJxTK, t, t, null, 2025-08-23 12:37:00.037072-05, 2025-08-23 12:37:00.037077-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('6d1c808f-7623-4de1-8566-88e7fa601384'), None, 'user1@example.com', 'User 1', '$2b$12$aAbLuq6m/Ac8ZEu4uQfoDOJmd/BKPw.ASuhlkG72uYjXW53XKJxTK', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37072, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37077, tzinfo=datetime.timezone.utc), UUID('0b71e9b4-bb2b-439a-ad2a-8434adc5aa2e'), None, 'user2@example.com', 'User 2', '$2b$12$Gu/eG8t3DJosdrlbJWhLs.uC7xON9nMuTvME6grw3joofyYdQritm', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37088, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37089, tzinfo=datetime.timezone.utc), UUID('77f35502-2bec-4840-bf3e-9488dd9bf1f1'), None, 'user3@example.com', 'User 3', '$2b$12$BaMjVWB9ZdAAZD2qLdvGLuqqN0PXuNZgo7gSkVp7K3EaYyKFFv7Fe', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37096, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37097, tzinfo=datetime.timezone.utc), UUID('c91499f4-3de7-4bfa-8b37-645c627e2fad'), None, 'user4@example.com', 'User 4', '$2b$12$8PZCfvfco.cuFhZg5zoYMe33ZoOEZyi2RWNyFofCh2cF8VBCO7Lti', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37104, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37107, tzinfo=datetime.timezone.utc), UUID('a0aae03e-67e2-4c4c-b246-9482fa507169'), None, 'user5@example.com', 'User 5', '$2b$12$H7fLiu9RpE.Exp8wM9LKAOoor/KfY9ycid2gOdfdfAILzNmTQXJBW', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37119, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37121, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('ea8cc138-a616-4d88-87af-3cd6d21ed5d9'), None, 'user16@example.com', 'User 16', '$2b$12$rpGaiARAgS6FZdGXkYmpLOquOcnGg9kpDOjk27zpNVhX93465/3eq', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37210, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37211, tzinfo=datetime.timezone.utc), UUID('bb419f30-c781-44c8-b1cd-4126f702c26f'), None, 'user17@example.com', 'User 17', '$2b$12$iuOyUvxhmDYBx4QA45DzC.2GJC7CVE1jcPzWHsrIm45i/cQETDK02', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37218, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37219, tzinfo=datetime.timezone.utc), UUID('942d83f1-a761-4802-b618-ba5a544d1fba'), None, 'user18@example.com', 'User 18', '$2b$12$5w1cMKcSqiYELn54OF7fM.OVTkkNbuZwnBoRhuk8Er3KtIQWYtGrG', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37226, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37227, tzinfo=datetime.timezone.utc), UUID('2737d56f-f6b2-423f-abd1-f6a46334f151'), None, 'user19@example.com', 'User 19', '$2b$12$KU9EOLDjq6yRNKg/2ExrDO7uV5FJY8EOnzEpluYAQnMDEas/3/cZS', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37233, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37234, tzinfo=datetime.timezone.utc), UUID('416143e2-c95f-47da-9920-94d62a1df9af'), None, 'user20@example.com', 'User 20', '$2b$12$KzygxYJpJu9CJEhs26egputfEMF6a1sCJBjCBrkzh88T5kPk5f7FC', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37240, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37242, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6d1c808f-7623-4de1-8566-88e7fa601384, null, user1@example.com, User 1, $2b$12$aAbLuq6m/Ac8ZEu4uQfoDOJmd/BKPw.ASuhlkG72uYjXW53XKJxTK, t, t, null, 2025-08-23 12:37:00.037072-05, 2025-08-23 12:37:00.037077-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6d1c808f-7623-4de1-8566-88e7fa601384, null, user1@example.com, User 1, $2b$12$aAbLuq6m/Ac8ZEu4uQfoDOJmd/BKPw.ASuhlkG72uYjXW53XKJxTK, t, t, null, 2025-08-23 12:37:00.037072-05, 2025-08-23 12:37:00.037077-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 245, in import_users
    await log_action(
    ...<5 lines>...
    )
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit.py", line 28, in log_action
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6d1c808f-7623-4de1-8566-88e7fa601384, null, user1@example.com, User 1, $2b$12$aAbLuq6m/Ac8ZEu4uQfoDOJmd/BKPw.ASuhlkG72uYjXW53XKJxTK, t, t, null, 2025-08-23 12:37:00.037072-05, 2025-08-23 12:37:00.037077-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('6d1c808f-7623-4de1-8566-88e7fa601384'), None, 'user1@example.com', 'User 1', '$2b$12$aAbLuq6m/Ac8ZEu4uQfoDOJmd/BKPw.ASuhlkG72uYjXW53XKJxTK', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37072, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37077, tzinfo=datetime.timezone.utc), UUID('0b71e9b4-bb2b-439a-ad2a-8434adc5aa2e'), None, 'user2@example.com', 'User 2', '$2b$12$Gu/eG8t3DJosdrlbJWhLs.uC7xON9nMuTvME6grw3joofyYdQritm', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37088, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37089, tzinfo=datetime.timezone.utc), UUID('77f35502-2bec-4840-bf3e-9488dd9bf1f1'), None, 'user3@example.com', 'User 3', '$2b$12$BaMjVWB9ZdAAZD2qLdvGLuqqN0PXuNZgo7gSkVp7K3EaYyKFFv7Fe', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37096, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37097, tzinfo=datetime.timezone.utc), UUID('c91499f4-3de7-4bfa-8b37-645c627e2fad'), None, 'user4@example.com', 'User 4', '$2b$12$8PZCfvfco.cuFhZg5zoYMe33ZoOEZyi2RWNyFofCh2cF8VBCO7Lti', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37104, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37107, tzinfo=datetime.timezone.utc), UUID('a0aae03e-67e2-4c4c-b246-9482fa507169'), None, 'user5@example.com', 'User 5', '$2b$12$H7fLiu9RpE.Exp8wM9LKAOoor/KfY9ycid2gOdfdfAILzNmTQXJBW', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37119, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37121, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('ea8cc138-a616-4d88-87af-3cd6d21ed5d9'), None, 'user16@example.com', 'User 16', '$2b$12$rpGaiARAgS6FZdGXkYmpLOquOcnGg9kpDOjk27zpNVhX93465/3eq', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37210, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37211, tzinfo=datetime.timezone.utc), UUID('bb419f30-c781-44c8-b1cd-4126f702c26f'), None, 'user17@example.com', 'User 17', '$2b$12$iuOyUvxhmDYBx4QA45DzC.2GJC7CVE1jcPzWHsrIm45i/cQETDK02', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37218, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37219, tzinfo=datetime.timezone.utc), UUID('942d83f1-a761-4802-b618-ba5a544d1fba'), None, 'user18@example.com', 'User 18', '$2b$12$5w1cMKcSqiYELn54OF7fM.OVTkkNbuZwnBoRhuk8Er3KtIQWYtGrG', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37226, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37227, tzinfo=datetime.timezone.utc), UUID('2737d56f-f6b2-423f-abd1-f6a46334f151'), None, 'user19@example.com', 'User 19', '$2b$12$KU9EOLDjq6yRNKg/2ExrDO7uV5FJY8EOnzEpluYAQnMDEas/3/cZS', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37233, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37234, tzinfo=datetime.timezone.utc), UUID('416143e2-c95f-47da-9920-94d62a1df9af'), None, 'user20@example.com', 'User 20', '$2b$12$KzygxYJpJu9CJEhs26egputfEMF6a1sCJBjCBrkzh88T5kPk5f7FC', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 0, 37240, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 0, 37242, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 12:37:50 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:37:50 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:37:50 | INFO | sqlalchemy.engine.Engine | [cached since 1642s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:37:50 | INFO | app.routers.user | Headers después de limpieza: ['username', 'email', 'full_name', 'password', 'active', 'superuser']
2025-08-23 12:37:58 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)
2025-08-23 12:37:58 | INFO | sqlalchemy.engine.Engine | [cached since 419.1s ago (insertmanyvalues) 1/1 (unordered)] (UUID('6642c4f4-ff3d-4466-8685-bb8992d747b2'), None, 'user1@example.com', 'User 1', '$2b$12$SKUc1k6Z8aQop848jTWsYOqt9rD67g95kk5G5IORYnN9aBmUd4bWO', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 571973, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 571977, tzinfo=datetime.timezone.utc), UUID('85233979-a64a-481c-b106-0ce3ec742b95'), None, 'user2@example.com', 'User 2', '$2b$12$pmtTeei1rctRhCZh35qcZeuSGto42/JcLbJkW/OqqkwiUJWyysUgO', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 571986, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 571987, tzinfo=datetime.timezone.utc), UUID('897e3135-ff27-41f6-9ece-032bcbcc32da'), None, 'user3@example.com', 'User 3', '$2b$12$Tv3/QaqMuz/yvQ0c9u6z9eKOWHnRE89sSVHZ0PkGhs5Og7nLSDhhi', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 571992, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 571993, tzinfo=datetime.timezone.utc), UUID('3ec83843-81d0-4417-a588-c20871dc04aa'), None, 'user4@example.com', 'User 4', '$2b$12$DvQV2O9iqCuWXMXuMxW/FejFR3NsVdrSDgaf8ojdji0kal.Lxaqsu', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572001, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572002, tzinfo=datetime.timezone.utc), UUID('a262e173-768e-4651-b6b8-afebdf2c5470'), None, 'user5@example.com', 'User 5', '$2b$12$VwM38XMATHyMvZJkaRhl3eLUZc1y45mYbRBIjtt31Yc.cE4r5qiWS', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572016, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572017, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('7a547fb1-4866-44d5-9715-98d1e58184c2'), None, 'user16@example.com', 'User 16', '$2b$12$kBG/R3k9Q.sChuiFKA0ZQevIrFErqrLWZLCk2Buw0xhx/defzshzu', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572145, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572146, tzinfo=datetime.timezone.utc), UUID('43d75199-7942-4600-b27d-0024b23c4137'), None, 'user17@example.com', 'User 17', '$2b$12$8LdNs3YiOLtWOxdZc.XeYu4egPE84u/KOOvHr1jq6OgCptiq/OUs.', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572474, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572481, tzinfo=datetime.timezone.utc), UUID('2526d0da-af6e-4ef2-8307-b8f0a82569b0'), None, 'user18@example.com', 'User 18', '$2b$12$PqBc9xMoxQgg0qzCNoOgg.MQIcyXBkmAFjzOE7AeIWLMmbthOyLxG', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 574100, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 574107, tzinfo=datetime.timezone.utc), UUID('cfb3edc4-d7ed-4226-b18a-fd46d2a13eae'), None, 'user19@example.com', 'User 19', '$2b$12$Fyv4L9MJlfvo1qAtpuwupO7dnJU3ni4KbXPOLMFoM/SNE00XS35rW', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 574124, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 574125, tzinfo=datetime.timezone.utc), UUID('4a5d0f5d-0c2a-4dd2-8fc9-c2c11c25e876'), None, 'user20@example.com', 'User 20', '$2b$12$hI21D9CLScUwvlugA6/T5uTow8lDhKr0lpmt980K7EpTpdI1qT5TK', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 574134, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 574135, tzinfo=datetime.timezone.utc))
2025-08-23 12:37:58 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:37:58 | ERROR | app.routers.user | Error de integridad en importación masiva: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6642c4f4-ff3d-4466-8685-bb8992d747b2, null, user1@example.com, User 1, $2b$12$SKUc1k6Z8aQop848jTWsYOqt9rD67g95kk5G5IORYnN9aBmUd4bWO, t, t, null, 2025-08-23 12:37:58.571973-05, 2025-08-23 12:37:58.571977-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('6642c4f4-ff3d-4466-8685-bb8992d747b2'), None, 'user1@example.com', 'User 1', '$2b$12$SKUc1k6Z8aQop848jTWsYOqt9rD67g95kk5G5IORYnN9aBmUd4bWO', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 571973, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 571977, tzinfo=datetime.timezone.utc), UUID('85233979-a64a-481c-b106-0ce3ec742b95'), None, 'user2@example.com', 'User 2', '$2b$12$pmtTeei1rctRhCZh35qcZeuSGto42/JcLbJkW/OqqkwiUJWyysUgO', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 571986, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 571987, tzinfo=datetime.timezone.utc), UUID('897e3135-ff27-41f6-9ece-032bcbcc32da'), None, 'user3@example.com', 'User 3', '$2b$12$Tv3/QaqMuz/yvQ0c9u6z9eKOWHnRE89sSVHZ0PkGhs5Og7nLSDhhi', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 571992, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 571993, tzinfo=datetime.timezone.utc), UUID('3ec83843-81d0-4417-a588-c20871dc04aa'), None, 'user4@example.com', 'User 4', '$2b$12$DvQV2O9iqCuWXMXuMxW/FejFR3NsVdrSDgaf8ojdji0kal.Lxaqsu', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572001, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572002, tzinfo=datetime.timezone.utc), UUID('a262e173-768e-4651-b6b8-afebdf2c5470'), None, 'user5@example.com', 'User 5', '$2b$12$VwM38XMATHyMvZJkaRhl3eLUZc1y45mYbRBIjtt31Yc.cE4r5qiWS', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572016, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572017, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('7a547fb1-4866-44d5-9715-98d1e58184c2'), None, 'user16@example.com', 'User 16', '$2b$12$kBG/R3k9Q.sChuiFKA0ZQevIrFErqrLWZLCk2Buw0xhx/defzshzu', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572145, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572146, tzinfo=datetime.timezone.utc), UUID('43d75199-7942-4600-b27d-0024b23c4137'), None, 'user17@example.com', 'User 17', '$2b$12$8LdNs3YiOLtWOxdZc.XeYu4egPE84u/KOOvHr1jq6OgCptiq/OUs.', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572474, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572481, tzinfo=datetime.timezone.utc), UUID('2526d0da-af6e-4ef2-8307-b8f0a82569b0'), None, 'user18@example.com', 'User 18', '$2b$12$PqBc9xMoxQgg0qzCNoOgg.MQIcyXBkmAFjzOE7AeIWLMmbthOyLxG', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 574100, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 574107, tzinfo=datetime.timezone.utc), UUID('cfb3edc4-d7ed-4226-b18a-fd46d2a13eae'), None, 'user19@example.com', 'User 19', '$2b$12$Fyv4L9MJlfvo1qAtpuwupO7dnJU3ni4KbXPOLMFoM/SNE00XS35rW', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 574124, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 574125, tzinfo=datetime.timezone.utc), UUID('4a5d0f5d-0c2a-4dd2-8fc9-c2c11c25e876'), None, 'user20@example.com', 'User 20', '$2b$12$hI21D9CLScUwvlugA6/T5uTow8lDhKr0lpmt980K7EpTpdI1qT5TK', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 574134, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 574135, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6642c4f4-ff3d-4466-8685-bb8992d747b2, null, user1@example.com, User 1, $2b$12$SKUc1k6Z8aQop848jTWsYOqt9rD67g95kk5G5IORYnN9aBmUd4bWO, t, t, null, 2025-08-23 12:37:58.571973-05, 2025-08-23 12:37:58.571977-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6642c4f4-ff3d-4466-8685-bb8992d747b2, null, user1@example.com, User 1, $2b$12$SKUc1k6Z8aQop848jTWsYOqt9rD67g95kk5G5IORYnN9aBmUd4bWO, t, t, null, 2025-08-23 12:37:58.571973-05, 2025-08-23 12:37:58.571977-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 245, in import_users
    await log_action(
    ...<5 lines>...
    )
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit.py", line 28, in log_action
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (6642c4f4-ff3d-4466-8685-bb8992d747b2, null, user1@example.com, User 1, $2b$12$SKUc1k6Z8aQop848jTWsYOqt9rD67g95kk5G5IORYnN9aBmUd4bWO, t, t, null, 2025-08-23 12:37:58.571973-05, 2025-08-23 12:37:58.571977-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('6642c4f4-ff3d-4466-8685-bb8992d747b2'), None, 'user1@example.com', 'User 1', '$2b$12$SKUc1k6Z8aQop848jTWsYOqt9rD67g95kk5G5IORYnN9aBmUd4bWO', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 571973, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 571977, tzinfo=datetime.timezone.utc), UUID('85233979-a64a-481c-b106-0ce3ec742b95'), None, 'user2@example.com', 'User 2', '$2b$12$pmtTeei1rctRhCZh35qcZeuSGto42/JcLbJkW/OqqkwiUJWyysUgO', True, True, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 571986, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 571987, tzinfo=datetime.timezone.utc), UUID('897e3135-ff27-41f6-9ece-032bcbcc32da'), None, 'user3@example.com', 'User 3', '$2b$12$Tv3/QaqMuz/yvQ0c9u6z9eKOWHnRE89sSVHZ0PkGhs5Og7nLSDhhi', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 571992, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 571993, tzinfo=datetime.timezone.utc), UUID('3ec83843-81d0-4417-a588-c20871dc04aa'), None, 'user4@example.com', 'User 4', '$2b$12$DvQV2O9iqCuWXMXuMxW/FejFR3NsVdrSDgaf8ojdji0kal.Lxaqsu', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572001, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572002, tzinfo=datetime.timezone.utc), UUID('a262e173-768e-4651-b6b8-afebdf2c5470'), None, 'user5@example.com', 'User 5', '$2b$12$VwM38XMATHyMvZJkaRhl3eLUZc1y45mYbRBIjtt31Yc.cE4r5qiWS', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572016, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572017, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('7a547fb1-4866-44d5-9715-98d1e58184c2'), None, 'user16@example.com', 'User 16', '$2b$12$kBG/R3k9Q.sChuiFKA0ZQevIrFErqrLWZLCk2Buw0xhx/defzshzu', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572145, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572146, tzinfo=datetime.timezone.utc), UUID('43d75199-7942-4600-b27d-0024b23c4137'), None, 'user17@example.com', 'User 17', '$2b$12$8LdNs3YiOLtWOxdZc.XeYu4egPE84u/KOOvHr1jq6OgCptiq/OUs.', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 572474, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 572481, tzinfo=datetime.timezone.utc), UUID('2526d0da-af6e-4ef2-8307-b8f0a82569b0'), None, 'user18@example.com', 'User 18', '$2b$12$PqBc9xMoxQgg0qzCNoOgg.MQIcyXBkmAFjzOE7AeIWLMmbthOyLxG', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 574100, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 574107, tzinfo=datetime.timezone.utc), UUID('cfb3edc4-d7ed-4226-b18a-fd46d2a13eae'), None, 'user19@example.com', 'User 19', '$2b$12$Fyv4L9MJlfvo1qAtpuwupO7dnJU3ni4KbXPOLMFoM/SNE00XS35rW', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 574124, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 574125, tzinfo=datetime.timezone.utc), UUID('4a5d0f5d-0c2a-4dd2-8fc9-c2c11c25e876'), None, 'user20@example.com', 'User 20', '$2b$12$hI21D9CLScUwvlugA6/T5uTow8lDhKr0lpmt980K7EpTpdI1qT5TK', True, False, None, datetime.datetime(2025, 8, 23, 17, 37, 58, 574134, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 37, 58, 574135, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 12:42:41 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:42:41 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:42:41 | INFO | sqlalchemy.engine.Engine | [cached since 1934s ago] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:42:42 | INFO | app.routers.user | Headers después de limpieza: ['username', 'email', 'full_name', 'password', 'active', 'superuser']
2025-08-23 12:42:50 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)
2025-08-23 12:42:50 | INFO | sqlalchemy.engine.Engine | [cached since 710.7s ago (insertmanyvalues) 1/1 (unordered)] (UUID('df3e4e8b-df75-493a-b61d-fb56a6d21743'), None, 'user1@example.com', 'User 1', '$2b$12$eC7eXa8K5HjACd./0t4yMe9lCdQWvmivwsD9gzZMgL5KDf95clT.i', True, True, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169488, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169491, tzinfo=datetime.timezone.utc), UUID('09fd613e-6b76-44cd-8952-a3994894e653'), None, 'user2@example.com', 'User 2', '$2b$12$8OZSjRgZ6OQH/9U2wB0j5.MbWdIocTrFCoDrhfiTxCdoHl6lkrT3.', True, True, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169497, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169497, tzinfo=datetime.timezone.utc), UUID('e070e105-ce9f-4e0a-b729-8973df1280a2'), None, 'user3@example.com', 'User 3', '$2b$12$hAwh3G0XNLVN07V4SVIiV.V9b4CBRUg9LqYfk0aLs1MrOjq3ZQQfK', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169501, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169502, tzinfo=datetime.timezone.utc), UUID('13d33f25-7334-46f6-8080-80a6329aafec'), None, 'user4@example.com', 'User 4', '$2b$12$tNpR1H5dRJAYdjDeiBC2TuXNbkulvzlIhX1ZPTSbnGw01mGvT1wry', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169506, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169507, tzinfo=datetime.timezone.utc), UUID('4d07c7f1-a632-434f-b734-3d328670d028'), None, 'user5@example.com', 'User 5', '$2b$12$RISxCsQT5Z.erqPPvitfyui2vobmMF2fLjzzzvedqv.W0dvZ6KtAS', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169510, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169510, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('ec593085-5e06-49bc-a4d9-35d63d165228'), None, 'user16@example.com', 'User 16', '$2b$12$PX9nrlT14K0hyeMSfvxMuOFENUsNg6fagsV6jXAiCviX2eRzhB2gW', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169549, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169549, tzinfo=datetime.timezone.utc), UUID('12529422-5521-46bb-8127-6166bc20df19'), None, 'user17@example.com', 'User 17', '$2b$12$ZnNaRJzq0X06ViIJPTcEuOMGbLCMvmU6/bnnFURk5OYe6VMAISkPW', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169552, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169553, tzinfo=datetime.timezone.utc), UUID('a0aab767-323b-4c92-b543-925464eb6370'), None, 'user18@example.com', 'User 18', '$2b$12$TA/2M1dCcgFxRDflvLZJKORKOQGdSOrqmgaaDuY/ELmAGefAzTVVS', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169556, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169556, tzinfo=datetime.timezone.utc), UUID('8f66bbd6-ac55-4931-9cea-28e6f793caeb'), None, 'user19@example.com', 'User 19', '$2b$12$GLlcY3/ri7dc/wl.N0muxO6mpPe1jaEjHj7uOhN7oN0HWF4jbzE6G', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169559, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169560, tzinfo=datetime.timezone.utc), UUID('5f474cd9-9718-4082-80d0-974d0591db69'), None, 'user20@example.com', 'User 20', '$2b$12$eibwX/0QqZyVLt5mGaCAhOCt8I43uxpjS1i3y54yXRY4uG9o.3RuC', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169563, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169564, tzinfo=datetime.timezone.utc))
2025-08-23 12:42:50 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:42:50 | ERROR | app.routers.user | Error de integridad en importación masiva: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (df3e4e8b-df75-493a-b61d-fb56a6d21743, null, user1@example.com, User 1, $2b$12$eC7eXa8K5HjACd./0t4yMe9lCdQWvmivwsD9gzZMgL5KDf95clT.i, t, t, null, 2025-08-23 12:42:50.169488-05, 2025-08-23 12:42:50.169491-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('df3e4e8b-df75-493a-b61d-fb56a6d21743'), None, 'user1@example.com', 'User 1', '$2b$12$eC7eXa8K5HjACd./0t4yMe9lCdQWvmivwsD9gzZMgL5KDf95clT.i', True, True, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169488, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169491, tzinfo=datetime.timezone.utc), UUID('09fd613e-6b76-44cd-8952-a3994894e653'), None, 'user2@example.com', 'User 2', '$2b$12$8OZSjRgZ6OQH/9U2wB0j5.MbWdIocTrFCoDrhfiTxCdoHl6lkrT3.', True, True, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169497, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169497, tzinfo=datetime.timezone.utc), UUID('e070e105-ce9f-4e0a-b729-8973df1280a2'), None, 'user3@example.com', 'User 3', '$2b$12$hAwh3G0XNLVN07V4SVIiV.V9b4CBRUg9LqYfk0aLs1MrOjq3ZQQfK', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169501, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169502, tzinfo=datetime.timezone.utc), UUID('13d33f25-7334-46f6-8080-80a6329aafec'), None, 'user4@example.com', 'User 4', '$2b$12$tNpR1H5dRJAYdjDeiBC2TuXNbkulvzlIhX1ZPTSbnGw01mGvT1wry', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169506, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169507, tzinfo=datetime.timezone.utc), UUID('4d07c7f1-a632-434f-b734-3d328670d028'), None, 'user5@example.com', 'User 5', '$2b$12$RISxCsQT5Z.erqPPvitfyui2vobmMF2fLjzzzvedqv.W0dvZ6KtAS', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169510, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169510, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('ec593085-5e06-49bc-a4d9-35d63d165228'), None, 'user16@example.com', 'User 16', '$2b$12$PX9nrlT14K0hyeMSfvxMuOFENUsNg6fagsV6jXAiCviX2eRzhB2gW', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169549, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169549, tzinfo=datetime.timezone.utc), UUID('12529422-5521-46bb-8127-6166bc20df19'), None, 'user17@example.com', 'User 17', '$2b$12$ZnNaRJzq0X06ViIJPTcEuOMGbLCMvmU6/bnnFURk5OYe6VMAISkPW', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169552, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169553, tzinfo=datetime.timezone.utc), UUID('a0aab767-323b-4c92-b543-925464eb6370'), None, 'user18@example.com', 'User 18', '$2b$12$TA/2M1dCcgFxRDflvLZJKORKOQGdSOrqmgaaDuY/ELmAGefAzTVVS', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169556, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169556, tzinfo=datetime.timezone.utc), UUID('8f66bbd6-ac55-4931-9cea-28e6f793caeb'), None, 'user19@example.com', 'User 19', '$2b$12$GLlcY3/ri7dc/wl.N0muxO6mpPe1jaEjHj7uOhN7oN0HWF4jbzE6G', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169559, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169560, tzinfo=datetime.timezone.utc), UUID('5f474cd9-9718-4082-80d0-974d0591db69'), None, 'user20@example.com', 'User 20', '$2b$12$eibwX/0QqZyVLt5mGaCAhOCt8I43uxpjS1i3y54yXRY4uG9o.3RuC', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169563, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169564, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (df3e4e8b-df75-493a-b61d-fb56a6d21743, null, user1@example.com, User 1, $2b$12$eC7eXa8K5HjACd./0t4yMe9lCdQWvmivwsD9gzZMgL5KDf95clT.i, t, t, null, 2025-08-23 12:42:50.169488-05, 2025-08-23 12:42:50.169491-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (df3e4e8b-df75-493a-b61d-fb56a6d21743, null, user1@example.com, User 1, $2b$12$eC7eXa8K5HjACd./0t4yMe9lCdQWvmivwsD9gzZMgL5KDf95clT.i, t, t, null, 2025-08-23 12:42:50.169488-05, 2025-08-23 12:42:50.169491-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 245, in import_users
    await log_action(
    ...<5 lines>...
    )
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit.py", line 28, in log_action
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (df3e4e8b-df75-493a-b61d-fb56a6d21743, null, user1@example.com, User 1, $2b$12$eC7eXa8K5HjACd./0t4yMe9lCdQWvmivwsD9gzZMgL5KDf95clT.i, t, t, null, 2025-08-23 12:42:50.169488-05, 2025-08-23 12:42:50.169491-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3260 characters truncated ... :BOOLEAN, $197::BOOLEAN, $198::UUID, $199::TIMESTAMP WITH TIME ZONE, $200::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('df3e4e8b-df75-493a-b61d-fb56a6d21743'), None, 'user1@example.com', 'User 1', '$2b$12$eC7eXa8K5HjACd./0t4yMe9lCdQWvmivwsD9gzZMgL5KDf95clT.i', True, True, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169488, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169491, tzinfo=datetime.timezone.utc), UUID('09fd613e-6b76-44cd-8952-a3994894e653'), None, 'user2@example.com', 'User 2', '$2b$12$8OZSjRgZ6OQH/9U2wB0j5.MbWdIocTrFCoDrhfiTxCdoHl6lkrT3.', True, True, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169497, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169497, tzinfo=datetime.timezone.utc), UUID('e070e105-ce9f-4e0a-b729-8973df1280a2'), None, 'user3@example.com', 'User 3', '$2b$12$hAwh3G0XNLVN07V4SVIiV.V9b4CBRUg9LqYfk0aLs1MrOjq3ZQQfK', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169501, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169502, tzinfo=datetime.timezone.utc), UUID('13d33f25-7334-46f6-8080-80a6329aafec'), None, 'user4@example.com', 'User 4', '$2b$12$tNpR1H5dRJAYdjDeiBC2TuXNbkulvzlIhX1ZPTSbnGw01mGvT1wry', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169506, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169507, tzinfo=datetime.timezone.utc), UUID('4d07c7f1-a632-434f-b734-3d328670d028'), None, 'user5@example.com', 'User 5', '$2b$12$RISxCsQT5Z.erqPPvitfyui2vobmMF2fLjzzzvedqv.W0dvZ6KtAS', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169510, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169510, tzinfo=datetime.timezone.utc) ... 100 parameters truncated ... UUID('ec593085-5e06-49bc-a4d9-35d63d165228'), None, 'user16@example.com', 'User 16', '$2b$12$PX9nrlT14K0hyeMSfvxMuOFENUsNg6fagsV6jXAiCviX2eRzhB2gW', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169549, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169549, tzinfo=datetime.timezone.utc), UUID('12529422-5521-46bb-8127-6166bc20df19'), None, 'user17@example.com', 'User 17', '$2b$12$ZnNaRJzq0X06ViIJPTcEuOMGbLCMvmU6/bnnFURk5OYe6VMAISkPW', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169552, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169553, tzinfo=datetime.timezone.utc), UUID('a0aab767-323b-4c92-b543-925464eb6370'), None, 'user18@example.com', 'User 18', '$2b$12$TA/2M1dCcgFxRDflvLZJKORKOQGdSOrqmgaaDuY/ELmAGefAzTVVS', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169556, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169556, tzinfo=datetime.timezone.utc), UUID('8f66bbd6-ac55-4931-9cea-28e6f793caeb'), None, 'user19@example.com', 'User 19', '$2b$12$GLlcY3/ri7dc/wl.N0muxO6mpPe1jaEjHj7uOhN7oN0HWF4jbzE6G', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169559, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169560, tzinfo=datetime.timezone.utc), UUID('5f474cd9-9718-4082-80d0-974d0591db69'), None, 'user20@example.com', 'User 20', '$2b$12$eibwX/0QqZyVLt5mGaCAhOCt8I43uxpjS1i3y54yXRY4uG9o.3RuC', True, False, None, datetime.datetime(2025, 8, 23, 17, 42, 50, 169563, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 42, 50, 169564, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | [generated in 0.00370s] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:46:23 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | [generated in 0.00099s] (UUID('d8d5ffc8-0692-4118-945b-ca04a47d0d8c'),)
2025-08-23 12:55:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:58:58 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:58:58 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 12:58:58 | INFO | sqlalchemy.engine.Engine | [generated in 0.00423s] ('admin@gmail.com',)
2025-08-23 12:58:58 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 12:58:59 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 12:58:59 | INFO | sqlalchemy.engine.Engine | [generated in 0.00099s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'admin', 'admin@gmail.com', None, '$2b$12$RVuHbDBlBBaa37GDe8LMU.YGkdbdKlYtD9V/vHmlWumweVUbSxvhq', True, False, None, None, datetime.datetime(2025, 8, 23, 17, 58, 59, 574963, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 17, 58, 59, 574966, tzinfo=datetime.timezone.utc))
2025-08-23 12:58:59 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 12:59:09 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:59:09 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 12:59:09 | INFO | sqlalchemy.engine.Engine | [generated in 0.00139s] ('admin@gmail.com',)
2025-08-23 12:59:09 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 12:59:24 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 12:59:24 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 12:59:24 | INFO | sqlalchemy.engine.Engine | [cached since 234.5s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 12:59:24 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:01:25 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:01:25 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:01:25 | INFO | sqlalchemy.engine.Engine | [cached since 355.9s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:01:25 | INFO | app.routers.user | Headers después de limpieza: ['username', 'email', 'full_name', 'password', 'active', 'superuser']
2025-08-23 13:01:33 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTA ... 3509 characters truncated ... 16::BOOLEAN, $217::UUID, $218::UUID, $219::TIMESTAMP WITH TIME ZONE, $220::TIMESTAMP WITH TIME ZONE)
2025-08-23 13:01:33 | INFO | sqlalchemy.engine.Engine | [generated in 0.00593s (insertmanyvalues) 1/1 (unordered)] (UUID('28538dc6-3e52-48df-9dae-ae56d749c493'), 'user1', 'user1@example.com', 'User 1', '$2b$12$7kJ0oiO/Oq5InZGur/oklegGHJu05FMwRUn2xLb.cmM2vxfPH4xki', True, True, None, None, datetime.datetime(2025, 8, 23, 18, 1, 33, 701624, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 1, 33, 701627, tzinfo=datetime.timezone.utc), UUID('65b9d207-b310-4cff-a874-e5f24592c8b7'), 'user2', 'user2@example.com', 'User 2', '$2b$12$JS2bXTp2v1SdG6KJwJFX2.rvgkgRF7inQOcEcWNGa3oFSLxZJHNfq', True, True, None, None, datetime.datetime(2025, 8, 23, 18, 1, 33, 701633, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 1, 33, 701634, tzinfo=datetime.timezone.utc), UUID('59d70806-b9a1-482c-b5f4-5ec292cf6d95'), 'user3', 'user3@example.com', 'User 3', '$2b$12$5dujwzPGHbKHWp76xaVZD.C7NBPpxD4J2s3EB3bSYlE3Lty6BANCS', True, False, None, None, datetime.datetime(2025, 8, 23, 18, 1, 33, 701639, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 1, 33, 701640, tzinfo=datetime.timezone.utc), UUID('87138fc3-7292-44c0-8627-741883955b12'), 'user4', 'user4@example.com', 'User 4', '$2b$12$lfQYNQyMGyfguukA.kJJwuR.CQwOvZbkxmIZsagzzEEd/iH2dQPS2', True, False, None, None, datetime.datetime(2025, 8, 23, 18, 1, 33, 701644, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 1, 33, 701644, tzinfo=datetime.timezone.utc), UUID('aec3ccb4-281e-4b1f-bc06-552f5bd5b9c1'), 'user5', 'user5@example.com', 'User 5', '$2b$12$0NHTDxBTYtQSV.ZsIkdlAOzW7FtCYQVc76ZDQCZ48K5l99o9LOW6m', True ... 120 parameters truncated ... True, False, None, None, datetime.datetime(2025, 8, 23, 18, 1, 33, 707265, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 1, 33, 707266, tzinfo=datetime.timezone.utc), UUID('ff312782-8571-4167-b4f6-3ac323b4df77'), 'user17', 'user17@example.com', 'User 17', '$2b$12$PxX/PNjH.Gq3/XlGLDHzueXjYW..rqm.mL7ufHvcKXcwXxwu.zBjS', True, False, None, None, datetime.datetime(2025, 8, 23, 18, 1, 33, 707269, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 1, 33, 707270, tzinfo=datetime.timezone.utc), UUID('8d1a86c7-3904-4006-9ada-ca6e82d48d10'), 'user18', 'user18@example.com', 'User 18', '$2b$12$yKrRddgAVkBFs68wiOfSH.uJsIJtbHKHeAY1ePkt/YIzmZUjQiZZ.', True, False, None, None, datetime.datetime(2025, 8, 23, 18, 1, 33, 707273, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 1, 33, 707274, tzinfo=datetime.timezone.utc), UUID('9d4dddcb-97e8-44e6-94a7-a59cee252a0f'), 'user19', 'user19@example.com', 'User 19', '$2b$12$li16EqImLkwvsgA7td9T6u2xa830sKFJPr61tIca3JlmL0LXnuY/C', True, False, None, None, datetime.datetime(2025, 8, 23, 18, 1, 33, 707278, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 1, 33, 707279, tzinfo=datetime.timezone.utc), UUID('d9b036cf-4f6a-4a08-8e1c-e2bdd058499e'), 'user20', 'user20@example.com', 'User 20', '$2b$12$62EIZqrIXfx3StnMJHjP1.LRQb580JTHqAE3v6BYDM2Ao5dZ00SMG', True, False, None, None, datetime.datetime(2025, 8, 23, 18, 1, 33, 707283, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 1, 33, 707283, tzinfo=datetime.timezone.utc))
2025-08-23 13:01:33 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:01:33 | INFO | sqlalchemy.engine.Engine | [generated in 0.00126s] (UUID('be946f76-f172-40f3-9e99-bda715b8905b'), 'IMPORT', 'User', None, 'Importación masiva: 20 usuarios importados.', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:01:33 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:01:33 | INFO | app.routers.user | Importación masiva de usuarios exitosa. Total importados: 20
2025-08-23 13:04:09 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:04:09 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:04:09 | INFO | sqlalchemy.engine.Engine | [cached since 519.6s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:04:09 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 13:04:09 | INFO | sqlalchemy.engine.Engine | [generated in 0.00099s] (UUID('5c34ba37-b77e-4df1-94c6-442e7947ae5f'), None, 'hanna@gmail.com', 'Melisa Ortiz', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 23, 18, 4, 9, 145228, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 4, 9, 145231, tzinfo=datetime.timezone.utc))
2025-08-23 13:04:09 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:04:09 | ERROR | app.crud.user | Error al crear la marca
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5c34ba37-b77e-4df1-94c6-442e7947ae5f, null, hanna@gmail.com, Melisa Ortiz, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 13:04:09.145228-05, 2025-08-23 13:04:09.145231-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5c34ba37-b77e-4df1-94c6-442e7947ae5f, null, hanna@gmail.com, Melisa Ortiz, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 13:04:09.145228-05, 2025-08-23 13:04:09.145231-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 27, in create_user
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5c34ba37-b77e-4df1-94c6-442e7947ae5f, null, hanna@gmail.com, Melisa Ortiz, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 13:04:09.145228-05, 2025-08-23 13:04:09.145231-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('5c34ba37-b77e-4df1-94c6-442e7947ae5f'), None, 'hanna@gmail.com', 'Melisa Ortiz', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 23, 18, 4, 9, 145228, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 4, 9, 145231, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 13:04:09 | ERROR | app.routers.user | Error de integridad al crear marca: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5c34ba37-b77e-4df1-94c6-442e7947ae5f, null, hanna@gmail.com, Melisa Ortiz, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 13:04:09.145228-05, 2025-08-23 13:04:09.145231-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('5c34ba37-b77e-4df1-94c6-442e7947ae5f'), None, 'hanna@gmail.com', 'Melisa Ortiz', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 23, 18, 4, 9, 145228, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 4, 9, 145231, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5c34ba37-b77e-4df1-94c6-442e7947ae5f, null, hanna@gmail.com, Melisa Ortiz, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 13:04:09.145228-05, 2025-08-23 13:04:09.145231-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5c34ba37-b77e-4df1-94c6-442e7947ae5f, null, hanna@gmail.com, Melisa Ortiz, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 13:04:09.145228-05, 2025-08-23 13:04:09.145231-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 35, in create_user_endpoint
    new_user, log = await create_user(db, user_in, current_user.id)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 27, in create_user
    await db.flush()
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «username» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5c34ba37-b77e-4df1-94c6-442e7947ae5f, null, hanna@gmail.com, Melisa Ortiz, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 13:04:09.145228-05, 2025-08-23 13:04:09.145231-05).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('5c34ba37-b77e-4df1-94c6-442e7947ae5f'), None, 'hanna@gmail.com', 'Melisa Ortiz', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 23, 18, 4, 9, 145228, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 4, 9, 145231, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 13:04:22 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:04:22 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:04:22 | INFO | sqlalchemy.engine.Engine | [cached since 533.4s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:04:22 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 13:04:22 | INFO | sqlalchemy.engine.Engine | [cached since 13.81s ago] (UUID('3b445dfe-5d69-49ff-aa45-c613ae227e97'), 'carlosma', 'hanna@gmail.com', 'Melisa Ortiz', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 23, 18, 4, 22, 951855, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 18, 4, 22, 951860, tzinfo=datetime.timezone.utc))
2025-08-23 13:04:22 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:04:22 | INFO | sqlalchemy.engine.Engine | [cached since 169.2s ago] (UUID('b00ce2ec-f067-4257-9a71-f812d70b0d3c'), 'CREATE', 'User', UUID('3b445dfe-5d69-49ff-aa45-c613ae227e97'), 'Marca creada: Melisa Ortiz', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:04:22 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:04:22 | INFO | app.routers.user | Marca creada exitosamente: 3b445dfe-5d69-49ff-aa45-c613ae227e97 - Melisa Ortiz por usuario 9b2a72a3-6458-492a-8f0c-068c8be9a999
2025-08-23 13:07:07 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:07:07 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:07:07 | INFO | sqlalchemy.engine.Engine | [cached since 697.5s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:07:07 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:07:45 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:07:45 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:07:45 | INFO | sqlalchemy.engine.Engine | [cached since 736.1s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:07:45 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:07:45 | INFO | sqlalchemy.engine.Engine | [cached since 736.1s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:07:45 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.full_name = $1::VARCHAR AND users.id != $2::UUID
2025-08-23 13:07:45 | INFO | sqlalchemy.engine.Engine | [generated in 0.00140s] ('Melisa Ortiz', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:07:45 | WARNING | app.crud.user | [update_user] Nombre duplicado: Melisa Ortiz
2025-08-23 13:07:45 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:07:45 | ERROR | app.crud.user | [update_user] Error inesperado
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 189, in update_user
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 400: Ya existe una marca con el nombre 'Melisa Ortiz'.
2025-08-23 13:07:45 | ERROR | app.routers.user | Error inesperado al actualizar marca
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 189, in update_user
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 400: Ya existe una marca con el nombre 'Melisa Ortiz'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 131, in update_user_endpoint
    updated, log = await update_user(db, user_in, current_user.id)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 245, in update_user
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: Error interno: 400: Ya existe una marca con el nombre 'Melisa Ortiz'.
2025-08-23 13:08:29 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:08:29 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:08:29 | INFO | sqlalchemy.engine.Engine | [cached since 780.3s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:08:29 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:08:29 | INFO | sqlalchemy.engine.Engine | [cached since 780.3s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:08:29 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:08:29 | INFO | sqlalchemy.engine.Engine | [cached since 416.1s ago] (UUID('39579c25-0499-4025-9fde-5927fdffb63b'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:08:29 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | [cached since 799.9s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT users.id AS id, users.username AS username, users.email AS email, users.full_name AS full_name, users.password AS password, users.active AS active, users.superuser AS superuser, users.role_id AS role_id, users.user_id AS user_id, users.created_at AS created_at, users.updated_at AS updated_at 
FROM users) AS anon_1
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | [generated in 0.00445s] ()
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users ORDER BY users.email 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | [generated in 0.00152s] (5, 20)
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | [cached since 435.7s ago] (UUID('19edb1ca-69cf-4d0c-a170-73a5e4a53a8a'), 'GETALL', 'User', None, "Consulta de marcas - filtros: search='None', active=None, skip=20, limit=5", UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:08:49 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | [cached since 812.3s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT users.id AS id, users.username AS username, users.email AS email, users.full_name AS full_name, users.password AS password, users.active AS active, users.superuser AS superuser, users.role_id AS role_id, users.user_id AS user_id, users.created_at AS created_at, users.updated_at AS updated_at 
FROM users) AS anon_1
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | [cached since 12.47s ago] ()
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users ORDER BY users.email 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | [generated in 0.00156s] (5, 0)
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | [cached since 448.2s ago] (UUID('16d4d05e-4a6a-461d-ba77-536069c989ed'), 'GETALL', 'User', None, "Consulta de marcas - filtros: search='None', active=None, skip=0, limit=5", UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:09:01 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:10:23 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:10:23 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:10:23 | INFO | sqlalchemy.engine.Engine | [cached since 894.4s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:10:23 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:10:23 | INFO | sqlalchemy.engine.Engine | [cached since 894.4s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:10:23 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.full_name = $1::VARCHAR AND users.id != $2::UUID
2025-08-23 13:10:23 | INFO | sqlalchemy.engine.Engine | [cached since 158.3s ago] ('User 1', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:10:23 | WARNING | app.crud.user | [update_user] Nombre duplicado: User 1
2025-08-23 13:10:23 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:10:23 | ERROR | app.crud.user | [update_user] Error inesperado
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 189, in update_user
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 400: Ya existe una marca con el nombre 'User 1'.
2025-08-23 13:10:23 | ERROR | app.routers.user | Error inesperado al actualizar marca
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 189, in update_user
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 400: Ya existe una marca con el nombre 'User 1'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 131, in update_user_endpoint
    updated, log = await update_user(db, user_in, current_user.id)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 245, in update_user
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: Error interno: 400: Ya existe una marca con el nombre 'User 1'.
2025-08-23 13:11:29 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:11:29 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:11:29 | INFO | sqlalchemy.engine.Engine | [cached since 960s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:11:29 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:11:29 | INFO | sqlalchemy.engine.Engine | [cached since 960s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:11:29 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:11:29 | INFO | sqlalchemy.engine.Engine | [cached since 595.8s ago] (UUID('c853d709-4f0f-462e-8d33-803001c92630'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:11:29 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:16:27 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:16:27 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:16:27 | INFO | sqlalchemy.engine.Engine | [cached since 1258s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:16:27 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:16:27 | INFO | sqlalchemy.engine.Engine | [cached since 1258s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:16:27 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:16:27 | INFO | sqlalchemy.engine.Engine | [cached since 894s ago] (UUID('26ec5292-267a-40fb-b320-ee596331f7da'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:16:27 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | [cached since 1276s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT users.id AS id, users.username AS username, users.email AS email, users.full_name AS full_name, users.password AS password, users.active AS active, users.superuser AS superuser, users.role_id AS role_id, users.user_id AS user_id, users.created_at AS created_at, users.updated_at AS updated_at 
FROM users) AS anon_1
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | [cached since 476.3s ago] ()
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users ORDER BY users.email 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | [cached since 463.8s ago] (5, 0)
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | [cached since 912s ago] (UUID('e0cee206-a418-4c0c-b4c2-3fdecb06fdda'), 'GETALL', 'User', None, "Consulta de marcas - filtros: search='None', active=None, skip=0, limit=5", UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:16:45 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:17:35 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:17:35 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:17:35 | INFO | sqlalchemy.engine.Engine | [cached since 1326s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:17:35 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:17:35 | INFO | sqlalchemy.engine.Engine | [cached since 1326s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:17:35 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:17:35 | INFO | sqlalchemy.engine.Engine | [cached since 961.9s ago] (UUID('3f693575-3799-4737-af53-46f0059197ee'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:17:35 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:17:57 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:17:57 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:17:57 | INFO | sqlalchemy.engine.Engine | [cached since 1348s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:17:57 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:17:57 | INFO | sqlalchemy.engine.Engine | [cached since 1348s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:17:57 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:17:57 | INFO | sqlalchemy.engine.Engine | [cached since 983.6s ago] (UUID('94580096-0c62-4206-944f-d31c87f54937'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:17:57 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:18:00 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:18:00 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:18:00 | INFO | sqlalchemy.engine.Engine | [cached since 1351s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:18:00 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:18:00 | INFO | sqlalchemy.engine.Engine | [cached since 1351s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:18:00 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:18:00 | INFO | sqlalchemy.engine.Engine | [cached since 986.8s ago] (UUID('7a692fdf-4813-4379-becf-17ca9c17e432'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:18:00 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:18:27 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:18:27 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:18:27 | INFO | sqlalchemy.engine.Engine | [cached since 1378s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:18:27 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:18:27 | INFO | sqlalchemy.engine.Engine | [cached since 1378s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:18:27 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:18:27 | INFO | sqlalchemy.engine.Engine | [cached since 1014s ago] (UUID('8f6d78b5-85b9-458d-922b-c7128492b85d'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:18:27 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:19:18 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:19:18 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:19:18 | INFO | sqlalchemy.engine.Engine | [cached since 1428s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:19:18 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:19:18 | INFO | sqlalchemy.engine.Engine | [cached since 1428s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:19:18 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:19:18 | INFO | sqlalchemy.engine.Engine | [cached since 1064s ago] (UUID('be659f50-0757-4e13-a89a-7a5d76f93822'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:19:18 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:20:28 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:20:28 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:20:28 | INFO | sqlalchemy.engine.Engine | [cached since 1499s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:20:28 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:20:28 | INFO | sqlalchemy.engine.Engine | [cached since 1499s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:20:28 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:20:28 | INFO | sqlalchemy.engine.Engine | [cached since 1135s ago] (UUID('f657f0f5-49e7-4ec6-9f40-8a1943ba2a9a'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:20:28 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | [generated in 0.02922s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | [cached since 0.06506s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | [generated in 0.00692s] (UUID('5a8072a2-64f5-41d5-8855-84d47d48bf82'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:20:53 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:39:33 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:39:33 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:39:33 | INFO | sqlalchemy.engine.Engine | [cached since 1120s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:39:33 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:39:33 | INFO | sqlalchemy.engine.Engine | [cached since 1120s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:39:33 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:39:33 | INFO | sqlalchemy.engine.Engine | [cached since 1120s ago] (UUID('e415c804-fa95-48de-a9e0-8dd1bed1ac33'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:39:33 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:39:51 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 13:39:51 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:39:51 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 13:39:51 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:39:51 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 13:39:51 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:39:51 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:39:52 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:39:52 | INFO | sqlalchemy.engine.Engine | [generated in 0.00218s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:39:52 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:39:55 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:39:55 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:39:55 | INFO | sqlalchemy.engine.Engine | [cached since 3.825s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:39:55 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | [generated in 0.00175s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:42:57 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:45:30 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:45:30 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:45:30 | INFO | sqlalchemy.engine.Engine | [cached since 153.5s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:45:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | [generated in 0.00178s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | [cached since 0.01467s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | [generated in 0.00243s] (UUID('7c2bccd0-1796-4b63-8702-56863504403e'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:45:46 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:54:48 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:54:48 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:54:48 | INFO | sqlalchemy.engine.Engine | [cached since 541.6s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:54:48 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:54:48 | INFO | sqlalchemy.engine.Engine | [cached since 541.6s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:54:48 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:54:48 | INFO | sqlalchemy.engine.Engine | [cached since 541.6s ago] (UUID('39f4aa24-0de0-4b22-bdb6-47bb0677154d'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:54:48 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | [generated in 0.00163s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | [cached since 0.0156s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | [generated in 0.00134s] (UUID('e661e11f-8b56-4da7-afce-56ecc5cfdceb'), 'GETID', 'User', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), 'Consultó marca: None', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:55:08 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 13:55:22 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 13:55:22 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:55:22 | INFO | sqlalchemy.engine.Engine | [cached since 13.85s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:55:22 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 13:55:22 | INFO | sqlalchemy.engine.Engine | [cached since 13.87s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 13:55:22 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.full_name = $1::VARCHAR AND users.id != $2::UUID
2025-08-23 13:55:22 | INFO | sqlalchemy.engine.Engine | [generated in 0.00876s] ('User 1', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 13:55:22 | WARNING | app.crud.user | [update_user] Nombre duplicado: User 1
2025-08-23 13:55:22 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 13:55:22 | ERROR | app.crud.user | [update_user] Error inesperado
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 189, in update_user
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 400: Ya existe una marca con el nombre 'User 1'.
2025-08-23 13:55:22 | ERROR | app.routers.user | Error inesperado al actualizar marca
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 189, in update_user
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 400: Ya existe una marca con el nombre 'User 1'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\user.py", line 131, in update_user_endpoint
    updated, log = await update_user(db, user_in, current_user.id)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 245, in update_user
    raise HTTPException(
    ...<2 lines>...
    )
fastapi.exceptions.HTTPException: 500: Error interno: 400: Ya existe una marca con el nombre 'User 1'.
2025-08-23 14:09:03 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 14:09:03 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 14:09:03 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 14:09:03 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 14:09:03 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 14:09:03 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 14:09:03 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 14:09:03 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 14:09:03 | INFO | sqlalchemy.engine.Engine | [generated in 0.02241s] ('admin@gmail.com',)
2025-08-23 14:09:03 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 14:09:04 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 14:09:15 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 14:09:15 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:09:15 | INFO | sqlalchemy.engine.Engine | [generated in 0.02089s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 14:09:15 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:09:15 | INFO | sqlalchemy.engine.Engine | [cached since 0.05524s ago] (UUID('28538dc6-3e52-48df-9dae-ae56d749c493'),)
2025-08-23 14:09:15 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 14:09:15 | INFO | sqlalchemy.engine.Engine | [generated in 0.01466s] (UUID('c47603c7-47c4-43b8-9931-d51e93b95842'), 'GETID', 'User', UUID('28538dc6-3e52-48df-9dae-ae56d749c493'), 'Consultó usuario: User 1', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 14:09:15 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 14:10:05 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 14:10:05 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:10:05 | INFO | sqlalchemy.engine.Engine | [cached since 50.78s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 14:10:05 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:10:05 | INFO | sqlalchemy.engine.Engine | [cached since 50.79s ago] (UUID('28538dc6-3e52-48df-9dae-ae56d749c493'),)
2025-08-23 14:10:05 | INFO | sqlalchemy.engine.Engine | UPDATE users SET active=$1::BOOLEAN, superuser=$2::BOOLEAN, updated_at=$3::TIMESTAMP WITH TIME ZONE WHERE users.id = $4::UUID
2025-08-23 14:10:05 | INFO | sqlalchemy.engine.Engine | [generated in 0.00559s] (False, False, datetime.datetime(2025, 8, 23, 19, 10, 5, 985884), UUID('28538dc6-3e52-48df-9dae-ae56d749c493'))
2025-08-23 14:10:06 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 14:10:06 | INFO | sqlalchemy.engine.Engine | [cached since 50.74s ago] (UUID('af07a0c0-b0b8-442d-8780-e6c8fcb81ca5'), 'UPDATE', 'User', UUID('28538dc6-3e52-48df-9dae-ae56d749c493'), 'active: True -> False; superuser: True -> False', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 14:10:06 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 14:10:06 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 14:10:06 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:10:06 | INFO | sqlalchemy.engine.Engine | [generated in 0.00357s] (UUID('28538dc6-3e52-48df-9dae-ae56d749c493'),)
2025-08-23 14:10:06 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | [cached since 115.3s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT users.id AS id, users.username AS username, users.email AS email, users.full_name AS full_name, users.password AS password, users.active AS active, users.superuser AS superuser, users.role_id AS role_id, users.user_id AS user_id, users.created_at AS created_at, users.updated_at AS updated_at 
FROM users) AS anon_1
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00791s] ()
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users ORDER BY users.email 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00573s] (5, 0)
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | [cached since 115.3s ago] (UUID('1375eea7-82b6-4a97-adbf-1c1699d5e65e'), 'GETALL', 'User', None, "Listó usuarios search='None' active=None skip=0 limit=5", UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 14:11:10 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | [cached since 148.3s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | [cached since 148.3s ago] (UUID('28538dc6-3e52-48df-9dae-ae56d749c493'),)
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | UPDATE users SET active=$1::BOOLEAN, updated_at=$2::TIMESTAMP WITH TIME ZONE WHERE users.id = $3::UUID
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | [generated in 0.00367s] (True, datetime.datetime(2025, 8, 23, 19, 11, 43, 504984), UUID('28538dc6-3e52-48df-9dae-ae56d749c493'))
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | [cached since 148.3s ago] (UUID('64de513f-b3f2-46fd-a1b6-ff5a3b8bfb89'), 'PATCH', 'User', UUID('28538dc6-3e52-48df-9dae-ae56d749c493'), "active: 'False' -> 'True'", UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | [cached since 97.51s ago] (UUID('28538dc6-3e52-48df-9dae-ae56d749c493'),)
2025-08-23 14:11:43 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 14:13:44 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 14:13:44 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:13:44 | INFO | sqlalchemy.engine.Engine | [cached since 269.5s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 14:13:44 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 14:13:44 | INFO | sqlalchemy.engine.Engine | [generated in 0.00288s] (UUID('2b1a1b2e-7849-4ac5-b1ad-b9ab7e231004'), 'carlosma', 'hanna@gmail.com', 'Melisa Ortiz', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 23, 19, 13, 44, 715197, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 19, 13, 44, 715207, tzinfo=datetime.timezone.utc))
2025-08-23 14:13:44 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 14:13:44 | ERROR | app.crud.user | [create_user] Error creando usuario
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.UniqueViolationError: llave duplicada viola restricción de unicidad «ix_users_email»
DETAIL:  Ya existe la llave (email)=(hanna@gmail.com).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: llave duplicada viola restricción de unicidad «ix_users_email»
DETAIL:  Ya existe la llave (email)=(hanna@gmail.com).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 32, in create_user
    await db.flush()  # obtiene user.id
    ^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: llave duplicada viola restricción de unicidad «ix_users_email»
DETAIL:  Ya existe la llave (email)=(hanna@gmail.com).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('2b1a1b2e-7849-4ac5-b1ad-b9ab7e231004'), 'carlosma', 'hanna@gmail.com', 'Melisa Ortiz', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 23, 19, 13, 44, 715197, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 19, 13, 44, 715207, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 14:13:58 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 14:13:58 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 14:13:58 | INFO | sqlalchemy.engine.Engine | [cached since 283.2s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 14:13:58 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 14:13:58 | INFO | sqlalchemy.engine.Engine | [cached since 13.67s ago] (UUID('29c54f48-6ce1-444e-9c7d-8d634b6b19c9'), 'carlosma1', 'hanna1@gmail.com', 'Melisa Ortiz', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 23, 19, 13, 58, 385540, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 23, 19, 13, 58, 385544, tzinfo=datetime.timezone.utc))
2025-08-23 14:13:58 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 14:13:58 | INFO | sqlalchemy.engine.Engine | [cached since 283.1s ago] (UUID('33a29c48-6ecc-4f7c-bae8-9217ce3c7335'), 'CREATE', 'User', UUID('29c54f48-6ce1-444e-9c7d-8d634b6b19c9'), 'Usuario creado: Melisa Ortiz', UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 14:13:58 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 15:21:38 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 15:21:38 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 15:21:38 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 15:21:38 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 15:21:38 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 15:21:38 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 15:21:38 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 15:21:38 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 15:21:38 | INFO | sqlalchemy.engine.Engine | [generated in 0.00471s] ('admin@gmail.com',)
2025-08-23 15:21:38 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 15:21:39 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 17:39:28 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 17:39:28 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 17:39:28 | INFO | sqlalchemy.engine.Engine | [cached since 8270s ago] ('admin@gmail.com',)
2025-08-23 17:39:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 17:39:48 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 17:39:48 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 17:39:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00288s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 17:39:48 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 17:39:54 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 17:39:54 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 17:39:54 | INFO | sqlalchemy.engine.Engine | [cached since 5.521s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 17:39:54 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | [generated in 0.00065s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 18:14:08 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 19:33:59 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 19:33:59 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 19:33:59 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 19:33:59 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 19:33:59 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 19:33:59 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 19:33:59 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:33:59 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 19:33:59 | INFO | sqlalchemy.engine.Engine | [generated in 0.00333s] ('admin@gmail.com',)
2025-08-23 19:33:59 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 19:34:00 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | [generated in 0.00244s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT users.id AS id, users.username AS username, users.email AS email, users.full_name AS full_name, users.password AS password, users.active AS active, users.superuser AS superuser, users.role_id AS role_id, users.user_id AS user_id, users.created_at AS created_at, users.updated_at AS updated_at 
FROM users) AS anon_1
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | [generated in 0.00374s] ()
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users ORDER BY users.email 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | [generated in 0.00771s] (5, 0)
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | [generated in 0.00393s] (UUID('d68de038-2c9f-4e3b-a62e-3ff0db05bd95'), 'GETALL', 'User', None, "Listó usuarios search='None' active=None skip=0 limit=5", UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 19:34:07 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 19:35:01 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:35:01 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 19:35:01 | INFO | sqlalchemy.engine.Engine | [cached since 54.58s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 19:35:01 | INFO | sqlalchemy.engine.Engine | SELECT roles.id, roles.name, roles.description, roles.role_type, roles.scopes, roles.is_admin, roles.active, roles.created_by, roles.created_at, roles.updated_at 
FROM roles ORDER BY roles.name ASC 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 19:35:01 | INFO | sqlalchemy.engine.Engine | [generated in 0.00353s] (5, 0)
2025-08-23 19:35:01 | INFO | sqlalchemy.engine.Engine | SELECT count(roles.id) AS count_1 
FROM roles
2025-08-23 19:35:01 | INFO | sqlalchemy.engine.Engine | [generated in 0.00164s] ()
2025-08-23 19:35:01 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | [cached since 195.9s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | SELECT count(*) AS count_1 
FROM (SELECT users.id AS id, users.username AS username, users.email AS email, users.full_name AS full_name, users.password AS password, users.active AS active, users.superuser AS superuser, users.role_id AS role_id, users.user_id AS user_id, users.created_at AS created_at, users.updated_at AS updated_at 
FROM users) AS anon_1
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | [cached since 195.9s ago] ()
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users ORDER BY users.email 
 LIMIT $1::INTEGER OFFSET $2::INTEGER
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | [generated in 0.00246s] (5, 0)
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | [cached since 195.9s ago] (UUID('07419920-de73-4d91-80ba-d0e4d59873b6'), 'GETALL', 'User', None, "Listó usuarios search='None' active=None skip=0 limit=5", UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'))
2025-08-23 19:37:23 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 19:39:48 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:39:48 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 19:39:48 | INFO | sqlalchemy.engine.Engine | [cached since 341.3s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 19:39:48 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 19:39:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00234s] (UUID('207e3a42-121d-4156-8018-80c05fa7ad75'), 'system', 'system@example.com', 'System', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 39, 48, 497314, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 39, 48, 497321, tzinfo=datetime.timezone.utc))
2025-08-23 19:39:48 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 19:39:48 | ERROR | app.crud.user | [create_user] Error creando usuario
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (207e3a42-121d-4156-8018-80c05fa7ad75, system, system@example.com, System, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:39:48.497314-05, 2025-08-23 19:39:48.497321-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (207e3a42-121d-4156-8018-80c05fa7ad75, system, system@example.com, System, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:39:48.497314-05, 2025-08-23 19:39:48.497321-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 32, in create_user
    await db.flush()  # obtiene user.id
    ^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (207e3a42-121d-4156-8018-80c05fa7ad75, system, system@example.com, System, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:39:48.497314-05, 2025-08-23 19:39:48.497321-05, null).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('207e3a42-121d-4156-8018-80c05fa7ad75'), 'system', 'system@example.com', 'System', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 39, 48, 497314, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 39, 48, 497321, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 19:41:11 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:41:11 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 19:41:11 | INFO | sqlalchemy.engine.Engine | [cached since 424.6s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 19:41:11 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 19:41:11 | INFO | sqlalchemy.engine.Engine | [cached since 83.28s ago] (UUID('bf3a20c6-4b44-444e-9357-6b5259186fa7'), 'inicio', 'inicio@example.com', 'Semilla sistema', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 41, 11, 772296, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 41, 11, 772301, tzinfo=datetime.timezone.utc))
2025-08-23 19:41:11 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 19:41:11 | ERROR | app.crud.user | [create_user] Error creando usuario
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (bf3a20c6-4b44-444e-9357-6b5259186fa7, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:41:11.772296-05, 2025-08-23 19:41:11.772301-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (bf3a20c6-4b44-444e-9357-6b5259186fa7, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:41:11.772296-05, 2025-08-23 19:41:11.772301-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 32, in create_user
    await db.flush()  # obtiene user.id
    ^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (bf3a20c6-4b44-444e-9357-6b5259186fa7, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:41:11.772296-05, 2025-08-23 19:41:11.772301-05, null).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('bf3a20c6-4b44-444e-9357-6b5259186fa7'), 'inicio', 'inicio@example.com', 'Semilla sistema', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 41, 11, 772296, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 41, 11, 772301, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | [generated in 0.00159s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | [generated in 0.00356s] (UUID('f8df1cef-fafe-4124-83d1-c6594554a39e'), 'inicio', 'inicio@example.com', 'Semilla sistema', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 42, 5, 216074, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 42, 5, 216078, tzinfo=datetime.timezone.utc))
2025-08-23 19:42:05 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 19:42:05 | ERROR | app.crud.user | [create_user] Error creando usuario
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f8df1cef-fafe-4124-83d1-c6594554a39e, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:42:05.216074-05, 2025-08-23 19:42:05.216078-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f8df1cef-fafe-4124-83d1-c6594554a39e, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:42:05.216074-05, 2025-08-23 19:42:05.216078-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 32, in create_user
    await db.flush()  # obtiene user.id
    ^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (f8df1cef-fafe-4124-83d1-c6594554a39e, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:42:05.216074-05, 2025-08-23 19:42:05.216078-05, null).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('f8df1cef-fafe-4124-83d1-c6594554a39e'), 'inicio', 'inicio@example.com', 'Semilla sistema', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 42, 5, 216074, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 42, 5, 216078, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | [generated in 0.00081s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | [generated in 0.00159s] (UUID('c9905836-2bde-45e5-b27c-9aeb17a09827'), 'inicio', 'inicio@example.com', 'Semilla sistema', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 42, 46, 222190, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 42, 46, 222194, tzinfo=datetime.timezone.utc))
2025-08-23 19:42:46 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 19:42:46 | ERROR | app.crud.user | [create_user] Error creando usuario
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c9905836-2bde-45e5-b27c-9aeb17a09827, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:42:46.22219-05, 2025-08-23 19:42:46.222194-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c9905836-2bde-45e5-b27c-9aeb17a09827, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:42:46.22219-05, 2025-08-23 19:42:46.222194-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 32, in create_user
    await db.flush()  # obtiene user.id
    ^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (c9905836-2bde-45e5-b27c-9aeb17a09827, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:42:46.22219-05, 2025-08-23 19:42:46.222194-05, null).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('c9905836-2bde-45e5-b27c-9aeb17a09827'), 'inicio', 'inicio@example.com', 'Semilla sistema', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 42, 46, 222190, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 42, 46, 222194, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 19:42:56 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:42:56 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 19:42:56 | INFO | sqlalchemy.engine.Engine | [generated in 0.00493s] ('admin@gmail.com',)
2025-08-23 19:42:56 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 19:42:57 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 19:43:12 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 19:43:12 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 19:43:12 | INFO | sqlalchemy.engine.Engine | [cached since 26.09s ago] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 19:43:12 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 19:43:12 | INFO | sqlalchemy.engine.Engine | [cached since 26.08s ago] (UUID('4330fe10-ec50-463f-9caa-2f6a0a5c8b35'), 'inicio', 'inicio@example.com', 'Semilla sistema', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 43, 12, 300758, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 43, 12, 300763, tzinfo=datetime.timezone.utc))
2025-08-23 19:43:12 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 19:43:12 | ERROR | app.crud.user | [create_user] Error creando usuario
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (4330fe10-ec50-463f-9caa-2f6a0a5c8b35, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:43:12.300758-05, 2025-08-23 19:43:12.300763-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (4330fe10-ec50-463f-9caa-2f6a0a5c8b35, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:43:12.300758-05, 2025-08-23 19:43:12.300763-05, null).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\crud\user.py", line 32, in create_user
    await db.flush()  # obtiene user.id
    ^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 801, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
        statement,
        params,
        execution_options=execution_options,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «system» de la relación «users» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (4330fe10-ec50-463f-9caa-2f6a0a5c8b35, inicio, inicio@example.com, Semilla sistema, 123456, t, f, null, 9b2a72a3-6458-492a-8f0c-068c8be9a999, 2025-08-23 19:43:12.300758-05, 2025-08-23 19:43:12.300763-05, null).
[SQL: INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('4330fe10-ec50-463f-9caa-2f6a0a5c8b35'), 'inicio', 'inicio@example.com', 'Semilla sistema', '123456', True, False, None, UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'), datetime.datetime(2025, 8, 24, 0, 43, 12, 300758, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 0, 43, 12, 300763, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 20:15:08 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 20:15:08 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:15:08 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 20:15:08 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:15:08 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 20:15:08 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:15:08 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:15:08 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:15:51 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:15:51 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:18:55 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 20:18:55 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:18:55 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 20:18:55 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:18:55 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 20:18:55 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:18:55 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:18:55 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:22:09 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 20:22:09 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:22:09 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 20:22:09 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:22:09 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 20:22:09 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:22:09 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:22:09 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:23:03 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 20:23:03 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:23:03 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 20:23:03 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:23:03 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 20:23:03 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:23:03 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:23:03 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:30:58 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 20:30:58 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:30:58 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 20:30:58 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:30:58 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 20:30:58 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:30:58 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:30:58 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 20:30:58 | INFO | sqlalchemy.engine.Engine | [generated in 0.00206s] ('system@example.com',)
2025-08-23 20:30:58 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 20:30:59 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE)
2025-08-23 20:30:59 | INFO | sqlalchemy.engine.Engine | [generated in 0.00670s] (UUID('e0239489-8f44-4e7d-83fe-dca4a3b8fd53'), 'system', 'system@example.com', None, '$2b$12$mT6cI3BY1Fd.nwxpWul3meYb00aZRet32MeC3y979d3gmMrX1hYUi', True, False, None, datetime.datetime(2025, 8, 24, 1, 30, 59, 607805, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 1, 30, 59, 607811, tzinfo=datetime.timezone.utc))
2025-08-23 20:30:59 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 20:39:28 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:39:28 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 20:39:28 | INFO | sqlalchemy.engine.Engine | [generated in 0.00383s] (UUID('9b2a72a3-6458-492a-8f0c-068c8be9a999'),)
2025-08-23 20:39:28 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:39:42 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:39:42 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 20:39:42 | INFO | sqlalchemy.engine.Engine | [generated in 0.00370s] ('admin@gmail.com',)
2025-08-23 20:39:42 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:39:51 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:39:51 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 20:39:51 | INFO | sqlalchemy.engine.Engine | [cached since 533s ago] ('system@example.com',)
2025-08-23 20:39:51 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:40:29 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:40:29 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 20:40:29 | INFO | sqlalchemy.engine.Engine | [cached since 46.48s ago] ('system@example.com',)
2025-08-23 20:40:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:42:26 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:42:26 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 20:42:26 | INFO | sqlalchemy.engine.Engine | [cached since 178.6s ago] (UUID('e0239489-8f44-4e7d-83fe-dca4a3b8fd53'),)
2025-08-23 20:42:26 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:42:53 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:42:53 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 20:42:53 | INFO | sqlalchemy.engine.Engine | [cached since 205.6s ago] (UUID('e0239489-8f44-4e7d-83fe-dca4a3b8fd53'),)
2025-08-23 20:42:53 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | [cached since 260.3s ago] (UUID('e0239489-8f44-4e7d-83fe-dca4a3b8fd53'),)
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | SELECT roles.id, roles.name, roles.description, roles.role_type, roles.scopes, roles.is_admin, roles.active, roles.created_by, roles.user_id, roles.created_at, roles.updated_at 
FROM roles 
WHERE roles.name = $1::VARCHAR
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00879s] ('system',)
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::JSON, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00816s] (UUID('8e23c587-7c79-45ff-bfcb-78aeff1079cc'), 'system', 'Rol de usuario del sistema', <RoleType.ADMIN: 'admin'>, '"[\\"read\\", \\"write\\", \\"admin\\"]"', True, True, None, None, datetime.datetime(2025, 8, 24, 1, 43, 48, 569131, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 1, 43, 48, 569136, tzinfo=datetime.timezone.utc))
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | SELECT roles.id, roles.name, roles.description, roles.role_type, roles.scopes, roles.is_admin, roles.active, roles.created_by, roles.user_id, roles.created_at, roles.updated_at 
FROM roles 
WHERE roles.id = $1::UUID
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00273s] (UUID('8e23c587-7c79-45ff-bfcb-78aeff1079cc'),)
2025-08-23 20:43:48 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:50:10 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 20:50:10 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:50:10 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 20:50:10 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:50:10 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 20:50:10 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 20:50:10 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:50:10 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 20:50:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.01435s] ('system@example.com',)
2025-08-23 20:50:10 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 20:50:11 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE)
2025-08-23 20:50:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00451s] (UUID('cb1826d5-03f5-4533-8d9e-b0e637afba10'), 'system', 'system@example.com', None, '$2b$12$6YcwxE.Wir42tE/K31/cMuhq/FlsLj/Q1k6Ju59B.8/9N23GE6M/i', True, False, None, datetime.datetime(2025, 8, 24, 1, 50, 11, 609299, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 1, 50, 11, 609306, tzinfo=datetime.timezone.utc))
2025-08-23 20:50:11 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 20:50:19 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:50:19 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 20:50:19 | INFO | sqlalchemy.engine.Engine | [generated in 0.00953s] ('system@example.com',)
2025-08-23 20:50:20 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | [generated in 0.00335s] (UUID('cb1826d5-03f5-4533-8d9e-b0e637afba10'),)
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | SELECT roles.id, roles.name, roles.description, roles.role_type, roles.scopes, roles.is_admin, roles.active, roles.created_by, roles.user_id, roles.created_at, roles.updated_at 
FROM roles 
WHERE roles.name = $1::VARCHAR
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | [generated in 0.00961s] ('system',)
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::JSON, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | [generated in 0.03549s] (UUID('261418aa-2eee-447c-a217-f5110db4d521'), 'system', 'Rol de usuario del sistema', <RoleType.ADMIN: 'admin'>, '"[\\"read\\", \\"write\\", \\"admin\\"]"', True, True, None, None, datetime.datetime(2025, 8, 24, 1, 50, 30, 359505, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 1, 50, 30, 359511, tzinfo=datetime.timezone.utc))
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | SELECT roles.id, roles.name, roles.description, roles.role_type, roles.scopes, roles.is_admin, roles.active, roles.created_by, roles.user_id, roles.created_at, roles.updated_at 
FROM roles 
WHERE roles.id = $1::UUID
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | [generated in 0.01156s] (UUID('261418aa-2eee-447c-a217-f5110db4d521'),)
2025-08-23 20:50:30 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:54:26 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:54:26 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 20:54:26 | INFO | sqlalchemy.engine.Engine | [cached since 255.9s ago] ('system@example.com',)
2025-08-23 20:54:26 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 20:59:37 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 20:59:37 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 20:59:37 | INFO | sqlalchemy.engine.Engine | [cached since 566.7s ago] ('system@example.com',)
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | [generated in 0.00247s] ('system@example.com',)
2025-08-23 21:00:44 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 21:05:30 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 21:05:30 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 21:05:30 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 21:05:30 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 21:05:30 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 21:05:30 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 21:05:30 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 21:05:30 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 21:05:31 | INFO | sqlalchemy.engine.Engine | [generated in 0.11664s] ('system@example.com',)
2025-08-23 21:05:31 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 21:05:31 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $10::TIMESTAMP WITH TIME ZONE)
2025-08-23 21:05:31 | INFO | sqlalchemy.engine.Engine | [generated in 0.01291s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), 'system', 'system@example.com', None, '$2b$12$ENV4HmngNWeSNsy59Zmohew147WGLlw7WUro2wFkC8e822yyX2PHy', True, False, None, datetime.datetime(2025, 8, 24, 2, 5, 31, 971832, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 2, 5, 31, 971852, tzinfo=datetime.timezone.utc))
2025-08-23 21:05:31 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 21:05:44 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 21:05:44 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 21:05:44 | INFO | sqlalchemy.engine.Engine | [generated in 0.00912s] ('system@example.com',)
2025-08-23 21:05:45 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 21:10:23 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 21:10:23 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 21:10:23 | INFO | sqlalchemy.engine.Engine | [generated in 0.00240s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 21:10:23 | INFO | app.routers.setting | Headers después de limpieza: ['key', 'value', 'type', 'description']
2025-08-23 21:10:23 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 21:10:23 | INFO | sqlalchemy.engine.Engine | [generated in 0.04074s] (UUID('60548d77-b96f-4d3d-816e-1b2c0cdae5c1'), 'IMPORT', 'Setting', None, 'Importación masiva: 12 configuraciones importadas.', UUID('17cdb0d0-5746-4730-914f-78b3028270d6'))
2025-08-23 21:10:23 | INFO | sqlalchemy.engine.Engine | INSERT INTO settings (id, key, value, type, description, active, user_id, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::UUID, $8::TIMESTAMP WITH TIME ZONE), ($9::UUID, $10::VARCHAR, $11::VARCHAR, $ ... 1275 characters truncated ... , $94::BOOLEAN, $95::UUID, $96::TIMESTAMP WITH TIME ZONE) RETURNING settings.created_at, settings.id
2025-08-23 21:10:23 | INFO | sqlalchemy.engine.Engine | [generated in 0.00079s (insertmanyvalues) 1/1 (ordered)] (UUID('769c0176-05b7-47ea-83e1-f647d5f76253'), 'consecutive_by_year', 'True', 'bool', 'Define si los consecutivos de documentos se reinician cada año.', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('6b503c85-74e2-4e5e-823c-eb9da8da147d'), 'invoice_prefix', 'FACV', 'string', 'Prefijo para el consecutivo de las facturas de venta.', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('893ca8fc-6a52-419b-a490-89491546ec44'), 'currency', 'COP', 'string', 'Moneda por defecto del sistema.', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('4cb3079f-9767-4059-8c08-817e5ea01dbd'), 'max_users', '100', 'int', 'Cantidad máxima de usuarios permitidos.', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('2b6f6b59-6d3e-4e9a-9171-245fb6e9fa94'), 'company_name', 'Mi Empresa S.A.S', 'string', 'Nombre legal de la empresa.', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('35288f3b-a46b-4184-aa31-634659fb7abb'), 'tax_percentage', '19', 'int', 'Porcentaje general de impuesto aplicado a las ventas.', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('7d755039-f0f6-4235-a5f2-f7a021ae2b79'), 'backup_enabled', 'True', 'bool', 'Indica si las copias de seguridad automáticas están habilitadas.', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('eec8e6a5-6fda-4534-9e4c-546774e91da8'), 'theme', 'light', 'string', 'Tema visual predeterminado del sistema (claro u oscuro).', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('aba8c9e0-0ed7-45dd-b475-304b412f64bc'), 'support_email', 'soporte@miempresa.com', 'string', 'Correo de contacto para soporte técnico.', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('68d22cd3-a58e-4a0d-bf11-69a205f1a2b6'), 'timeout_minutes', '30', 'int', 'Tiempo de expiración de sesión de usuario en minutos.', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('a7050e29-ac05-40d3-80d4-c8a0f34c6b6d'), 'subcategories_use', 'True', 'bool', 'Uso de subcategorías', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, UUID('152dabc2-5fe9-41fd-818b-0e24288a952d'), 'audit_level', '3', 'int', 'Nivel de auditoria', True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None)
2025-08-23 21:10:23 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 21:10:23 | INFO | app.routers.setting | Importación masiva de configuraciones exitosa. Total importadas: 12
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00158s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | INSERT INTO users (id, username, email, full_name, password, active, superuser, role_id, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::TIMESTAMP WITH TIME ZONE, $11::TIMESTAMP WITH TIME ZONE)
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00758s] (UUID('993c0c3d-5705-42c6-8947-a672687b8136'), 'juancarlos', 'juan.carlos@example.com', 'Juan Carlos', 'MiClaveSegura123', True, False, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 2, 32, 10, 678006, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 2, 32, 10, 678011, tzinfo=datetime.timezone.utc))
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00269s] (UUID('b6324704-c125-4c3b-85f7-ba53a9579d9e'), 'CREATE', 'User', UUID('993c0c3d-5705-42c6-8947-a672687b8136'), 'Usuario creado: Juan Carlos', UUID('17cdb0d0-5746-4730-914f-78b3028270d6'))
2025-08-23 21:32:10 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 22:04:11 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:04:11 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:04:11 | INFO | sqlalchemy.engine.Engine | [cached since 1921s ago] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:04:11 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:04:11 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:04:11 | INFO | sqlalchemy.engine.Engine | [generated in 0.00040s (insertmanyvalues) 1/1 (unordered)] (UUID('23e22ac7-e413-44b7-9bd5-339e53b9cc14'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277829, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277832, tzinfo=datetime.timezone.utc), UUID('203b1a34-c477-40e8-adea-2b53e20cdcda'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277839, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277840, tzinfo=datetime.timezone.utc), UUID('81d4331d-5f8e-4e60-b063-c368e9524e8e'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277844, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277845, tzinfo=datetime.timezone.utc), UUID('a8455454-ec3f-4e8b-a1f1-7321b042fc75'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277849, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277849, tzinfo=datetime.timezone.utc), UUID('5ce5e3bf-4c6f-4328-b119-99f76e59a716'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277853, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277854, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('949e39ee-b624-4a42-900b-052f28815f3d'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277905, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277906, tzinfo=datetime.timezone.utc), UUID('07dabb40-7122-4b02-b6ce-d8ce34bccbe3'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277910, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277910, tzinfo=datetime.timezone.utc), UUID('206478ad-d152-411b-8968-d8b18246f96e'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277914, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277914, tzinfo=datetime.timezone.utc), UUID('230a449d-c96e-424e-b0b5-3ba05ba1d92a'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277917, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277918, tzinfo=datetime.timezone.utc), UUID('400aca73-6311-49b7-a125-4540fee6dd74'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277921, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277922, tzinfo=datetime.timezone.utc))
2025-08-23 22:04:11 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:04:11 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (23e22ac7-e413-44b7-9bd5-339e53b9cc14, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:04:11.277829-05, 2025-08-23 22:04:11.277832-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('23e22ac7-e413-44b7-9bd5-339e53b9cc14'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277829, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277832, tzinfo=datetime.timezone.utc), UUID('203b1a34-c477-40e8-adea-2b53e20cdcda'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277839, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277840, tzinfo=datetime.timezone.utc), UUID('81d4331d-5f8e-4e60-b063-c368e9524e8e'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277844, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277845, tzinfo=datetime.timezone.utc), UUID('a8455454-ec3f-4e8b-a1f1-7321b042fc75'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277849, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277849, tzinfo=datetime.timezone.utc), UUID('5ce5e3bf-4c6f-4328-b119-99f76e59a716'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277853, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277854, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('949e39ee-b624-4a42-900b-052f28815f3d'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277905, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277906, tzinfo=datetime.timezone.utc), UUID('07dabb40-7122-4b02-b6ce-d8ce34bccbe3'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277910, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277910, tzinfo=datetime.timezone.utc), UUID('206478ad-d152-411b-8968-d8b18246f96e'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277914, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277914, tzinfo=datetime.timezone.utc), UUID('230a449d-c96e-424e-b0b5-3ba05ba1d92a'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277917, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277918, tzinfo=datetime.timezone.utc), UUID('400aca73-6311-49b7-a125-4540fee6dd74'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277921, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277922, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (23e22ac7-e413-44b7-9bd5-339e53b9cc14, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:04:11.277829-05, 2025-08-23 22:04:11.277832-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (23e22ac7-e413-44b7-9bd5-339e53b9cc14, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:04:11.277829-05, 2025-08-23 22:04:11.277832-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (23e22ac7-e413-44b7-9bd5-339e53b9cc14, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:04:11.277829-05, 2025-08-23 22:04:11.277832-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('23e22ac7-e413-44b7-9bd5-339e53b9cc14'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277829, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277832, tzinfo=datetime.timezone.utc), UUID('203b1a34-c477-40e8-adea-2b53e20cdcda'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277839, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277840, tzinfo=datetime.timezone.utc), UUID('81d4331d-5f8e-4e60-b063-c368e9524e8e'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277844, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277845, tzinfo=datetime.timezone.utc), UUID('a8455454-ec3f-4e8b-a1f1-7321b042fc75'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277849, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277849, tzinfo=datetime.timezone.utc), UUID('5ce5e3bf-4c6f-4328-b119-99f76e59a716'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277853, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277854, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('949e39ee-b624-4a42-900b-052f28815f3d'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277905, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277906, tzinfo=datetime.timezone.utc), UUID('07dabb40-7122-4b02-b6ce-d8ce34bccbe3'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277910, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277910, tzinfo=datetime.timezone.utc), UUID('206478ad-d152-411b-8968-d8b18246f96e'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277914, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277914, tzinfo=datetime.timezone.utc), UUID('230a449d-c96e-424e-b0b5-3ba05ba1d92a'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277917, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277918, tzinfo=datetime.timezone.utc), UUID('400aca73-6311-49b7-a125-4540fee6dd74'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 11, 277921, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 11, 277922, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:04:28 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:04:28 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:04:28 | INFO | sqlalchemy.engine.Engine | [cached since 1938s ago] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:04:28 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:04:28 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:04:28 | INFO | sqlalchemy.engine.Engine | [cached since 17.66s ago (insertmanyvalues) 1/1 (unordered)] (UUID('293a9eee-6a96-4a64-a673-9029cdd93f36'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 931831, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 931843, tzinfo=datetime.timezone.utc), UUID('94610449-d150-4f90-8a37-f7a2225aeed8'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 931894, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 931900, tzinfo=datetime.timezone.utc), UUID('37b9838c-1814-4dd1-9b0e-d1fbea2051b1'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933167, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933181, tzinfo=datetime.timezone.utc), UUID('dd1b704c-836e-48b3-9771-388404d23cac'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933262, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933268, tzinfo=datetime.timezone.utc), UUID('356a0771-f3cf-45fe-83f4-dcd8877cf8d4'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933458, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933469, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('96a9f756-c0a5-4ea0-a3a9-d13deea7f232'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933971, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933975, tzinfo=datetime.timezone.utc), UUID('a6a408c7-cd08-4ee4-95b5-a7e6300fa342'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933993, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933996, tzinfo=datetime.timezone.utc), UUID('269f0a4a-38cb-498f-ae16-59a8e9bd6204'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 934014, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 934018, tzinfo=datetime.timezone.utc), UUID('34d23d36-b2d1-43d9-a091-91e059f4e762'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 934037, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 934040, tzinfo=datetime.timezone.utc), UUID('1c272fc1-3a9a-419b-b3ae-0e0540570b9d'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 934057, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 934061, tzinfo=datetime.timezone.utc))
2025-08-23 22:04:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:04:29 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (293a9eee-6a96-4a64-a673-9029cdd93f36, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:04:28.931831-05, 2025-08-23 22:04:28.931843-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('293a9eee-6a96-4a64-a673-9029cdd93f36'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 931831, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 931843, tzinfo=datetime.timezone.utc), UUID('94610449-d150-4f90-8a37-f7a2225aeed8'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 931894, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 931900, tzinfo=datetime.timezone.utc), UUID('37b9838c-1814-4dd1-9b0e-d1fbea2051b1'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933167, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933181, tzinfo=datetime.timezone.utc), UUID('dd1b704c-836e-48b3-9771-388404d23cac'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933262, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933268, tzinfo=datetime.timezone.utc), UUID('356a0771-f3cf-45fe-83f4-dcd8877cf8d4'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933458, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933469, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('96a9f756-c0a5-4ea0-a3a9-d13deea7f232'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933971, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933975, tzinfo=datetime.timezone.utc), UUID('a6a408c7-cd08-4ee4-95b5-a7e6300fa342'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933993, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933996, tzinfo=datetime.timezone.utc), UUID('269f0a4a-38cb-498f-ae16-59a8e9bd6204'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 934014, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 934018, tzinfo=datetime.timezone.utc), UUID('34d23d36-b2d1-43d9-a091-91e059f4e762'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 934037, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 934040, tzinfo=datetime.timezone.utc), UUID('1c272fc1-3a9a-419b-b3ae-0e0540570b9d'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 934057, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 934061, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (293a9eee-6a96-4a64-a673-9029cdd93f36, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:04:28.931831-05, 2025-08-23 22:04:28.931843-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (293a9eee-6a96-4a64-a673-9029cdd93f36, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:04:28.931831-05, 2025-08-23 22:04:28.931843-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (293a9eee-6a96-4a64-a673-9029cdd93f36, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:04:28.931831-05, 2025-08-23 22:04:28.931843-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('293a9eee-6a96-4a64-a673-9029cdd93f36'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 931831, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 931843, tzinfo=datetime.timezone.utc), UUID('94610449-d150-4f90-8a37-f7a2225aeed8'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 931894, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 931900, tzinfo=datetime.timezone.utc), UUID('37b9838c-1814-4dd1-9b0e-d1fbea2051b1'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933167, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933181, tzinfo=datetime.timezone.utc), UUID('dd1b704c-836e-48b3-9771-388404d23cac'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933262, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933268, tzinfo=datetime.timezone.utc), UUID('356a0771-f3cf-45fe-83f4-dcd8877cf8d4'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933458, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933469, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('96a9f756-c0a5-4ea0-a3a9-d13deea7f232'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933971, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933975, tzinfo=datetime.timezone.utc), UUID('a6a408c7-cd08-4ee4-95b5-a7e6300fa342'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 933993, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 933996, tzinfo=datetime.timezone.utc), UUID('269f0a4a-38cb-498f-ae16-59a8e9bd6204'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 934014, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 934018, tzinfo=datetime.timezone.utc), UUID('34d23d36-b2d1-43d9-a091-91e059f4e762'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 934037, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 934040, tzinfo=datetime.timezone.utc), UUID('1c272fc1-3a9a-419b-b3ae-0e0540570b9d'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 4, 28, 934057, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 4, 28, 934061, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:12:10 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:12:10 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:12:10 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:12:10 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:12:10 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:12:10 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:12:10 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:12:10 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 22:12:10 | INFO | sqlalchemy.engine.Engine | [generated in 0.00170s] ('system@example.com',)
2025-08-23 22:12:10 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 22:12:11 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:12:20 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:12:20 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:12:20 | INFO | sqlalchemy.engine.Engine | [generated in 0.00308s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:12:20 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:12:20 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:12:20 | INFO | sqlalchemy.engine.Engine | [generated in 0.00110s (insertmanyvalues) 1/1 (unordered)] (UUID('76305c48-e3b8-48fa-a03c-51d3b72497b2'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656202, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656208, tzinfo=datetime.timezone.utc), UUID('71617cad-b472-4a5f-a74c-58b3c6999d1e'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656228, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656231, tzinfo=datetime.timezone.utc), UUID('0ca47efe-1025-4480-83d9-a28ba67fadfa'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656243, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656245, tzinfo=datetime.timezone.utc), UUID('14405fd0-3b9f-4756-8221-f796913f1a5f'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656256, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656258, tzinfo=datetime.timezone.utc), UUID('2e7de1f3-1b40-4fd3-805e-f045bd60b41b'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656269, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656271, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('9411fd62-3ff0-45b4-9ed3-d872798c4eb2'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656432, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656434, tzinfo=datetime.timezone.utc), UUID('59a3c778-0ad1-44e0-b91c-27e9fbaf9974'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656445, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656447, tzinfo=datetime.timezone.utc), UUID('ca6032be-e992-4502-99ee-b2a3ee684248'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656457, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656459, tzinfo=datetime.timezone.utc), UUID('b89bf3a0-00c4-4378-b726-3bac013b24fd'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656469, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656471, tzinfo=datetime.timezone.utc), UUID('067a0197-1aa9-4cea-a3b4-cbac347b7703'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656481, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656483, tzinfo=datetime.timezone.utc))
2025-08-23 22:12:20 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:12:20 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (76305c48-e3b8-48fa-a03c-51d3b72497b2, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:12:20.656202-05, 2025-08-23 22:12:20.656208-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('76305c48-e3b8-48fa-a03c-51d3b72497b2'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656202, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656208, tzinfo=datetime.timezone.utc), UUID('71617cad-b472-4a5f-a74c-58b3c6999d1e'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656228, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656231, tzinfo=datetime.timezone.utc), UUID('0ca47efe-1025-4480-83d9-a28ba67fadfa'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656243, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656245, tzinfo=datetime.timezone.utc), UUID('14405fd0-3b9f-4756-8221-f796913f1a5f'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656256, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656258, tzinfo=datetime.timezone.utc), UUID('2e7de1f3-1b40-4fd3-805e-f045bd60b41b'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656269, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656271, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('9411fd62-3ff0-45b4-9ed3-d872798c4eb2'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656432, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656434, tzinfo=datetime.timezone.utc), UUID('59a3c778-0ad1-44e0-b91c-27e9fbaf9974'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656445, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656447, tzinfo=datetime.timezone.utc), UUID('ca6032be-e992-4502-99ee-b2a3ee684248'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656457, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656459, tzinfo=datetime.timezone.utc), UUID('b89bf3a0-00c4-4378-b726-3bac013b24fd'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656469, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656471, tzinfo=datetime.timezone.utc), UUID('067a0197-1aa9-4cea-a3b4-cbac347b7703'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656481, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656483, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (76305c48-e3b8-48fa-a03c-51d3b72497b2, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:12:20.656202-05, 2025-08-23 22:12:20.656208-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (76305c48-e3b8-48fa-a03c-51d3b72497b2, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:12:20.656202-05, 2025-08-23 22:12:20.656208-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (76305c48-e3b8-48fa-a03c-51d3b72497b2, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:12:20.656202-05, 2025-08-23 22:12:20.656208-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('76305c48-e3b8-48fa-a03c-51d3b72497b2'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656202, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656208, tzinfo=datetime.timezone.utc), UUID('71617cad-b472-4a5f-a74c-58b3c6999d1e'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656228, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656231, tzinfo=datetime.timezone.utc), UUID('0ca47efe-1025-4480-83d9-a28ba67fadfa'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656243, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656245, tzinfo=datetime.timezone.utc), UUID('14405fd0-3b9f-4756-8221-f796913f1a5f'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656256, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656258, tzinfo=datetime.timezone.utc), UUID('2e7de1f3-1b40-4fd3-805e-f045bd60b41b'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656269, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656271, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('9411fd62-3ff0-45b4-9ed3-d872798c4eb2'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656432, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656434, tzinfo=datetime.timezone.utc), UUID('59a3c778-0ad1-44e0-b91c-27e9fbaf9974'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656445, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656447, tzinfo=datetime.timezone.utc), UUID('ca6032be-e992-4502-99ee-b2a3ee684248'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656457, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656459, tzinfo=datetime.timezone.utc), UUID('b89bf3a0-00c4-4378-b726-3bac013b24fd'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656469, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656471, tzinfo=datetime.timezone.utc), UUID('067a0197-1aa9-4cea-a3b4-cbac347b7703'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 12, 20, 656481, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 12, 20, 656483, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:17:06 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:17:06 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:17:06 | INFO | sqlalchemy.engine.Engine | [cached since 286s ago] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:17:06 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:17:06 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:17:06 | INFO | sqlalchemy.engine.Engine | [cached since 286s ago (insertmanyvalues) 1/1 (unordered)] (UUID('79a2e824-9b5f-4902-900c-3e5b289413bd'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624350, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624355, tzinfo=datetime.timezone.utc), UUID('04cdceeb-bec1-4ff6-ad66-f74d62adc8ce'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624371, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624372, tzinfo=datetime.timezone.utc), UUID('2527a5ee-3a48-420e-8f35-a8bb5bbdeaa1'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624381, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624382, tzinfo=datetime.timezone.utc), UUID('27d665b9-6d09-402f-baf1-8243da833383'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624389, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624390, tzinfo=datetime.timezone.utc), UUID('03a7f43f-d4a9-4959-a6bc-123a309f2df9'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624397, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624398, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('0037bb30-521c-49bf-8e3a-e7a8e48b0d66'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635495, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635498, tzinfo=datetime.timezone.utc), UUID('85235ebe-1918-4335-83f0-621497e616b6'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635511, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635513, tzinfo=datetime.timezone.utc), UUID('a63abab5-1120-4e6e-8494-2a5407d660a1'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635523, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635525, tzinfo=datetime.timezone.utc), UUID('edc1a540-581b-4027-9ea7-ba7774928ade'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635535, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635537, tzinfo=datetime.timezone.utc), UUID('f71ba477-69e7-42c4-8fae-4e3cd649613f'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635547, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635549, tzinfo=datetime.timezone.utc))
2025-08-23 22:17:06 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:17:06 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (79a2e824-9b5f-4902-900c-3e5b289413bd, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:17:06.62435-05, 2025-08-23 22:17:06.624355-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('79a2e824-9b5f-4902-900c-3e5b289413bd'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624350, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624355, tzinfo=datetime.timezone.utc), UUID('04cdceeb-bec1-4ff6-ad66-f74d62adc8ce'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624371, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624372, tzinfo=datetime.timezone.utc), UUID('2527a5ee-3a48-420e-8f35-a8bb5bbdeaa1'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624381, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624382, tzinfo=datetime.timezone.utc), UUID('27d665b9-6d09-402f-baf1-8243da833383'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624389, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624390, tzinfo=datetime.timezone.utc), UUID('03a7f43f-d4a9-4959-a6bc-123a309f2df9'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624397, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624398, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('0037bb30-521c-49bf-8e3a-e7a8e48b0d66'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635495, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635498, tzinfo=datetime.timezone.utc), UUID('85235ebe-1918-4335-83f0-621497e616b6'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635511, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635513, tzinfo=datetime.timezone.utc), UUID('a63abab5-1120-4e6e-8494-2a5407d660a1'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635523, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635525, tzinfo=datetime.timezone.utc), UUID('edc1a540-581b-4027-9ea7-ba7774928ade'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635535, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635537, tzinfo=datetime.timezone.utc), UUID('f71ba477-69e7-42c4-8fae-4e3cd649613f'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635547, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635549, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (79a2e824-9b5f-4902-900c-3e5b289413bd, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:17:06.62435-05, 2025-08-23 22:17:06.624355-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (79a2e824-9b5f-4902-900c-3e5b289413bd, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:17:06.62435-05, 2025-08-23 22:17:06.624355-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (79a2e824-9b5f-4902-900c-3e5b289413bd, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:17:06.62435-05, 2025-08-23 22:17:06.624355-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('79a2e824-9b5f-4902-900c-3e5b289413bd'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624350, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624355, tzinfo=datetime.timezone.utc), UUID('04cdceeb-bec1-4ff6-ad66-f74d62adc8ce'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624371, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624372, tzinfo=datetime.timezone.utc), UUID('2527a5ee-3a48-420e-8f35-a8bb5bbdeaa1'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624381, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624382, tzinfo=datetime.timezone.utc), UUID('27d665b9-6d09-402f-baf1-8243da833383'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624389, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624390, tzinfo=datetime.timezone.utc), UUID('03a7f43f-d4a9-4959-a6bc-123a309f2df9'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 624397, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 624398, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('0037bb30-521c-49bf-8e3a-e7a8e48b0d66'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635495, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635498, tzinfo=datetime.timezone.utc), UUID('85235ebe-1918-4335-83f0-621497e616b6'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635511, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635513, tzinfo=datetime.timezone.utc), UUID('a63abab5-1120-4e6e-8494-2a5407d660a1'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635523, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635525, tzinfo=datetime.timezone.utc), UUID('edc1a540-581b-4027-9ea7-ba7774928ade'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635535, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635537, tzinfo=datetime.timezone.utc), UUID('f71ba477-69e7-42c4-8fae-4e3cd649613f'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 6, 635547, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 6, 635549, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | [generated in 0.00257s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:17:27 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | [generated in 0.00122s (insertmanyvalues) 1/1 (unordered)] (UUID('1ec79aee-8830-4d8e-99d7-b22fe3bbd2cc'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480484, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480490, tzinfo=datetime.timezone.utc), UUID('cdba0fb7-45f0-48c6-beea-91f81d6ef134'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480508, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480510, tzinfo=datetime.timezone.utc), UUID('6770d10f-cec6-4fb4-abd2-b1df75b1eccb'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480521, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480522, tzinfo=datetime.timezone.utc), UUID('c8057001-043d-4e66-a217-81142cf34190'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480530, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480531, tzinfo=datetime.timezone.utc), UUID('5f9902a0-a16d-4ba9-8a3e-0038c9c24975'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480538, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480539, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('ac0f9e8f-7bbe-466f-a92b-b31f246aac47'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480675, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480677, tzinfo=datetime.timezone.utc), UUID('2e9a360a-f8ae-46b0-b586-d7be675f3fc7'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480699, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480701, tzinfo=datetime.timezone.utc), UUID('fbd4f1bd-e979-480c-904d-ab3ff5c62118'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480712, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480715, tzinfo=datetime.timezone.utc), UUID('c1afa293-4e52-48a8-b5bc-312a029fa6ef'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480725, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480727, tzinfo=datetime.timezone.utc), UUID('4d32aa6f-9d37-4499-b404-df1d26bd4fb1'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480808, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480812, tzinfo=datetime.timezone.utc))
2025-08-23 22:17:27 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:17:27 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (1ec79aee-8830-4d8e-99d7-b22fe3bbd2cc, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:17:27.480484-05, 2025-08-23 22:17:27.48049-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('1ec79aee-8830-4d8e-99d7-b22fe3bbd2cc'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480484, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480490, tzinfo=datetime.timezone.utc), UUID('cdba0fb7-45f0-48c6-beea-91f81d6ef134'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480508, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480510, tzinfo=datetime.timezone.utc), UUID('6770d10f-cec6-4fb4-abd2-b1df75b1eccb'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480521, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480522, tzinfo=datetime.timezone.utc), UUID('c8057001-043d-4e66-a217-81142cf34190'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480530, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480531, tzinfo=datetime.timezone.utc), UUID('5f9902a0-a16d-4ba9-8a3e-0038c9c24975'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480538, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480539, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('ac0f9e8f-7bbe-466f-a92b-b31f246aac47'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480675, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480677, tzinfo=datetime.timezone.utc), UUID('2e9a360a-f8ae-46b0-b586-d7be675f3fc7'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480699, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480701, tzinfo=datetime.timezone.utc), UUID('fbd4f1bd-e979-480c-904d-ab3ff5c62118'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480712, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480715, tzinfo=datetime.timezone.utc), UUID('c1afa293-4e52-48a8-b5bc-312a029fa6ef'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480725, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480727, tzinfo=datetime.timezone.utc), UUID('4d32aa6f-9d37-4499-b404-df1d26bd4fb1'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480808, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480812, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (1ec79aee-8830-4d8e-99d7-b22fe3bbd2cc, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:17:27.480484-05, 2025-08-23 22:17:27.48049-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (1ec79aee-8830-4d8e-99d7-b22fe3bbd2cc, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:17:27.480484-05, 2025-08-23 22:17:27.48049-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (1ec79aee-8830-4d8e-99d7-b22fe3bbd2cc, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:17:27.480484-05, 2025-08-23 22:17:27.48049-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('1ec79aee-8830-4d8e-99d7-b22fe3bbd2cc'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480484, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480490, tzinfo=datetime.timezone.utc), UUID('cdba0fb7-45f0-48c6-beea-91f81d6ef134'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480508, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480510, tzinfo=datetime.timezone.utc), UUID('6770d10f-cec6-4fb4-abd2-b1df75b1eccb'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480521, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480522, tzinfo=datetime.timezone.utc), UUID('c8057001-043d-4e66-a217-81142cf34190'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480530, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480531, tzinfo=datetime.timezone.utc), UUID('5f9902a0-a16d-4ba9-8a3e-0038c9c24975'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480538, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480539, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('ac0f9e8f-7bbe-466f-a92b-b31f246aac47'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480675, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480677, tzinfo=datetime.timezone.utc), UUID('2e9a360a-f8ae-46b0-b586-d7be675f3fc7'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480699, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480701, tzinfo=datetime.timezone.utc), UUID('fbd4f1bd-e979-480c-904d-ab3ff5c62118'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480712, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480715, tzinfo=datetime.timezone.utc), UUID('c1afa293-4e52-48a8-b5bc-312a029fa6ef'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480725, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480727, tzinfo=datetime.timezone.utc), UUID('4d32aa6f-9d37-4499-b404-df1d26bd4fb1'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 17, 27, 480808, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 17, 27, 480812, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | [generated in 0.00229s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:20:52 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | [generated in 0.00114s (insertmanyvalues) 1/1 (unordered)] (UUID('a4ebe150-616c-445c-8aef-ff216d0e8801'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327535, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327541, tzinfo=datetime.timezone.utc), UUID('7f98d786-391e-4b70-b6dd-e13d88670a5a'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327560, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327562, tzinfo=datetime.timezone.utc), UUID('82a3db79-1051-4f1a-b974-bcbc103e1dba'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327575, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327577, tzinfo=datetime.timezone.utc), UUID('e9289cae-f927-48cc-a2b2-1ea9512d567a'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327588, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327591, tzinfo=datetime.timezone.utc), UUID('859689c5-2612-460b-9f5c-dcade2c78158'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327604, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327606, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('c67befdb-b3bb-4360-80a0-667b3e58e1ab'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327762, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327765, tzinfo=datetime.timezone.utc), UUID('2ea86cd3-0570-4f8b-9c78-e0a7daacba57'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327776, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327778, tzinfo=datetime.timezone.utc), UUID('0d7db343-bd51-4516-a072-e0e161ec6693'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327789, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327791, tzinfo=datetime.timezone.utc), UUID('51942e4e-8240-438d-89bd-46c04f7c8011'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327802, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327805, tzinfo=datetime.timezone.utc), UUID('daea00ff-1972-4960-8a73-b54b3cc4801c'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327817, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327819, tzinfo=datetime.timezone.utc))
2025-08-23 22:20:52 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:20:52 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a4ebe150-616c-445c-8aef-ff216d0e8801, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:20:52.327535-05, 2025-08-23 22:20:52.327541-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('a4ebe150-616c-445c-8aef-ff216d0e8801'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327535, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327541, tzinfo=datetime.timezone.utc), UUID('7f98d786-391e-4b70-b6dd-e13d88670a5a'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327560, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327562, tzinfo=datetime.timezone.utc), UUID('82a3db79-1051-4f1a-b974-bcbc103e1dba'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327575, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327577, tzinfo=datetime.timezone.utc), UUID('e9289cae-f927-48cc-a2b2-1ea9512d567a'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327588, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327591, tzinfo=datetime.timezone.utc), UUID('859689c5-2612-460b-9f5c-dcade2c78158'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327604, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327606, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('c67befdb-b3bb-4360-80a0-667b3e58e1ab'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327762, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327765, tzinfo=datetime.timezone.utc), UUID('2ea86cd3-0570-4f8b-9c78-e0a7daacba57'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327776, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327778, tzinfo=datetime.timezone.utc), UUID('0d7db343-bd51-4516-a072-e0e161ec6693'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327789, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327791, tzinfo=datetime.timezone.utc), UUID('51942e4e-8240-438d-89bd-46c04f7c8011'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327802, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327805, tzinfo=datetime.timezone.utc), UUID('daea00ff-1972-4960-8a73-b54b3cc4801c'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327817, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327819, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a4ebe150-616c-445c-8aef-ff216d0e8801, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:20:52.327535-05, 2025-08-23 22:20:52.327541-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a4ebe150-616c-445c-8aef-ff216d0e8801, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:20:52.327535-05, 2025-08-23 22:20:52.327541-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (a4ebe150-616c-445c-8aef-ff216d0e8801, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:20:52.327535-05, 2025-08-23 22:20:52.327541-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('a4ebe150-616c-445c-8aef-ff216d0e8801'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327535, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327541, tzinfo=datetime.timezone.utc), UUID('7f98d786-391e-4b70-b6dd-e13d88670a5a'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327560, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327562, tzinfo=datetime.timezone.utc), UUID('82a3db79-1051-4f1a-b974-bcbc103e1dba'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327575, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327577, tzinfo=datetime.timezone.utc), UUID('e9289cae-f927-48cc-a2b2-1ea9512d567a'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327588, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327591, tzinfo=datetime.timezone.utc), UUID('859689c5-2612-460b-9f5c-dcade2c78158'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327604, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327606, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('c67befdb-b3bb-4360-80a0-667b3e58e1ab'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327762, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327765, tzinfo=datetime.timezone.utc), UUID('2ea86cd3-0570-4f8b-9c78-e0a7daacba57'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327776, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327778, tzinfo=datetime.timezone.utc), UUID('0d7db343-bd51-4516-a072-e0e161ec6693'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327789, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327791, tzinfo=datetime.timezone.utc), UUID('51942e4e-8240-438d-89bd-46c04f7c8011'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327802, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327805, tzinfo=datetime.timezone.utc), UUID('daea00ff-1972-4960-8a73-b54b3cc4801c'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 20, 52, 327817, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 20, 52, 327819, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:21:14 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:21:14 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:21:14 | INFO | sqlalchemy.engine.Engine | [cached since 22.6s ago] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:21:14 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:21:14 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:21:14 | INFO | sqlalchemy.engine.Engine | [cached since 22.6s ago (insertmanyvalues) 1/1 (unordered)] (UUID('5e82ff5b-c2fd-4760-a529-cca40527af1d'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922213, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922219, tzinfo=datetime.timezone.utc), UUID('10888483-2593-490d-bfd8-6e951bf6eafe'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922236, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922238, tzinfo=datetime.timezone.utc), UUID('465dd399-b516-4bf5-b95e-629507fb32c8'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922254, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922256, tzinfo=datetime.timezone.utc), UUID('5c2e4297-8244-4538-843c-6cd3f57abfa8'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922269, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922272, tzinfo=datetime.timezone.utc), UUID('4d09971b-111f-46ef-8d1d-8e448bc9ef0a'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922285, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922288, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('361d2aa9-8366-493d-a2b7-0d6da18f32aa'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922472, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922474, tzinfo=datetime.timezone.utc), UUID('153f76a1-086d-4dda-9ef5-2b4aea1444e9'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922487, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922491, tzinfo=datetime.timezone.utc), UUID('13ff8cda-71ae-4990-aa9a-18aafe5a87ba'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922503, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922505, tzinfo=datetime.timezone.utc), UUID('01ea56ec-d495-42fb-9d7c-09b0c0f93c48'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922517, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922520, tzinfo=datetime.timezone.utc), UUID('3d1288f4-d197-4de5-999b-4b90e7b4906f'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922532, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922534, tzinfo=datetime.timezone.utc))
2025-08-23 22:21:14 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:21:14 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5e82ff5b-c2fd-4760-a529-cca40527af1d, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:21:14.922213-05, 2025-08-23 22:21:14.922219-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('5e82ff5b-c2fd-4760-a529-cca40527af1d'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922213, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922219, tzinfo=datetime.timezone.utc), UUID('10888483-2593-490d-bfd8-6e951bf6eafe'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922236, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922238, tzinfo=datetime.timezone.utc), UUID('465dd399-b516-4bf5-b95e-629507fb32c8'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922254, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922256, tzinfo=datetime.timezone.utc), UUID('5c2e4297-8244-4538-843c-6cd3f57abfa8'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922269, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922272, tzinfo=datetime.timezone.utc), UUID('4d09971b-111f-46ef-8d1d-8e448bc9ef0a'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922285, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922288, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('361d2aa9-8366-493d-a2b7-0d6da18f32aa'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922472, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922474, tzinfo=datetime.timezone.utc), UUID('153f76a1-086d-4dda-9ef5-2b4aea1444e9'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922487, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922491, tzinfo=datetime.timezone.utc), UUID('13ff8cda-71ae-4990-aa9a-18aafe5a87ba'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922503, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922505, tzinfo=datetime.timezone.utc), UUID('01ea56ec-d495-42fb-9d7c-09b0c0f93c48'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922517, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922520, tzinfo=datetime.timezone.utc), UUID('3d1288f4-d197-4de5-999b-4b90e7b4906f'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922532, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922534, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5e82ff5b-c2fd-4760-a529-cca40527af1d, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:21:14.922213-05, 2025-08-23 22:21:14.922219-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5e82ff5b-c2fd-4760-a529-cca40527af1d, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:21:14.922213-05, 2025-08-23 22:21:14.922219-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (5e82ff5b-c2fd-4760-a529-cca40527af1d, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:21:14.922213-05, 2025-08-23 22:21:14.922219-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('5e82ff5b-c2fd-4760-a529-cca40527af1d'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922213, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922219, tzinfo=datetime.timezone.utc), UUID('10888483-2593-490d-bfd8-6e951bf6eafe'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922236, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922238, tzinfo=datetime.timezone.utc), UUID('465dd399-b516-4bf5-b95e-629507fb32c8'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922254, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922256, tzinfo=datetime.timezone.utc), UUID('5c2e4297-8244-4538-843c-6cd3f57abfa8'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922269, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922272, tzinfo=datetime.timezone.utc), UUID('4d09971b-111f-46ef-8d1d-8e448bc9ef0a'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922285, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922288, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('361d2aa9-8366-493d-a2b7-0d6da18f32aa'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922472, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922474, tzinfo=datetime.timezone.utc), UUID('153f76a1-086d-4dda-9ef5-2b4aea1444e9'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922487, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922491, tzinfo=datetime.timezone.utc), UUID('13ff8cda-71ae-4990-aa9a-18aafe5a87ba'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922503, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922505, tzinfo=datetime.timezone.utc), UUID('01ea56ec-d495-42fb-9d7c-09b0c0f93c48'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922517, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922520, tzinfo=datetime.timezone.utc), UUID('3d1288f4-d197-4de5-999b-4b90e7b4906f'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 21, 14, 922532, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 21, 14, 922534, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | [generated in 0.01071s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:23:32 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | [generated in 0.00143s (insertmanyvalues) 1/1 (unordered)] (UUID('505e7a28-8228-459a-8ad0-1fd5a251c994'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601487, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601493, tzinfo=datetime.timezone.utc), UUID('87996905-139f-40a9-90ce-3b24aeab9786'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601511, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601514, tzinfo=datetime.timezone.utc), UUID('39dd8dab-5143-4ddf-9568-c80a7688428d'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601525, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601527, tzinfo=datetime.timezone.utc), UUID('17453022-3c5b-41e7-9686-6cb8126f8db9'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601538, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601540, tzinfo=datetime.timezone.utc), UUID('9d31f09f-0702-498d-85b9-7740edd0714e'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601551, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601553, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('3b3bab5b-d82a-43c9-b6fa-45403896dc31'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601830, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601833, tzinfo=datetime.timezone.utc), UUID('476f605f-a562-4300-a547-8c6467888912'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601851, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601854, tzinfo=datetime.timezone.utc), UUID('1643a1f6-271e-482e-a2a1-3d1eb81ca8b5'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601872, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601876, tzinfo=datetime.timezone.utc), UUID('72034786-4f41-4dec-85bc-b1d65e3623fb'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601896, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601900, tzinfo=datetime.timezone.utc), UUID('df200b4e-f6d1-475a-a207-edfdb45b2c31'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601917, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601921, tzinfo=datetime.timezone.utc))
2025-08-23 22:23:32 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:23:32 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (505e7a28-8228-459a-8ad0-1fd5a251c994, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:23:32.601487-05, 2025-08-23 22:23:32.601493-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('505e7a28-8228-459a-8ad0-1fd5a251c994'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601487, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601493, tzinfo=datetime.timezone.utc), UUID('87996905-139f-40a9-90ce-3b24aeab9786'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601511, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601514, tzinfo=datetime.timezone.utc), UUID('39dd8dab-5143-4ddf-9568-c80a7688428d'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601525, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601527, tzinfo=datetime.timezone.utc), UUID('17453022-3c5b-41e7-9686-6cb8126f8db9'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601538, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601540, tzinfo=datetime.timezone.utc), UUID('9d31f09f-0702-498d-85b9-7740edd0714e'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601551, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601553, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('3b3bab5b-d82a-43c9-b6fa-45403896dc31'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601830, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601833, tzinfo=datetime.timezone.utc), UUID('476f605f-a562-4300-a547-8c6467888912'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601851, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601854, tzinfo=datetime.timezone.utc), UUID('1643a1f6-271e-482e-a2a1-3d1eb81ca8b5'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601872, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601876, tzinfo=datetime.timezone.utc), UUID('72034786-4f41-4dec-85bc-b1d65e3623fb'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601896, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601900, tzinfo=datetime.timezone.utc), UUID('df200b4e-f6d1-475a-a207-edfdb45b2c31'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601917, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601921, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (505e7a28-8228-459a-8ad0-1fd5a251c994, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:23:32.601487-05, 2025-08-23 22:23:32.601493-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (505e7a28-8228-459a-8ad0-1fd5a251c994, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:23:32.601487-05, 2025-08-23 22:23:32.601493-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (505e7a28-8228-459a-8ad0-1fd5a251c994, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:23:32.601487-05, 2025-08-23 22:23:32.601493-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME ZONE, $ ... 3380 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('505e7a28-8228-459a-8ad0-1fd5a251c994'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601487, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601493, tzinfo=datetime.timezone.utc), UUID('87996905-139f-40a9-90ce-3b24aeab9786'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601511, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601514, tzinfo=datetime.timezone.utc), UUID('39dd8dab-5143-4ddf-9568-c80a7688428d'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601525, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601527, tzinfo=datetime.timezone.utc), UUID('17453022-3c5b-41e7-9686-6cb8126f8db9'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601538, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601540, tzinfo=datetime.timezone.utc), UUID('9d31f09f-0702-498d-85b9-7740edd0714e'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601551, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601553, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('3b3bab5b-d82a-43c9-b6fa-45403896dc31'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601830, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601833, tzinfo=datetime.timezone.utc), UUID('476f605f-a562-4300-a547-8c6467888912'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601851, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601854, tzinfo=datetime.timezone.utc), UUID('1643a1f6-271e-482e-a2a1-3d1eb81ca8b5'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601872, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601876, tzinfo=datetime.timezone.utc), UUID('72034786-4f41-4dec-85bc-b1d65e3623fb'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601896, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601900, tzinfo=datetime.timezone.utc), UUID('df200b4e-f6d1-475a-a207-edfdb45b2c31'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 23, 32, 601917, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 23, 32, 601921, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | [generated in 0.00329s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:34:41 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME  ... 3527 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | [generated in 0.00268s (insertmanyvalues) 1/1 (unordered)] (UUID('838d2b62-a0f3-4b7f-ba2c-b42d684f3488'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772630, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772637, tzinfo=datetime.timezone.utc), UUID('45eb04e5-259e-4ad0-b031-e9f9134b90ed'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772656, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772659, tzinfo=datetime.timezone.utc), UUID('cdd8178e-636c-455c-bdd3-e55849040cb6'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772671, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772674, tzinfo=datetime.timezone.utc), UUID('c022f62f-75c4-4ec7-a60c-1f7903b9dd42'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772685, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772687, tzinfo=datetime.timezone.utc), UUID('06cebdae-d946-4d98-9f35-d2ded714ee1e'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772701, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772703, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('f2222d12-a656-43a7-a2be-c5923e7355b2'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772885, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772887, tzinfo=datetime.timezone.utc), UUID('37a3febb-e239-44d9-a952-3a039b559554'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772896, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772898, tzinfo=datetime.timezone.utc), UUID('8f60bbd0-5a37-4bb4-8a98-28fc4cf84e79'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772909, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772911, tzinfo=datetime.timezone.utc), UUID('5df4458c-d4a9-4ed6-91aa-6e6f9c830796'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772922, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772924, tzinfo=datetime.timezone.utc), UUID('a342cbfd-de6b-4533-92f4-8fd2be3b289d'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772935, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772937, tzinfo=datetime.timezone.utc))
2025-08-23 22:34:41 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:34:41 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (838d2b62-a0f3-4b7f-ba2c-b42d684f3488, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:34:41.77263-05, 2025-08-23 22:34:41.772637-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME  ... 3527 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('838d2b62-a0f3-4b7f-ba2c-b42d684f3488'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772630, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772637, tzinfo=datetime.timezone.utc), UUID('45eb04e5-259e-4ad0-b031-e9f9134b90ed'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772656, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772659, tzinfo=datetime.timezone.utc), UUID('cdd8178e-636c-455c-bdd3-e55849040cb6'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772671, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772674, tzinfo=datetime.timezone.utc), UUID('c022f62f-75c4-4ec7-a60c-1f7903b9dd42'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772685, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772687, tzinfo=datetime.timezone.utc), UUID('06cebdae-d946-4d98-9f35-d2ded714ee1e'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772701, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772703, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('f2222d12-a656-43a7-a2be-c5923e7355b2'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772885, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772887, tzinfo=datetime.timezone.utc), UUID('37a3febb-e239-44d9-a952-3a039b559554'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772896, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772898, tzinfo=datetime.timezone.utc), UUID('8f60bbd0-5a37-4bb4-8a98-28fc4cf84e79'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772909, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772911, tzinfo=datetime.timezone.utc), UUID('5df4458c-d4a9-4ed6-91aa-6e6f9c830796'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772922, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772924, tzinfo=datetime.timezone.utc), UUID('a342cbfd-de6b-4533-92f4-8fd2be3b289d'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772935, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772937, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (838d2b62-a0f3-4b7f-ba2c-b42d684f3488, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:34:41.77263-05, 2025-08-23 22:34:41.772637-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (838d2b62-a0f3-4b7f-ba2c-b42d684f3488, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:34:41.77263-05, 2025-08-23 22:34:41.772637-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (838d2b62-a0f3-4b7f-ba2c-b42d684f3488, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:34:41.77263-05, 2025-08-23 22:34:41.772637-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME  ... 3527 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('838d2b62-a0f3-4b7f-ba2c-b42d684f3488'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772630, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772637, tzinfo=datetime.timezone.utc), UUID('45eb04e5-259e-4ad0-b031-e9f9134b90ed'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772656, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772659, tzinfo=datetime.timezone.utc), UUID('cdd8178e-636c-455c-bdd3-e55849040cb6'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772671, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772674, tzinfo=datetime.timezone.utc), UUID('c022f62f-75c4-4ec7-a60c-1f7903b9dd42'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772685, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772687, tzinfo=datetime.timezone.utc), UUID('06cebdae-d946-4d98-9f35-d2ded714ee1e'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772701, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772703, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('f2222d12-a656-43a7-a2be-c5923e7355b2'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772885, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772887, tzinfo=datetime.timezone.utc), UUID('37a3febb-e239-44d9-a952-3a039b559554'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772896, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772898, tzinfo=datetime.timezone.utc), UUID('8f60bbd0-5a37-4bb4-8a98-28fc4cf84e79'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772909, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772911, tzinfo=datetime.timezone.utc), UUID('5df4458c-d4a9-4ed6-91aa-6e6f9c830796'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772922, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772924, tzinfo=datetime.timezone.utc), UUID('a342cbfd-de6b-4533-92f4-8fd2be3b289d'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 34, 41, 772935, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 34, 41, 772937, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:37:55 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:37:55 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:37:55 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:37:55 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:37:55 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:37:55 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:37:55 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:37:55 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:37:55 | INFO | sqlalchemy.engine.Engine | [generated in 0.00222s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:37:55 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 22:37:56 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME  ... 3527 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:37:56 | INFO | sqlalchemy.engine.Engine | [generated in 0.00117s (insertmanyvalues) 1/1 (unordered)] (UUID('854f91c1-4186-43ea-9090-8756d9e37c22'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14768, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14774, tzinfo=datetime.timezone.utc), UUID('54bd6e22-b5c7-40f6-bb6c-06a8783dde07'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14792, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14794, tzinfo=datetime.timezone.utc), UUID('ae9dfa3b-12b5-4d1e-b8b8-8492fce1b9c4'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14806, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14808, tzinfo=datetime.timezone.utc), UUID('307ee428-68ee-4906-b1cb-cc877828e772'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14819, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14821, tzinfo=datetime.timezone.utc), UUID('bf72a775-8473-4cfd-873f-c25f506ed274'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14832, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14835, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('14c4a8c3-494f-4ecf-897f-2e720de06e9a'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15011, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15013, tzinfo=datetime.timezone.utc), UUID('3b9785d3-1edd-4e50-adbd-0675664d48e4'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15024, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15026, tzinfo=datetime.timezone.utc), UUID('5a7acb7c-d550-4013-ba2d-1c1e4468c362'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15037, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15039, tzinfo=datetime.timezone.utc), UUID('f86475ac-d989-40b9-a5c4-ee6f00b8ba50'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15050, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15052, tzinfo=datetime.timezone.utc), UUID('56f42b48-d7c1-4b94-8108-92d9d6333f64'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15063, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15065, tzinfo=datetime.timezone.utc))
2025-08-23 22:37:56 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:37:56 | ERROR | app.routers.role | Error de integridad en importación masiva: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (854f91c1-4186-43ea-9090-8756d9e37c22, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:37:56.014768-05, 2025-08-23 22:37:56.014774-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME  ... 3527 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('854f91c1-4186-43ea-9090-8756d9e37c22'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14768, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14774, tzinfo=datetime.timezone.utc), UUID('54bd6e22-b5c7-40f6-bb6c-06a8783dde07'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14792, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14794, tzinfo=datetime.timezone.utc), UUID('ae9dfa3b-12b5-4d1e-b8b8-8492fce1b9c4'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14806, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14808, tzinfo=datetime.timezone.utc), UUID('307ee428-68ee-4906-b1cb-cc877828e772'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14819, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14821, tzinfo=datetime.timezone.utc), UUID('bf72a775-8473-4cfd-873f-c25f506ed274'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14832, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14835, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('14c4a8c3-494f-4ecf-897f-2e720de06e9a'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15011, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15013, tzinfo=datetime.timezone.utc), UUID('3b9785d3-1edd-4e50-adbd-0675664d48e4'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15024, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15026, tzinfo=datetime.timezone.utc), UUID('5a7acb7c-d550-4013-ba2d-1c1e4468c362'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15037, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15039, tzinfo=datetime.timezone.utc), UUID('f86475ac-d989-40b9-a5c4-ee6f00b8ba50'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15050, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15052, tzinfo=datetime.timezone.utc), UUID('56f42b48-d7c1-4b94-8108-92d9d6333f64'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15063, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15065, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 545, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
        lambda protocol: protocol.bind_execute(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
            self._state, args, '', limit, True, timeout))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.NotNullViolationError: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (854f91c1-4186-43ea-9090-8756d9e37c22, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:37:56.014768-05, 2025-08-23 22:37:56.014774-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (854f91c1-4186-43ea-9090-8756d9e37c22, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:37:56.014768-05, 2025-08-23 22:37:56.014774-05).

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    audit_level = await get_audit_level(db)    # Decidir si registrar el log según el nivel
                  ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\utils\audit_level.py", line 18, in get_audit_level
    result = await db.execute(
             ^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        False,
        ^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
    ~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
    ~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
    ~~~~~~~~~~~^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
    ~~~~~~~~~~~^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self.mapper,
        ^^^^^^^^^^^^
        uow.states_for_mapper_hierarchy(self.mapper, False, False),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        uow,
        ^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        base_mapper,
        ^^^^^^^^^^^^
    ...<3 lines>...
        insert,
        ^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1143, in _emit_insert_statements
    result = connection.execute(
        statement, multiparams, execution_options=execution_options
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1413, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1838, in _execute_context
    return self._exec_insertmany_context(dialect, context)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2120, in _exec_insertmany_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e,
        ^^
    ...<4 lines>...
        is_sub_exec=True,
        ^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2112, in _exec_insertmany_context
    dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~^
        cursor,
        ^^^^^^^
    ...<2 lines>...
        context,
        ^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: el valor nulo en la columna «role_type» de la relación «roles» viola la restricción de no nulo
DETAIL:  La fila que falla contiene (854f91c1-4186-43ea-9090-8756d9e37c22, Administrador, Rol de administrador del sistema, null, null, f, t, null, null, 2025-08-23 22:37:56.014768-05, 2025-08-23 22:37:56.014774-05).
[SQL: INSERT INTO roles (id, name, description, role_type, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::BOOLEAN, $6::BOOLEAN, $7::UUID, $8::UUID, $9::TIMESTAMP WITH TIME  ... 3527 characters truncated ... 06::BOOLEAN, $207::UUID, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)]
[parameters: (UUID('854f91c1-4186-43ea-9090-8756d9e37c22'), 'Administrador', 'Rol de administrador del sistema', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14768, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14774, tzinfo=datetime.timezone.utc), UUID('54bd6e22-b5c7-40f6-bb6c-06a8783dde07'), 'Supervisor', 'Gestiona equipos y aproba cambios', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14792, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14794, tzinfo=datetime.timezone.utc), UUID('ae9dfa3b-12b5-4d1e-b8b8-8492fce1b9c4'), 'Vendedor', 'Gestiona ventas y cotizaciones', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14806, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14808, tzinfo=datetime.timezone.utc), UUID('307ee428-68ee-4906-b1cb-cc877828e772'), 'Cajero', 'Opera el punto de venta', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14819, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14821, tzinfo=datetime.timezone.utc), UUID('bf72a775-8473-4cfd-873f-c25f506ed274'), 'Inventario', 'Controla existencias y conteos', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 14832, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 14835, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('14c4a8c3-494f-4ecf-897f-2e720de06e9a'), 'Analista', 'Reportes y anÃ¡lisis', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15011, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15013, tzinfo=datetime.timezone.utc), UUID('3b9785d3-1edd-4e50-adbd-0675664d48e4'), 'Calidad', 'Control de calidad', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15024, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15026, tzinfo=datetime.timezone.utc), UUID('5a7acb7c-d550-4013-ba2d-1c1e4468c362'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15037, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15039, tzinfo=datetime.timezone.utc), UUID('f86475ac-d989-40b9-a5c4-ee6f00b8ba50'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15050, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15052, tzinfo=datetime.timezone.utc), UUID('56f42b48-d7c1-4b94-8108-92d9d6333f64'), 'system', 'Semilla', None, False, True, None, None, datetime.datetime(2025, 8, 24, 3, 37, 56, 15063, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 37, 56, 15065, tzinfo=datetime.timezone.utc))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | [generated in 0.00159s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:49:32 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:51:51 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:51:51 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:51:51 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:51:51 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:51:51 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:51:51 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:51:51 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:51:51 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | [generated in 0.00066s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:54:29 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 22:54:29 | ERROR | app.routers.role | Error inesperado importando roles
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 212, in import_roles
    async with db.no_autoflush:
               ^^^^^^^^^^^^^^^
TypeError: '_GeneratorContextManager' object does not support the asynchronous context manager protocol
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | [generated in 0.00134s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::JSON, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::T ... 3787 characters truncated ... 27::BOOLEAN, $228::UUID, $229::UUID, $230::TIMESTAMP WITH TIME ZONE, $231::TIMESTAMP WITH TIME ZONE)
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | [generated in 0.00129s (insertmanyvalues) 1/1 (unordered)] (UUID('baed98ce-0d53-427b-9148-f003c1551c50'), 'Administrador', 'Rol de administrador del sistema', 'admin', '["[\\"read\\"", "\\"write\\"", "\\"admin\\"]"]', True, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 3, 55, 36, 475383, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 55, 36, 475387, tzinfo=datetime.timezone.utc), UUID('5b4e27a6-5b69-4817-9e6b-6f5dcebdfaec'), 'Supervisor', 'Gestiona equipos y aproba cambios', 'manager', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 3, 55, 36, 475421, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 55, 36, 475423, tzinfo=datetime.timezone.utc), UUID('10a02c4c-6b9d-409b-bb46-de6ac4f474fa'), 'Vendedor', 'Gestiona ventas y cotizaciones', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 3, 55, 36, 475444, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 55, 36, 475446, tzinfo=datetime.timezone.utc), UUID('147548aa-40fa-4707-89a7-70ac79538794'), 'Cajero', 'Opera el punto de venta', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 3, 55, 36, 475454, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 55, 36, 475456, tzinfo=datetime.timezone.utc), UUID('e553f6a7-62ff-47f7-891c-c75d634513e4'), 'Inventario', 'Controla existencias y conteos', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False ... 131 parameters truncated ... False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 3, 55, 36, 475572, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 55, 36, 475573, tzinfo=datetime.timezone.utc), UUID('4f5f4a90-19fb-4f80-b35d-411d5c4411ff'), 'Calidad', 'Control de calidad', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 3, 55, 36, 475580, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 55, 36, 475582, tzinfo=datetime.timezone.utc), UUID('e9dba732-12a4-42c6-be9e-a7ee90286d20'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 3, 55, 36, 475590, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 55, 36, 475592, tzinfo=datetime.timezone.utc), UUID('ddbbb465-fb22-44db-a12a-76ba81eab997'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', 'viewer', '["[\\"read\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 3, 55, 36, 475599, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 55, 36, 475600, tzinfo=datetime.timezone.utc), UUID('c5042155-5933-4ab3-9740-949e87bbf3b9'), 'system', 'Semilla', 'system', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 3, 55, 36, 475608, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 3, 55, 36, 475609, tzinfo=datetime.timezone.utc))
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | [generated in 0.00256s] ('audit_level',)
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | [generated in 0.00105s] (UUID('2d8c8456-973c-4c7c-9f67-90fe9a2237aa'), 'IMPORT', 'Role', None, 'Importación masiva: 21 roles importados.', UUID('17cdb0d0-5746-4730-914f-78b3028270d6'))
2025-08-23 22:55:36 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | [cached since 383.1s ago] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::JSON, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::T ... 3787 characters truncated ... 27::BOOLEAN, $228::UUID, $229::UUID, $230::TIMESTAMP WITH TIME ZONE, $231::TIMESTAMP WITH TIME ZONE)
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | [cached since 383.1s ago (insertmanyvalues) 1/1 (unordered)] (UUID('96d21e64-7826-440e-9640-2a14c0311bba'), 'Administrador', 'Rol de administrador del sistema', 'admin', '["[\\"read\\"", "\\"write\\"", "\\"admin\\"]"]', True, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 1, 59, 530106, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 1, 59, 530109, tzinfo=datetime.timezone.utc), UUID('9139dff1-849f-40fd-8940-598f11746722'), 'Supervisor', 'Gestiona equipos y aproba cambios', 'manager', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 1, 59, 530114, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 1, 59, 530115, tzinfo=datetime.timezone.utc), UUID('2dd57a39-015a-4332-a4ea-2af163974d62'), 'Vendedor', 'Gestiona ventas y cotizaciones', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 1, 59, 530118, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 1, 59, 530119, tzinfo=datetime.timezone.utc), UUID('78c7d16a-a989-425a-a681-bbc8a754b763'), 'Cajero', 'Opera el punto de venta', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 1, 59, 530122, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 1, 59, 530123, tzinfo=datetime.timezone.utc), UUID('6a928e1d-83ba-4f55-85fc-4cf11a9bb3b8'), 'Inventario', 'Controla existencias y conteos', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False ... 131 parameters truncated ... False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 1, 59, 530172, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 1, 59, 530173, tzinfo=datetime.timezone.utc), UUID('2774d8ae-d47d-4060-801a-4e970ca4ed6a'), 'Calidad', 'Control de calidad', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 1, 59, 530176, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 1, 59, 530177, tzinfo=datetime.timezone.utc), UUID('69f7219e-4993-4d37-a06a-6d0b40c39451'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 1, 59, 530179, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 1, 59, 530180, tzinfo=datetime.timezone.utc), UUID('8406c282-1490-471f-90e0-2197f20e4b07'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', 'viewer', '["[\\"read\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 1, 59, 530183, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 1, 59, 530184, tzinfo=datetime.timezone.utc), UUID('9dbb9cc0-63cf-4103-95ae-8a0e0c7e9eca'), 'system', 'Semilla', 'system', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 1, 59, 530186, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 1, 59, 530187, tzinfo=datetime.timezone.utc))
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | [cached since 383s ago] ('audit_level',)
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | [cached since 383s ago] (UUID('caf2c490-15c8-4a8e-b31c-4a26b4d3da46'), 'IMPORT', 'Role', None, 'Importación masiva: 21 roles importados.', UUID('17cdb0d0-5746-4730-914f-78b3028270d6'))
2025-08-23 23:01:59 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | [generated in 0.00270s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 23:02:35 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 23:02:35 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 23:02:35 | ERROR | app.routers.role | Error inesperado importando roles
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    res = await db.execute(select(func.lower(Role.name)))
                           ^^^^^^
NameError: name 'select' is not defined. Did you forget to import 'select'?
2025-08-23 23:02:43 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:02:43 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 23:02:43 | INFO | sqlalchemy.engine.Engine | [cached since 8.566s ago] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 23:02:44 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 23:02:44 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 23:02:44 | ERROR | app.routers.role | Error inesperado importando roles
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 210, in import_roles
    res = await db.execute(select(func.lower(Role.name)))
                           ^^^^^^
NameError: name 'select' is not defined. Did you forget to import 'select'?
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | [generated in 0.00158s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 23:09:18 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 23:09:18 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 23:09:18 | ERROR | app.routers.role | Error inesperado importando roles
Traceback (most recent call last):
  File "E:\Desarrollo\IA\Projects\4_Ventas\backend\app\routers\role.py", line 211, in import_roles
    res = await db.execute(select(func.lower(Role.name)))
                                  ^^^^
NameError: name 'func' is not defined
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | [generated in 0.00446s] ('system@example.com',)
2025-08-23 23:15:14 | WARNING | passlib.handlers.bcrypt | (trapped) error reading bcrypt version
Traceback (most recent call last):
  File "E:\Desarrollo\PointOfSale\backend\venv\Lib\site-packages\passlib\handlers\bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
2025-08-23 23:15:14 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | [generated in 0.00619s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 23:15:26 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | SELECT lower(roles.name) AS lower_1 
FROM roles
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | [generated in 0.00196s] ()
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::JSON, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::T ... 3787 characters truncated ... 27::BOOLEAN, $228::UUID, $229::UUID, $230::TIMESTAMP WITH TIME ZONE, $231::TIMESTAMP WITH TIME ZONE)
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | [generated in 0.00128s (insertmanyvalues) 1/1 (unordered)] (UUID('3440f4aa-52c3-4480-90b2-f24c301132ef'), 'Administrador', 'Rol de administrador del sistema', 'admin', '["[\\"read\\"", "\\"write\\"", "\\"admin\\"]"]', True, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 15, 26, 632511, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 15, 26, 632517, tzinfo=datetime.timezone.utc), UUID('f5f41980-c3c9-4b75-b40a-0e3a0853ffec'), 'Supervisor', 'Gestiona equipos y aproba cambios', 'manager', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 15, 26, 632534, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 15, 26, 632536, tzinfo=datetime.timezone.utc), UUID('b5d6a968-285a-40a2-8750-7e2b8956d70a'), 'Vendedor', 'Gestiona ventas y cotizaciones', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 15, 26, 632548, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 15, 26, 632550, tzinfo=datetime.timezone.utc), UUID('79fff578-b739-470e-b6c8-12662ec27dfe'), 'Cajero', 'Opera el punto de venta', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 15, 26, 632558, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 15, 26, 632560, tzinfo=datetime.timezone.utc), UUID('1a38342a-d76f-4d13-a3cf-2ef1d9cbb59e'), 'Inventario', 'Controla existencias y conteos', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False ... 131 parameters truncated ... False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 15, 26, 632689, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 15, 26, 632691, tzinfo=datetime.timezone.utc), UUID('16c0b4ae-9e4f-467f-80f5-041d242ee4ee'), 'Calidad', 'Control de calidad', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 15, 26, 632701, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 15, 26, 632703, tzinfo=datetime.timezone.utc), UUID('d373aaad-3eee-474d-9580-7cd6a86c4d28'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 15, 26, 632713, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 15, 26, 632714, tzinfo=datetime.timezone.utc), UUID('243b7824-6654-4c24-9e56-ab95e04fa720'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', 'viewer', '["[\\"read\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 15, 26, 632723, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 15, 26, 632724, tzinfo=datetime.timezone.utc), UUID('8ba3ab9c-c329-478b-87ea-b7529dcc90ce'), 'system', 'Semilla', 'system', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), None, datetime.datetime(2025, 8, 24, 4, 15, 26, 632733, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 15, 26, 632734, tzinfo=datetime.timezone.utc))
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | [generated in 0.00283s] ('audit_level',)
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | [generated in 0.00073s] (UUID('52b9b94c-a300-4344-a321-0e3d7fc2fa07'), 'IMPORT', 'Role', None, 'Importación masiva: 21 roles importados (omitidos por duplicado: 0).', UUID('17cdb0d0-5746-4730-914f-78b3028270d6'))
2025-08-23 23:15:26 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00256s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 23:37:48 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | SELECT lower(roles.name) AS lower_1 
FROM roles
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00087s] ()
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, created_by, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::JSON, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::UUID, $10::T ... 3787 characters truncated ... 27::BOOLEAN, $228::UUID, $229::UUID, $230::TIMESTAMP WITH TIME ZONE, $231::TIMESTAMP WITH TIME ZONE)
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00161s (insertmanyvalues) 1/1 (unordered)] (UUID('7d1710b8-4baf-4ba5-8d60-9fc2e248c06e'), 'Administrador', 'Rol de administrador del sistema', 'admin', '["[\\"read\\"", "\\"write\\"", "\\"admin\\"]"]', True, True, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 37, 48, 232406, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 37, 48, 232412, tzinfo=datetime.timezone.utc), UUID('3d726877-4be3-4650-8193-a6e0953f4f97'), 'Supervisor', 'Gestiona equipos y aproba cambios', 'manager', '["[\\"read\\"", "\\"write\\"]"]', False, True, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 37, 48, 232433, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 37, 48, 232435, tzinfo=datetime.timezone.utc), UUID('435b1f6c-94d8-441f-bccc-67eac5dd2103'), 'Vendedor', 'Gestiona ventas y cotizaciones', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 37, 48, 232448, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 37, 48, 232451, tzinfo=datetime.timezone.utc), UUID('aaf3adbf-d197-4462-beb7-501cce924a5a'), 'Cajero', 'Opera el punto de venta', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 37, 48, 232463, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 37, 48, 232466, tzinfo=datetime.timezone.utc), UUID('6821a6b4-dc33-4d36-9d2a-e2760b6911e5'), 'Inventario', 'Controla existencias y conteos', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False ... 131 parameters truncated ... False, True, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 37, 48, 232878, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 37, 48, 232880, tzinfo=datetime.timezone.utc), UUID('7e80ebba-ab8c-4079-95be-78dd4d7998a4'), 'Calidad', 'Control de calidad', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 37, 48, 232891, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 37, 48, 232892, tzinfo=datetime.timezone.utc), UUID('fd419300-2864-411d-bb41-57b4052d0ea6'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 37, 48, 232899, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 37, 48, 232900, tzinfo=datetime.timezone.utc), UUID('25257bc4-1770-4034-935b-991c59afb7dd'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', 'viewer', '["[\\"read\\"]"]', False, True, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 37, 48, 232906, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 37, 48, 232907, tzinfo=datetime.timezone.utc), UUID('b0f49b6f-8f40-491c-99ec-bae349883ee1'), 'system', 'Semilla', 'system', '["[\\"read\\"", "\\"write\\"]"]', False, True, None, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 37, 48, 232913, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 37, 48, 232914, tzinfo=datetime.timezone.utc))
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00103s] ('audit_level',)
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | [generated in 0.00185s] (UUID('126658bf-0372-47f0-a494-e1b51df5031f'), 'IMPORT', 'Role', None, 'Importación masiva: 21 roles importados (omitidos por duplicado: 0).', UUID('17cdb0d0-5746-4730-914f-78b3028270d6'))
2025-08-23 23:37:48 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | select pg_catalog.version()
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | select current_schema()
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | show standard_conforming_strings
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | [raw sql] ()
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | [generated in 0.00339s] (UUID('17cdb0d0-5746-4730-914f-78b3028270d6'),)
2025-08-23 23:46:18 | INFO | app.routers.role | Headers después de limpieza: ['name', 'description', 'role_type', 'scopes', 'is_admin']
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | SELECT lower(roles.name) AS lower_1 
FROM roles
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | [generated in 0.00116s] ()
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | INSERT INTO roles (id, name, description, role_type, scopes, is_admin, active, user_id, created_at, updated_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::role_type_enum, $5::JSON, $6::BOOLEAN, $7::BOOLEAN, $8::UUID, $9::TIMESTAMP WITH TIME ZONE ... 3523 characters truncated ... :BOOLEAN, $207::BOOLEAN, $208::UUID, $209::TIMESTAMP WITH TIME ZONE, $210::TIMESTAMP WITH TIME ZONE)
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | [generated in 0.00163s (insertmanyvalues) 1/1 (unordered)] (UUID('06d2a72c-2bad-4568-aa71-c427ce38beee'), 'Administrador', 'Rol de administrador del sistema', 'admin', '["[\\"read\\"", "\\"write\\"", "\\"admin\\"]"]', True, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 575726, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 575733, tzinfo=datetime.timezone.utc), UUID('c7ade725-ca34-4f96-aded-7252e36ab579'), 'Supervisor', 'Gestiona equipos y aproba cambios', 'manager', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 575751, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 575753, tzinfo=datetime.timezone.utc), UUID('abf63488-68f0-49e5-9a8b-b9c12f71123e'), 'Vendedor', 'Gestiona ventas y cotizaciones', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 575766, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 575769, tzinfo=datetime.timezone.utc), UUID('ca2f2d4e-1c46-4282-8541-021b08696964'), 'Cajero', 'Opera el punto de venta', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 575779, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 575781, tzinfo=datetime.timezone.utc), UUID('087122e2-a8a5-4807-ab1d-998698d81dfd'), 'Inventario', 'Controla existencias y conteos', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 575791, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 575793, tzinfo=datetime.timezone.utc) ... 110 parameters truncated ... UUID('7b69b93b-2316-46b4-ac7e-85d62115c5c1'), 'Analista', 'Reportes y anÃ¡lisis', 'viewer', '["[\\"read\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 575996, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 575998, tzinfo=datetime.timezone.utc), UUID('16908741-84ed-4ef3-8258-fb891add23e6'), 'Calidad', 'Control de calidad', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 576008, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 576010, tzinfo=datetime.timezone.utc), UUID('73c3e6d9-3233-4a1c-bd16-2bab658f3f79'), 'Desarrollador', 'Soporte tÃ©cnico y desarrollo', 'viewer', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 576021, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 576023, tzinfo=datetime.timezone.utc), UUID('09a53f48-90a7-4bd3-a8d3-341755d76e35'), 'Auditor_Junior', 'Apoyo a auditorÃ\xadas', 'viewer', '["[\\"read\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 576034, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 576036, tzinfo=datetime.timezone.utc), UUID('cb4774ad-d2f3-407f-9318-123947e4ca5e'), 'system', 'Semilla', 'system', '["[\\"read\\"", "\\"write\\"]"]', False, True, UUID('17cdb0d0-5746-4730-914f-78b3028270d6'), datetime.datetime(2025, 8, 24, 4, 46, 18, 576047, tzinfo=datetime.timezone.utc), datetime.datetime(2025, 8, 24, 4, 46, 18, 576049, tzinfo=datetime.timezone.utc))
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | SELECT settings.value 
FROM settings 
WHERE settings.key = $1::VARCHAR AND settings.active = true
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | [generated in 0.00801s] ('audit_level',)
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | INSERT INTO audit_logs (id, action, entity, entity_id, description, user_id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::UUID, $5::VARCHAR, $6::UUID) RETURNING audit_logs.created_at
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | [generated in 0.00430s] (UUID('dc5e5fcb-b074-4b81-aeb3-9796988b8fd7'), 'IMPORT', 'Role', None, 'Importación masiva: 21 roles importados (omitidos por duplicado: 0).', UUID('17cdb0d0-5746-4730-914f-78b3028270d6'))
2025-08-23 23:46:18 | INFO | sqlalchemy.engine.Engine | COMMIT
2025-08-23 23:48:40 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:48:40 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 23:48:40 | INFO | sqlalchemy.engine.Engine | [generated in 0.01542s] ('admin@example.com',)
2025-08-23 23:48:40 | INFO | sqlalchemy.engine.Engine | ROLLBACK
2025-08-23 23:48:43 | INFO | sqlalchemy.engine.Engine | BEGIN (implicit)
2025-08-23 23:48:43 | INFO | sqlalchemy.engine.Engine | SELECT users.id, users.username, users.email, users.full_name, users.password, users.active, users.superuser, users.role_id, users.user_id, users.created_at, users.updated_at 
FROM users 
WHERE users.email = $1::VARCHAR
2025-08-23 23:48:43 | INFO | sqlalchemy.engine.Engine | [cached since 3.326s ago] ('admin@example.com',)
2025-08-23 23:48:43 | INFO | sqlalchemy.engine.Engine | ROLLBACK
